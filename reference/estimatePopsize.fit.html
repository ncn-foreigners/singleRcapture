<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="estimatePopsize.fit does for estimatePopsize what
glm.fit does for glm. It is internally called in
estimatePopsize. Since estimatePopsize does much more than
just regression fitting estimatePopsize.fit is much faster."><title>Regression fitting in single source capture-recapture models — estimatePopsize.fit • singleRcapture</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Regression fitting in single source capture-recapture models — estimatePopsize.fit"><meta property="og:description" content="estimatePopsize.fit does for estimatePopsize what
glm.fit does for glm. It is internally called in
estimatePopsize. Since estimatePopsize does much more than
just regression fitting estimatePopsize.fit is much faster."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">singleRcapture</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.3.2</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"><li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ncn-foreigners/singleRcapture/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Regression fitting in single source capture-recapture models</h1>
      <small class="dont-index">Source: <a href="https://github.com/ncn-foreigners/singleRcapture/blob/HEAD/R/estimatePopsize.fit.R" class="external-link"><code>R/estimatePopsize.fit.R</code></a></small>
      <div class="d-none name"><code>estimatePopsize.fit.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p><code>estimatePopsize.fit</code> does for <code>estimatePopsize</code> what
<code>glm.fit</code> does for <code>glm</code>. It is internally called in
<code>estimatePopsize</code>. Since <code>estimatePopsize</code> does much more than
just regression fitting <code>estimatePopsize.fit</code> is much faster.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">estimatePopsize.fit</span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, <span class="va">family</span>, <span class="va">control</span>, <span class="va">method</span>, <span class="va">priorWeights</span>, <span class="va">start</span>, <span class="va">...</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>y</dt>
<dd><p>vector of dependent variables.</p></dd>


<dt>X</dt>
<dd><p>model matrix, the vglm one.</p></dd>


<dt>family</dt>
<dd><p>same as model in <code>estimatePopsize</code>.</p></dd>


<dt>control</dt>
<dd><p>control parameters created in <code>controlModel</code>.</p></dd>


<dt>method</dt>
<dd><p>method of estimation same as in <code>estimatePopsize</code>.</p></dd>


<dt>priorWeights</dt>
<dd><p>vector of prior weights its the same argument as weights
in <code>estimatePopsize</code>.</p></dd>


<dt>start</dt>
<dd><p>initial value of regression parameters.</p></dd>


<dt>...</dt>
<dd><p>arguments to pass to other methods.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>List with regression parameters, working weights
(if IRLS fitting method) was chosen and number of iterations taken.</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>If <code>method</code> argument was set to <code>"optim"</code> the <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">stats::optim</a></code>
function will be used to fit regression with analyticly computed gradient and
(minus) log likelihood functions as <code>gr</code> and <code>fn</code> arguments.
Unfortunately <code>optim</code> does not allow for hessian to be specified.
More information about how to modify <code>optim</code> fitting is included in
<code><a href="controlMethod.html">controlMethod()</a></code>.</p>
<p>If <code>method</code> argument was set to <code>"IRLS"</code> the iteratively reweighted
least squares. The algorithm is well know in generalised linear models.
Thomas W. Yee later extended this algorithm to vector generalised linear models
and in more general terms it can roughly be described as
(this is Yee's description after changing some conventions):
<script id="MathJax-script" async src="../../mathjaxr/doc/mathjax/es5/tex-chtml-full.js"></script></p><ol><li><p>Initialise with:</p><ul><li><p><code>converged &lt;- FALSE</code></p></li>
<li><p><code>iter &lt;- 1</code></p></li>
<li><p><em></em>\(\boldsymbol{\beta}\)<code> &lt;- start</code></p></li>
<li><p><em></em>\(\boldsymbol{W}\)<code> &lt;- prior</code></p></li>
<li><p><em></em>\(\ell\)<code> &lt;- </code><em></em>\(\ell(\boldsymbol{\beta})\)</p></li>
</ul></li>
<li><p>If <code>converged</code> or <code>iter &gt; Maxiter</code> move to step 7.</p></li>
<li><p>Store values from previous algorithm step:</p><ul><li><p><em></em>\(\boldsymbol{W}_{-}\)<code> &lt;- </code><em></em>\(\boldsymbol{W}\)</p></li>
<li><p><em></em>\(\ell_{-}\)<code> &lt;- </code><em></em>\(\ell\)</p></li>
<li><p><em></em>\(\boldsymbol{\beta}_{-}\)<code> &lt;- </code><em></em>\(\boldsymbol{\beta}\)</p></li>
</ul><p>and assign values at current step:</p><ul><li><p><em></em>\(\boldsymbol{\eta}\)<code> &lt;- </code><em></em>\(\boldsymbol{X}_{vlm}\boldsymbol{\beta}\)</p></li>
<li><p><em></em>\(Z_{i}\)<code> &lt;- </code><em></em>\(\eta_{i}+\frac{\partial\ell_{i}}{\partial\eta_{i}}\mathbb{E}\left(\frac{\partial^{2}\ell_{i}}{\partial\eta_{i}^{T}\partial\eta_{i}}\right)^{-1}\)</p></li>
<li><p><em></em>\(\boldsymbol{W}_{ij}\)<code> &lt;- </code><em></em>\(\mathbb{E}\left(\frac{\partial^{2}\ell}{\partial\boldsymbol{\eta}_{j}^{T}\partial\boldsymbol{\eta}_{i}}\right)\)</p></li>
</ul><p>where <em></em>\(\ell_{i}\) is the ith component of log likelihood function,
<em></em>\(\eta_{i}\) is the vector of linear predictors associated with
ith row and  <em></em>\(\mathbb{E}\left(\frac{\partial^{2}\ell_{i}}{\partial\eta_{i}^{T}\partial\eta_{i}}\right)\)
corresponds to weights associated with ith row and <em></em>\(\boldsymbol{W}\)
is a block matrix, made of diagonal matrixes <em></em>\(\mathbb{E}\left(\frac{\partial^{2}\ell}{\partial\boldsymbol{\eta}_{j}^{T}\partial\boldsymbol{\eta}_{i}}\right)\).</p></li>
<li><p>Regress <em></em>\(\boldsymbol{Z}\) on <em></em>\(\boldsymbol{X}_{vlm}\)
to obtain <em></em>\(\boldsymbol{\beta}\) as:
\[\boldsymbol{\beta}=\left(\boldsymbol{X}_{vlm}^{T}\boldsymbol{W}\boldsymbol{X}_{vlm}\right)^{-1}\boldsymbol{X}_{vlm}^{T}\boldsymbol{W}\boldsymbol{Z}\]</p></li>
<li><p>Assign:</p><ul><li><p><code>converged &lt;- </code><em></em>\(\ell(\boldsymbol{\beta})-\ell_{-} or
<em></em>\(||\boldsymbol{\beta}-\boldsymbol{\beta}_{-}||_{\infty} </p></li>
<li><p><code>iter &lt;- iter + 1</code></p></li>
</ul><p>where <em></em>\(\varepsilon\) is the relative tolerance level, by default <code>1e-8</code>.</p></li>
<li><p>Return to step 2.</p></li>
<li><p>Return <em></em>\(\boldsymbol{\beta}, \boldsymbol{W}\), <code>iter</code>.</p></li>
</ol><p>In this package we use different conventions for <em></em>\(\boldsymbol{X}_vlm\)
matrix hence slight differences are present in algorithm description but
results are identical.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Yee, T. W. (2015). Vector Generalized Linear and Additive Models:
With an Implementation in R. New York, USA: Springer. ISBN 978-1-4939-2817-0.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">stats::glm()</a></code> <code><a href="estimatePopsize.html">estimatePopsize()</a></code> <code><a href="controlMethod.html">controlMethod()</a></code> <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">stats::optim()</a></code></p></div>
    </div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Piotr Chlebicki, Maciej Beręsewicz</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Set seed for reproducibility</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Set population size and 'true' regression coefficients</span></span></span>
<span class="r-in"><span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">7562</span></span></span>
<span class="r-in"><span><span class="va">beta1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">.2</span>, <span class="op">-</span><span class="fl">.95</span>, <span class="op">-</span><span class="fl">3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">beta2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">0</span>, <span class="op">-</span><span class="fl">.01</span>, <span class="fl">.3</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Generate covariates</span></span></span>
<span class="r-in"><span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Poisson.html" class="external-link">rpois</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">N</span>, lambda <span class="op">=</span> <span class="fl">1.85</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">N</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">x3</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span>n <span class="op">=</span> <span class="va">N</span>, size <span class="op">=</span> <span class="fl">1</span>, prob <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Compute linear predictors</span></span></span>
<span class="r-in"><span><span class="va">eta1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">x1</span>, <span class="va">x2</span>, <span class="va">x3</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta1</span></span></span>
<span class="r-in"><span><span class="va">eta2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">x1</span>, <span class="va">x2</span>, <span class="va">x3</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta2</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># generate dependent variable</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="singleRmodels.html">ztoipoisson</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">simulate</span><span class="op">(</span>n <span class="op">=</span> <span class="va">N</span>, eta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">eta1</span>, <span class="va">eta2</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># optionally visualise destribution on y with barplot</span></span></span>
<span class="r-in"><span><span class="co"># barplot(table(y))</span></span></span>
<span class="r-in"><span><span class="co"># truncate data</span></span></span>
<span class="r-in"><span><span class="va">x1</span> <span class="op">&lt;-</span> <span class="va">x1</span><span class="op">[</span><span class="va">y</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">x2</span> <span class="op">&lt;-</span> <span class="va">x2</span><span class="op">[</span><span class="va">y</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">x3</span> <span class="op">&lt;-</span> <span class="va">x3</span><span class="op">[</span><span class="va">y</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="va">y</span> <span class="op">&lt;-</span> <span class="va">y</span><span class="op">[</span><span class="va">y</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">]</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># construct vglm model matrix</span></span></span>
<span class="r-in"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fl">0</span>, nrow <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">8</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span><span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">X</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span><span class="op">)</span>, <span class="fl">5</span><span class="op">:</span><span class="fl">8</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">X</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span></span></span>
<span class="r-in"><span><span class="co"># this arrtibute tells the function which elements of the design matrix </span></span></span>
<span class="r-in"><span><span class="co"># correspond to which linear predictor </span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">X</span>, <span class="st">"hwm"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">4</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># finally call the function</span></span></span>
<span class="r-in"><span><span class="va">beta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">beta1</span>, <span class="va">beta2</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">estimatePopsize.fit</span><span class="op">(</span></span></span>
<span class="r-in"><span>  y <span class="op">=</span> <span class="va">y</span>, X <span class="op">=</span> <span class="va">X</span>, </span></span>
<span class="r-in"><span>  method <span class="op">=</span> <span class="st">"IRLS"</span>, </span></span>
<span class="r-in"><span>  priorWeights <span class="op">=</span> <span class="fl">1</span>, </span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="fu"><a href="singleRmodels.html">ztoipoisson</a></span><span class="op">(</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>  control <span class="op">=</span> <span class="fu"><a href="controlMethod.html">controlMethod</a></span><span class="op">(</span>verbose <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>  start <span class="op">=</span> <span class="va">beta</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iteration number 1 log-likelihood: -24744.076</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Parameter vector:  -10.32608769   0.58037475  -1.33218497   8.36264342  -4.15462875   1.00033619  -1.63224339   5.90341582</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> log-likelihood reduction:  -22645.89</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Value of gradient at current step:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   2008.841853  3991.135030 -2052.038101  -512.014214  -163.400825  -465.615846   178.933201   -78.624749</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Algorithm will terminate if one of following conditions will be met:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> The increase to minus log-likelihood will be bellow chosen value of epsilon 1e-08 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Maximum change to the vector of regression parameters will be bellow the chosen value of epsilon.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> At current step the highest change was: 11.372388</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Taking a modified step....</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iteration number 1 log-likelihood: -2007.6174</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Parameter vector:   0.69091287  0.26326159 -1.03420854 -2.59476489  1.84076445  0.12091652 -0.12884159  0.31561786</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> log-likelihood reduction:  90.568444</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Value of gradient at current step:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   174.865107  -26.513615  158.337969  -10.824417 -233.596320 -553.952664  129.236794  -26.977372</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Algorithm will terminate if one of following conditions will be met:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> The increase to minus log-likelihood will be bellow chosen value of epsilon 1e-08 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Maximum change to the vector of regression parameters will be bellow the chosen value of epsilon.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> At current step the highest change was: 0.35538711</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ----</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iteration number 2 log-likelihood: -24826.724</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Parameter vector:  -10.32648783   0.58069155  -1.33278511   8.44612934  -4.15796616   1.00010731  -1.62897813   6.40259530</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> log-likelihood reduction:  -22819.107</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Value of gradient at current step:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   1952.014020  3736.765638 -1936.872567  -568.841689  -167.743878  -471.534666   180.607498   -83.197848</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Algorithm will terminate if one of following conditions will be met:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> The increase to minus log-likelihood will be bellow chosen value of epsilon 1e-08 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Maximum change to the vector of regression parameters will be bellow the chosen value of epsilon.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> At current step the highest change was: 11.040894</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Taking a modified step....</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Iteration number 2 log-likelihood: -2007.6174</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Parameter vector:   0.69091287  0.26326159 -1.03420854 -2.59476489  1.84076445  0.12091652 -0.12884159  0.31561786</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> log-likelihood reduction:  0.00000000000022737368</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Value of gradient at current step:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   174.865107  -26.513615  158.337969  -10.824417 -233.596320 -553.952664  129.236794  -26.977372</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Algorithm will terminate if one of following conditions will be met:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> The increase to minus log-likelihood will be bellow chosen value of epsilon 1e-08 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Maximum change to the vector of regression parameters will be bellow the chosen value of epsilon.</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> At current step the highest change was: 0.00000000000000044408921</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> ----</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>Convergence at halfstepsize</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> Value of analytically computed hessian at fitted regression coefficients:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>             [,1]         [,2]        [,3]       [,4]       [,5]       [,6]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] -2657.85992  -7217.84982  3584.50587 -142.78323   77.04236  143.27686</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] -7217.84982 -27619.89450 10288.10240 -417.13512  143.27686  407.88203</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]  3584.50587  10288.10240 -7892.62858  223.19784  -27.47559  -46.63509</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,]  -142.78323   -417.13512   223.19784 -142.78323   48.89458  101.21679</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5,]    77.04236    143.27686   -27.47559   48.89458 -151.58136 -298.78820</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6,]   143.27686    407.88203   -46.63509  101.21679 -298.78820 -876.15563</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [7,]   -27.47559    -46.63509    83.26395  -42.37576   80.04882  147.80742</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [8,]    48.89458    101.21679   -42.37576   48.89458  -58.24756 -128.05861</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            [,7]       [,8]</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,]  -27.47559   48.89458</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,]  -46.63509  101.21679</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,]   83.26395  -42.37576</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,]  -42.37576   48.89458</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5,]   80.04882  -58.24756</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6,]  147.80742 -128.05861</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [7,] -177.00319   60.28389</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [8,]   60.28389  -58.24756</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> The matrix above has the following eigen values:</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  -20.52098 -36.83832 -110.5987 -171.7599 -520.8088 -1054.241 -3577.607 -34083.78 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># extract results</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># regression coefficient vector</span></span></span>
<span class="r-in"><span><span class="va">res</span><span class="op">$</span><span class="va">beta</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  0.6909129  0.2632616 -1.0342085 -2.5947649  1.8407645  0.1209165 -0.1288416</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [8]  0.3156179</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># compare with actual true coeffictient vector</span></span></span>
<span class="r-in"><span><span class="va">beta</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  1.00  0.20 -0.95 -3.00  2.00  0.00 -0.01  0.30</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># number of iterations</span></span></span>
<span class="r-in"><span><span class="va">res</span><span class="op">$</span><span class="va">iter</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 2</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># working weights</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">weights</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>            lambda         mixed         mixed        omega</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1,] 5.701175e-03 -4.935010e-03 -4.935010e-03 4.890802e-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [2,] 5.418062e-04 -1.761896e-06 -1.761896e-06 1.119346e-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [3,] 1.775422e-05 -5.795365e+02 -5.795365e+02 2.358105e-09</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [4,] 1.918954e-04 -9.317753e-19 -9.317753e-19 1.918738e-04</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [5,] 7.500023e-04 -3.255879e-05 -3.255879e-05 1.244941e-03</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [6,] 1.107066e-03 -2.928194e-05 -2.928194e-05 2.030523e-03</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># call with another method</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">estimatePopsize.fit</span><span class="op">(</span></span></span>
<span class="r-in"><span>  y <span class="op">=</span> <span class="va">y</span>, X <span class="op">=</span> <span class="va">X</span>, </span></span>
<span class="r-in"><span>  method <span class="op">=</span> <span class="st">"optim"</span>, </span></span>
<span class="r-in"><span>  priorWeights <span class="op">=</span> <span class="fl">1</span>, </span></span>
<span class="r-in"><span>  family <span class="op">=</span> <span class="fu"><a href="singleRmodels.html">ztoipoisson</a></span><span class="op">(</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>  start <span class="op">=</span> <span class="va">beta</span> <span class="op">+</span> <span class="fu"><a href="https://rdrr.io/r/stats/Normal.html" class="external-link">rnorm</a></span><span class="op">(</span>n <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span>, sd <span class="op">=</span> <span class="fl">.1</span><span class="op">)</span>, </span></span>
<span class="r-in"><span>  control <span class="op">=</span> <span class="fu"><a href="controlMethod.html">controlMethod</a></span><span class="op">(</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="co"># extract results</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># regression coefficient vector</span></span></span>
<span class="r-in"><span><span class="va">res</span><span class="op">$</span><span class="va">beta</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  1.0047373  0.2091686 -0.9434504 -2.9622529  1.1099858 -0.1179091  0.2076010</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [8]  1.3492574</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># compare with actual true coeffictient vector</span></span></span>
<span class="r-in"><span><span class="va">beta</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1]  1.00  0.20 -0.95 -3.00  2.00  0.00 -0.01  0.30</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># number of iterations</span></span></span>
<span class="r-in"><span><span class="va">res</span><span class="op">$</span><span class="va">iter</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> function gradient </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>      132      132 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># optim does not calculated working weights</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">weights</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] 1</span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Piotr Chlebicki, Maciej Beręsewicz.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer></div>

  

  

  </body></html>

