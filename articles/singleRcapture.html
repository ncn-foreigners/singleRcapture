<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>singleRcapture: An R Package for Single-Source Capture-Recapture Models • singleRcapture</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="singleRcapture: An R Package for Single-Source Capture-Recapture Models">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">singleRcapture</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.3.9001</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/singleRcapture.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ncn-foreigners/singleRcapture/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>singleRcapture: An R Package for Single-Source Capture-Recapture Models</h1>
                        <h4 data-toc-skip class="author">Piotr
Chlebicki, Maciej Beręsewicz</h4>
            
            <h4 data-toc-skip class="date">2025-02-13</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ncn-foreigners/singleRcapture/blob/main/vignettes/singleRcapture.Rmd" class="external-link"><code>vignettes/singleRcapture.Rmd</code></a></small>
      <div class="d-none name"><code>singleRcapture.Rmd</code></div>
    </div>

    
    
<style>
pre {
  overflow-x: auto;
}
pre code {
  word-wrap: normal;
  white-space: pre;
}
</style>
<div class="section level2">
<h2 id="sec-introduction">Introduction<a class="anchor" aria-label="anchor" href="#sec-introduction"></a>
</h2>
<p>Population size estimation is a methodological approach employed
across multiple scientific disciplines, which serves as the basis for
research, policy formulation, and decision-making processes <span class="citation">(cf. <a href="#ref-bohning2018capture">Böhning, Bunge,
and Heijden 2018</a>)</span>. In the field of statistics, particularly
official statistics, precise population estimates are essential in order
to develop robust economic models, optimize resource allocation, and
inform evidence-based policy <span class="citation">(cf. <a href="#ref-baffour2013modern">Baffour, King, and Valente
2013</a>)</span>. Social scientists utilize advanced population
estimation techniques to investigate <em>hard-to-reach</em> populations,
such as homeless individuals or illicit drug users in an effort to
overcome the inherent limitations of conventional census methodologies.
These techniques are crucial for obtaining accurate data on populations
that are typically under-represented or difficult to access using
traditional sampling methods <span class="citation">(cf. <a href="#ref-vincent2022estimating">Vincent and Thompson 2022</a>)</span>.
In ecology and epidemiology, researchers focus on estimating the size of
individual species or disease-affected populations within defined
geographical regions as part of conservation efforts, ecosystem
management, and public health interventions.</p>
<p>Population size estimation can be approached using various
methodologies, each with distinct advantages and limitations.
Traditional approaches include full enumeration (e.g. censuses) and
comprehensive sample surveys, which, while providing detailed data, are
often resource-intensive and may result in delayed estimates,
particularly for human populations. Alternative methods leverage
existing data sources, such as administrative registers or carefully
designed small-scale studies in wildlife research, or census coverage
surveys <span class="citation">(cf. <a href="#ref-wolter1986some">Wolter
1986</a>; <a href="#ref-zhang2019note">Zhang 2019</a>)</span>.
Information from these sources is often extracted by applying
statistical methods, known as <em>capture-recapture</em> or <em>multiple
system estimation</em>, which rely on data from multiple enumerations of
the same population <span class="citation">(cf. <a href="#ref-dunne2024system">Dunne and Zhang 2024</a>)</span>. This
approach can be implemented using either a single source with repeated
observations, two sources, or multiple sources.</p>
<p>In this paper we focus on methods that involve a single data source
with multiple enumerations of the same units <span class="citation">(cf.
<a href="#ref-ztpoisson">Heijden et al. 2003</a>)</span>. In human
population studies, such data can be derived from police records, health
system databases, or border control logs; in the case of non-human
populations, data of this kind can come from veterinary records or
specialized field data. These methods are often applied to estimate
hard-to-reach or hidden populations, where standard sampling methods may
be inappropriate because of prohibitive costs or problems with
identifying population members.</p>
<p>While methods for two or more sources are implemented in various
open-source software packages, for instance <strong>CARE-4</strong>
<span class="citation">(<a href="#ref-yang2006care4">Yang and Chao
2006</a>)</span> (in <strong>GAUSS</strong>), <strong>Rcapture</strong>
<span class="citation">(<a href="#ref-baillargeon2007rcapture">Baillargeon and Rivest
2007</a>)</span>, <strong>marked</strong> <span class="citation">(<a href="#ref-laake2013marked">Laake et al. 2013</a>)</span> or
<strong>VGAM</strong> <span class="citation">(<a href="#ref-yee2015vgam">Thomas W. Yee, Stoklosa, and Huggins
2015</a>)</span> (all in <strong>R</strong>), single-source
capture-recapture (SSCR) methods are either not available at all or are
only partially implemented in existing <strong>R</strong> packages or
other software. Therefore, the paper attempts to bridge this gap by
introducing the <strong>singleRcapture</strong> package, which implement
<em>state-of-the-art</em> SSCR methods and offer a user friendly API
resembling existing <strong>R</strong> functions (e.g.,
<code>glm</code>). In the next subsection we describe existing
<strong>R</strong> packages and other software that could be used for
estimating population size using SSCR methods.</p>
<div class="section level3">
<h3 id="sec-software">Software for capture-recapture with a single source<a class="anchor" aria-label="anchor" href="#sec-software"></a>
</h3>
<p>The majority of SSCR methods assume zero-truncated distributions or
their extensions (e.g., inclusion of one-inflation). The
<strong>Distributions.jl</strong> <span class="citation">(<a href="#ref-Distributionsjl">Besançon et al. 2021</a>)</span> (in
<strong>Julia</strong>), <strong>StatsModels</strong> <span class="citation">(<a href="#ref-seabold2010statsmodels">Seabold and
Perktold 2010</a>)</span> (in <strong>Python</strong>),
<strong>countreg</strong> <span class="citation">(<a href="#ref-countreg">Zeileis, Kleiber, and Jackman 2008</a>)</span>,
<strong>VGAM</strong> <span class="citation">(<a href="#ref-VGAM-main">T. Yee 2015</a>)</span> or
<strong>distributions3</strong> <span class="citation">(<a href="#ref-distributions3">Hayes et al. 2024</a>)</span> (in
<strong>R</strong>) implement some of those truncated distributions
(e.g. <code>distributions3::ZTPoisson</code> or
<code>countreg::zerotrunc</code>) and the most general distributions,
such as Generally Altered, Inflated, Truncated and Deflated, can be
found in the <strong>VGAM</strong> package (e.g.
<code><a href="https://rdrr.io/pkg/VGAM/man/gaitdpoisson.html" class="external-link">VGAM::gaitdpoisson</a></code> for the Poisson distribution, see <span class="citation">Thomas W. Yee and Ma (<a href="#ref-gaitdcount">2024</a>)</span> for a detailed description).
However, the estimation of parameters of a given truncated (and possibly
inflated) distribution is just the first step (as in the case of
log-linear models in capture-recapture with two sources) and, to the
best of our knowledge, there is no open-source software that can be used
to estimate population size using on SSCR methods and includes variance
estimators or diagnostics.</p>
<p>Therefore, the purpose of the <strong>singleRcapture</strong>, an
<strong>R</strong> package, is to bridge this gap by providing
scientists and other practitioners with a tool for estimating population
size with SSCR methods. We have implemented state-of-the-art methods, as
recently described by <span class="citation">Böhning, Bunge, and Heijden
(<a href="#ref-bohning2018capture">2018</a>)</span> or <span class="citation">Böhning and Friedl (<a href="#ref-bohning2024one">2024</a>)</span> and provided their
extensions (e.g., inclusion of covariates, different treatment of
one-inflation), which will be covered in detail in Section 2. The
package implements variance estimation based on various methods, can be
used to create custom models and diagnostic plots (e.g. rootograms) with
parameters estimated using a modified iteratively reweighted least
squares (IRLS) algorithm we have implemented for estimation stability.
To the best of our knowledge, no existing open-source package allows the
estimation of population size by selecting an appropriate SSCR model,
conducting the estimation, and providing informative diagnostics of the
results.</p>
<p>The remaining part of the paper is structured as follows. Section 2
contains a brief description of the theoretical background and
information about fitting methods and available methods of variance
estimation. Section 3 introduces the main functions of the package.
Section 4 presents a case study and contains an assessment of its
results, diagnostics and estimates of specific sub-populations. Section
5 describes classes and <code>S3methods</code> implemented in the
package. The paper ends with conclusions and an appendix showing how to
use the <code>estimatePopsizeFit</code> function which is aimed to mimic
the <code>glm.fit</code> or similar functions. In replication materials
we show how to implement a custom model as this option could be of
interest to users wishing to apply any new bootstrap methods not
implemented in the package.</p>
</div>
</div>
<div class="section level2">
<h2 id="sec-theory">Theoretical background<a class="anchor" aria-label="anchor" href="#sec-theory"></a>
</h2>
<div class="section level3">
<h3 id="how-to-estimate-population-size-with-a-single-source">How to estimate population size with a single source?<a class="anchor" aria-label="anchor" href="#how-to-estimate-population-size-with-a-single-source"></a>
</h3>
<p>Let
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mi>k</mi></msub><annotation encoding="application/x-tex">Y_{k}</annotation></semantics></math>
represent the number of times the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>-th
unit was observed in a single source (e.g. register). Clearly, we only
observe
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>:</mo><msub><mi>Y</mi><mi>k</mi></msub><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">k:Y_{k}&gt;0</annotation></semantics></math>
and do not know how many units have been missed
(i.e. <math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>Y</mi><mi>k</mi></msub><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">Y_{k}=0</annotation></semantics></math>),
so the population size, denoted by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>,
needs to be estimated. In general, we assume that the conditional
distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>Y</mi><mi>k</mi></msub><annotation encoding="application/x-tex">Y_{k}</annotation></semantics></math>
given a vector of covariates
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐱</mi><mi>k</mi></msub><annotation encoding="application/x-tex">\boldsymbol{x}_{k}</annotation></semantics></math>
follows a version of the zero-truncated count data distribution (and its
extensions). When we know the parameters of the distribution we can
estimate the population size using a Horvitz-Thompson type estimator
given by:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mover><mi>N</mi><mo accent="true">̂</mo></mover><mo>=</mo><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><mfrac><msub><mi>I</mi><mi>k</mi></msub><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Y</mi><mi>k</mi></msub><mo>&gt;</mo><mn>0</mn><mo stretchy="false" form="prefix">|</mo><msub><mi>𝐗</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow></mfrac><mo>=</mo><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>N</mi><mrow><mi>o</mi><mi>b</mi><mi>s</mi></mrow></msub></munderover><mfrac><mn>1</mn><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Y</mi><mi>k</mi></msub><mo>&gt;</mo><mn>0</mn><mo stretchy="false" form="prefix">|</mo><msub><mi>𝐗</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow></mfrac><mo>,</mo></mrow><annotation encoding="application/x-tex">
\begin{equation}
\hat{N}=
\sum_{k=1}^{N}\frac{I_{k}}{\mathbb{P}[Y_{k}&gt;0|\boldsymbol{X}_{k}]}=
\sum_{k=1}^{N_{obs}}\frac{1}{\mathbb{P}[Y_{k}&gt;0|\boldsymbol{X}_{k}]},
\end{equation}
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>I</mi><mi>k</mi></msub><mo>:=</mo><msub><mi>ℐ</mi><mi>ℕ</mi></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Y</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">I_{k}:=\mathcal{I}_{\mathbb{N}}(Y_{k})</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mrow><mi>o</mi><mi>b</mi><mi>s</mi></mrow></msub><annotation encoding="application/x-tex">N_{obs}</annotation></semantics></math>
is the number of observed units and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ℐ</mi><annotation encoding="application/x-tex">\mathcal{I}</annotation></semantics></math>
is the indicator function, while the maximum likelihood estimate of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>N</mi><annotation encoding="application/x-tex">N</annotation></semantics></math>
is obtained after substituting regression parameters
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛃</mi><annotation encoding="application/x-tex">\boldsymbol{\beta}</annotation></semantics></math>
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Y</mi><mi>k</mi></msub><mo>&gt;</mo><mn>0</mn><mo stretchy="false" form="prefix">|</mo><msub><mi>𝐱</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbb{P}[Y_{k}&gt;0|\boldsymbol{x}_{k}]</annotation></semantics></math>
in the above equation.</p>
<p>The basic SSCR assumes independence between counts, which is a rather
naive assumption, since the first capture may significantly influence
the behavior of a given unit or limit the possibility of subsequent
captures (e.g. due to incarceration).</p>
<p>To solve these issues, <span class="citation">Ryan T. Godwin and
Böhning (<a href="#ref-godwin2017estimation">2017b</a>)</span> and <span class="citation">Ryan T. Godwin and Böhning (<a href="#ref-ztoi-oizt-poisson">2017a</a>)</span> introduced one-inflated
distributions, which explicitly model the probability of singletons by
giving additional mass
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ω</mi><annotation encoding="application/x-tex">\omega</annotation></semantics></math>
to singletons denoted as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>ℐ</mi><mrow><mo stretchy="false" form="prefix">{</mo><mn>1</mn><mo stretchy="false" form="postfix">}</mo></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\mathcal{I}_{\{1\}}(y)</annotation></semantics></math><span class="citation">(cf. <a href="#ref-bohning2024one">Böhning and
Friedl 2024</a>)</span>. In other words they considered a new random
varialbe
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>Y</mi><mo>*</mo></msup><annotation encoding="application/x-tex">Y^{\ast}</annotation></semantics></math>
that corresponds to the data collection process which exhibits one
inflation:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><msup><mi>Y</mi><mo>*</mo></msup><mo>=</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><msup><mi>Y</mi><mo>*</mo></msup><mo>&gt;</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mi>ω</mi><msub><mi>ℐ</mi><mrow><mo stretchy="false" form="prefix">{</mo><mn>1</mn><mo stretchy="false" form="postfix">}</mo></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>ω</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo>=</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><mi>Y</mi><mo>&gt;</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
\begin{equation*}
  \mathbb{P}\left[Y^{\ast}=y|Y^{\ast}&gt;0\right] =
  \omega\mathcal{I}_{\{1\}}(y)+(1-\omega)\mathbb{P}[Y=y|Y&gt;0].
\end{equation*}
</annotation></semantics></math></p>
<p>Analytic variance estimation is then performed by computing two parts
of the decomposition according to the law of total variance given
by:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">var</mtext><mrow><mo stretchy="true" form="prefix">[</mo><mover><mi>N</mi><mo accent="true">̂</mo></mover><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mi>𝔼</mi><mrow><mo stretchy="true" form="prefix">[</mo><mtext mathvariant="normal">var</mtext><mrow><mo stretchy="true" form="prefix">[</mo><mover><mi>N</mi><mo accent="true">̂</mo></mover><mo stretchy="false" form="prefix">|</mo><msub><mi>I</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>I</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mo>+</mo><mtext mathvariant="normal">var</mtext><mrow><mo stretchy="true" form="prefix">[</mo><mi>𝔼</mi><mrow><mo stretchy="true" form="prefix">[</mo><mover><mi>N</mi><mo accent="true">̂</mo></mover><mo stretchy="false" form="prefix">|</mo><msub><mi>I</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>I</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
\begin{equation}\label{eq-law_of_total_variance_decomposition}
  \text{var}[\hat{N}] = \mathbb{E}\left[\text{var}
  \left[\hat{N}|I_{1},\dots,I_{n}\right]\right] + 
  \text{var}\left[\mathbb{E}[\hat{N}|I_{1},\dots,I_{n}]\right],
\end{equation}
</annotation></semantics></math></p>
<p>where the first part can be estimated using the multivariate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>δ</mi><annotation encoding="application/x-tex">\delta</annotation></semantics></math>
method given by:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝔼</mi><mrow><mo stretchy="true" form="prefix">[</mo><mtext mathvariant="normal">var</mtext><mrow><mo stretchy="true" form="prefix">[</mo><mover><mi>N</mi><mo accent="true">̂</mo></mover><mo stretchy="false" form="prefix">|</mo><msub><mi>I</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>I</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><msub><mrow><msup><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><mi>∂</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>I</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>I</mi><mi>N</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>∂</mi><mi>𝛃</mi></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mi>⊤</mi></msup><mtext mathvariant="normal">cov</mtext><mrow><mo stretchy="true" form="prefix">[</mo><mover><mi>𝛃</mi><mo accent="true">̂</mo></mover><mo stretchy="true" form="postfix">]</mo></mrow><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mrow><mi>∂</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>I</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>I</mi><mi>N</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>∂</mi><mi>𝛃</mi></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">|</mo></mrow><mrow><mi>𝛃</mi><mo>=</mo><mover><mi>𝛃</mi><mo accent="true">̂</mo></mover></mrow></msub><mo>,</mo></mrow><annotation encoding="application/x-tex">
\begin{equation*}
  \mathbb{E}\left[\text{var} \left[\hat{N}|I_{1},\dots,I_{n}\right]\right] =
  \left.\left(\frac{\partial(N|I_1,\dots,I_N)}{\partial\boldsymbol{\beta}}\right)^\top
  \text{cov}\left[\hat{\boldsymbol{\beta}}\right]
  \left(\frac{\partial(N|I_1,\dots,I_N)}{\partial\boldsymbol{\beta}}\right)
  \right|_{\boldsymbol{\beta}=\hat{\boldsymbol{\beta}}},
\end{equation*}
</annotation></semantics></math></p>
<p>while the second part of the decomposition above, assuming
independence of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>I</mi><mi>k</mi></msub><annotation encoding="application/x-tex">I_{k}</annotation></semantics></math>’s
and after some omitted simplifications, is optimally estimated by:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">var</mtext><mrow><mo stretchy="true" form="prefix">[</mo><mi>𝔼</mi><mrow><mo stretchy="true" form="prefix">(</mo><mover><mi>N</mi><mo accent="true">̂</mo></mover><mo stretchy="false" form="prefix">|</mo><msub><mi>I</mi><mn>1</mn></msub><mo>,</mo><mi>…</mi><mo>,</mo><msub><mi>I</mi><mi>n</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mtext mathvariant="normal">var</mtext><mrow><mo stretchy="true" form="prefix">[</mo><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></munderover><mfrac><msub><mi>I</mi><mi>k</mi></msub><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Y</mi><mi>k</mi></msub><mo>&gt;</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow></mfrac><mo stretchy="true" form="postfix">]</mo></mrow><mo>≈</mo><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>N</mi><mrow><mi>o</mi><mi>b</mi><mi>s</mi></mrow></msub></munderover><mfrac><mrow><mn>1</mn><mo>−</mo><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Y</mi><mi>k</mi></msub><mo>&gt;</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>ℙ</mi><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Y</mi><mi>k</mi></msub><mo>&gt;</mo><mn>0</mn><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mrow></mfrac><mo>,</mo></mrow><annotation encoding="application/x-tex">
\begin{equation*}
  \text{var}\left[\mathbb{E}(\hat{N}|I_{1},\dots,I_{n})\right] =
  \text{var}\left[\sum_{k=1}^{N}\frac{I_{k}}{\mathbb{P}(Y_{k}&gt;0)}\right]
  \approx\sum_{k=1}^{N_{obs}}\frac{1-\mathbb{P}(Y_{k}&gt;0)}{\mathbb{P}(Y_{k}&gt;0)^{2}},
\end{equation*}
</annotation></semantics></math></p>
<p>which serves as the basis for interval estimation. Confidence
intervals are usually constructed under the assumption of (asymptotic)
normality of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>N</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{N}</annotation></semantics></math>
or asymptotic normality of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>ln</mo><mrow><mo stretchy="true" form="prefix">(</mo><mover><mi>N</mi><mo accent="true">̂</mo></mover><mo>−</mo><mi>N</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\ln(\hat{N}-N)</annotation></semantics></math>
(or log normality of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>N</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{N}</annotation></semantics></math>).
The latter is an attempt to address a common criticism of student type
confidence intervals in SSCR, namely a possibly skewed distribution of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>N</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{N}</annotation></semantics></math>,
and results in the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>1</mn><mo>−</mo><mi>α</mi></mrow><annotation encoding="application/x-tex">1-\alpha</annotation></semantics></math>
confidence interval given by:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>N</mi><mrow><mi>o</mi><mi>b</mi><mi>s</mi></mrow></msub><mo>+</mo><mfrac><mrow><mover><mi>N</mi><mo accent="true">̂</mo></mover><mo>−</mo><msub><mi>N</mi><mrow><mi>o</mi><mi>b</mi><mi>s</mi></mrow></msub></mrow><mi>ξ</mi></mfrac><mo>,</mo><msub><mi>N</mi><mrow><mi>o</mi><mi>b</mi><mi>s</mi></mrow></msub><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mover><mi>N</mi><mo accent="true">̂</mo></mover><mo>−</mo><msub><mi>N</mi><mrow><mi>o</mi><mi>b</mi><mi>s</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mi>ξ</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
\begin{equation*}
  \left(N_{obs}+\frac{\hat{N}-N_{obs}}{\xi},N_{obs} +
  \left(\hat{N}-N_{obs}\right)\xi\right),
\end{equation*}
</annotation></semantics></math></p>
<p>where:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ξ</mi><mo>=</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>z</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mfrac><mi>α</mi><mn>2</mn></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><msqrt><mrow><mo>ln</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>+</mo><mfrac><mrow><mover><mtext mathvariant="normal">Var</mtext><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">(</mo><mover><mi>N</mi><mo accent="true">̂</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow></mrow><msup><mrow><mo stretchy="true" form="prefix">(</mo><mover><mi>N</mi><mo accent="true">̂</mo></mover><mo>−</mo><msub><mi>N</mi><mrow><mi>o</mi><mi>b</mi><mi>s</mi></mrow></msub><mo stretchy="true" form="postfix">)</mo></mrow><mn>2</mn></msup></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mrow></msqrt><mo stretchy="true" form="postfix">)</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
\begin{equation*}
  \xi = \exp\left(z\left(1-\frac{\alpha}{2}\right)
  \sqrt{\ln\left(1+\frac{\widehat{\text{Var}}(\hat{N})}{\left(\hat{N}-N_{obs}\right)^{2}}\right)}\right),
\end{equation*}
</annotation></semantics></math></p>
<p>and where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>z</mi><annotation encoding="application/x-tex">z</annotation></semantics></math>
is the quantile function of the standard normal distribution. The
estimator
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>N</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{N}</annotation></semantics></math>
is best interpreted as being an estimator of the total number of units
in the population, since we have no means of estimating the number of
units in the population for which the probability of being included in
the data is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math><span class="citation">(<a href="#ref-ztpoisson">Heijden et al.
2003</a>)</span>.</p>
</div>
<div class="section level3">
<h3 id="available-models">Available models<a class="anchor" aria-label="anchor" href="#available-models"></a>
</h3>
<p>The full list of models implemented in
<strong>singleRcapture</strong> along with corresponding expressions for
probability density functions and point estimates can be found in the
collective help file for all family functions:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">ztpoisson</span></span></code></pre></div>
<p>For the sake of simplicity, we only list the family functions
together with brief descriptions. For more detailed information, please
consult the relevant literature.</p>
<p>The current list of these family functions includes:</p>
<ul>
<li>Generalized Chao’s <span class="citation">(<a href="#ref-chao1987estimating">Chao 1987</a>)</span> and Zelterman’s
<span class="citation">(<a href="#ref-zelterman1988robust">Zelterman
1988</a>)</span> estimators via logistic regression on variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Z</mi><annotation encoding="application/x-tex">Z</annotation></semantics></math>
defined as
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">Z=1</annotation></semantics></math>
if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>=</mo><mn>2</mn></mrow><annotation encoding="application/x-tex">Y=2</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi><mo>=</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">Z=0</annotation></semantics></math>
if
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">Y=1</annotation></semantics></math>
with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Z</mi><mo>∼</mo><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>p</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">Z\sim b(p)</annotation></semantics></math>
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>b</mi><mrow><mo stretchy="true" form="prefix">(</mo><mo>⋅</mo><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">b(\cdot)</annotation></semantics></math>
is the Bernoulli distribution and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>
can be modeled for each unit
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">logit</mtext><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>p</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><mo>ln</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>λ</mi><mi>k</mi></msub><mi>/</mi><mn>2</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{logit}(p_k)=\ln(\lambda_k/2)</annotation></semantics></math>
with Poisson parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>λ</mi><mi>k</mi></msub><mo>=</mo><msub><mi>𝐱</mi><mi>k</mi></msub><mi>𝛃</mi></mrow><annotation encoding="application/x-tex">\lambda_k=\boldsymbol{x}_{k}\boldsymbol{\beta}</annotation></semantics></math>
(for a covariate extension see <span class="citation">Böhning et al. (<a href="#ref-chao-generalization">2013</a>)</span> and <span class="citation">Böhning and Heijden (<a href="#ref-zelterman">2009</a>)</span>):</li>
</ul>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>N</mi><mo accent="true">̂</mo></mover><mtext mathvariant="normal">Chao</mtext></msub><mo>=</mo><msub><mi>N</mi><mrow><mi>o</mi><mi>b</mi><mi>s</mi></mrow></msub><mo>+</mo><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><mrow><msub><mi>𝐟</mi><mn>1</mn></msub><mo>+</mo><msub><mi>𝐟</mi><mn>2</mn></msub></mrow></munderover><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>𝐱</mi><mi>k</mi></msub><mover><mi>𝛃</mi><mo accent="true">̂</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mn>2</mn><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>2</mn><msub><mi>𝐱</mi><mi>k</mi></msub><mover><mi>𝛃</mi><mo accent="true">̂</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>,</mo></mrow><annotation encoding="application/x-tex">
\hat{N}_{\text{Chao}} = N_{obs}+
\sum_{k=1}^{\boldsymbol{f}_{1}+\boldsymbol{f}_{2}}
\left(2\exp\left(\boldsymbol{x}_{k}\hat{\boldsymbol{\beta}}\right)+
2\exp\left(2\boldsymbol{x}_{k}\hat{\boldsymbol{\beta}}\right)\right)^{-1},
\tag{Chao's estimator}
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mover><mi>N</mi><mo accent="true">̂</mo></mover><mtext mathvariant="normal">Zelt</mtext></msub><mo>=</mo><munderover><mo>∑</mo><mrow><mi>k</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>N</mi><mrow><mi>o</mi><mi>b</mi><mi>s</mi></mrow></msub></munderover><msup><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><mo>−</mo><mn>2</mn><mo>exp</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>𝐱</mi><mi>k</mi></msub><mover><mi>𝛃</mi><mo accent="true">̂</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><mi>.</mi></mrow><annotation encoding="application/x-tex">
\hat{N}_{\text{Zelt}}=\sum_{k=1}^{N_{obs}}
\left(1-\exp\left(-2\exp\left(\boldsymbol{x}_{k}\hat{\boldsymbol{\beta}}\right)\right)\right)^{-1}.
\tag{Zelterman's estimator}
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐟</mi><mn>1</mn></msub><annotation encoding="application/x-tex">\boldsymbol{f}_{1}</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐟</mi><mn>2</mn></msub><annotation encoding="application/x-tex">\boldsymbol{f}_{2}</annotation></semantics></math>
denotes number of units observed once and twice.</p>
<ul>
<li>Zero-truncated
(<code>zt</code><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>*</mo></msup><annotation encoding="application/x-tex">^\ast</annotation></semantics></math>)
and zero-one-truncated
(<code>zot</code><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>*</mo></msup><annotation encoding="application/x-tex">^\ast</annotation></semantics></math>)
Poisson <span class="citation">(<a href="#ref-zotmodels">Böhning and
Heijden 2019</a>)</span>, geometric, NB type II (NB2) regression, where
the non-truncated distribution is parameterized as:</li>
</ul>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo>=</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><mi>λ</mi><mo>,</mo><mi>α</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mfrac><mrow><mi>Γ</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo>+</mo><msup><mi>α</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mi>Γ</mi><mrow><mo stretchy="true" form="prefix">(</mo><msup><mi>α</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo stretchy="true" form="postfix">)</mo></mrow><mi>y</mi><mi>!</mi></mrow></mfrac><msup><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><msup><mi>α</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mrow><msup><mi>α</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup><mo>+</mo><mi>λ</mi></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><msup><mi>α</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></msup><msup><mrow><mo stretchy="true" form="prefix">(</mo><mfrac><mi>λ</mi><mrow><mi>λ</mi><mo>+</mo><msup><mi>α</mi><mrow><mo>−</mo><mn>1</mn></mrow></msup></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow><mi>y</mi></msup><mi>.</mi></mrow><annotation encoding="application/x-tex">
\mathbb{P}[Y=y|\lambda,\alpha] = \frac{\Gamma\left(y+\alpha^{-1}\right)}{\Gamma\left(\alpha^{-1}\right)y!}
\left(\frac{\alpha^{-1}}{\alpha^{-1}+\lambda}\right)^{\alpha^{-1}}
\left(\frac{\lambda}{\lambda + \alpha^{-1}}\right)^{y}.
</annotation></semantics></math></p>
<ul>
<li>Zero-truncated one-inflated
(<code>ztoi</code><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>*</mo></msup><annotation encoding="application/x-tex">^\ast</annotation></semantics></math>)
modifications, where the count data variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>Y</mi><mo>*</mo></msup><annotation encoding="application/x-tex">Y^{\ast}</annotation></semantics></math>
is defined such that its distribution statisfies:</li>
</ul>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><msup><mi>Y</mi><mo>*</mo></msup><mo>=</mo><mi>y</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo>=</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mi>y</mi><mo>=</mo><mn>0</mn><mo>,</mo></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mi>ω</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo>=</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>ω</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo>=</mo><mn>1</mn><mo stretchy="true" form="postfix">]</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>ω</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo>=</mo><mi>y</mi><mo stretchy="true" form="postfix">]</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mi>y</mi><mo>&gt;</mo><mn>1</mn><mo>,</mo></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">
\mathbb{P}\left[Y^{\ast}=y\right]=
\begin{cases}
\mathbb{P}[Y=0] &amp; y=0, \\
\omega\left(1-\mathbb{P}[Y=0]\right)+(1-\omega)\mathbb{P}[Y=1] &amp; y=1, \\
(1-\omega)\mathbb{P}[Y=y] &amp; y&gt;1,
\end{cases}
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><msup><mi>Y</mi><mo>*</mo></msup><mo>=</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><msup><mi>Y</mi><mo>*</mo></msup><mo>&gt;</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mi>ω</mi><msub><mi>ℐ</mi><mrow><mo stretchy="false" form="prefix">{</mo><mn>1</mn><mo stretchy="false" form="postfix">}</mo></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>ω</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo>=</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><mi>Y</mi><mo>&gt;</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow><mi>.</mi></mrow><annotation encoding="application/x-tex">
\mathbb{P}\left[Y^{\ast}=y|Y^{\ast}&gt;0\right]=\omega\mathcal{I}_{\{1\}}(y)+(1-\omega)\mathbb{P}[Y=y|Y&gt;0].
</annotation></semantics></math></p>
<ul>
<li>One-inflated zero-truncated
(<code>oizt</code><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>*</mo></msup><annotation encoding="application/x-tex">^\ast</annotation></semantics></math>)
modifications, where the count data variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>Y</mi><mo>*</mo></msup><annotation encoding="application/x-tex">Y^{\ast}</annotation></semantics></math>
is defined as:</li>
</ul>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><msup><mi>Y</mi><mo>*</mo></msup><mo>=</mo><mi>y</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mi>ω</mi><msub><mi>ℐ</mi><mrow><mo stretchy="false" form="prefix">{</mo><mn>1</mn><mo stretchy="false" form="postfix">}</mo></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>ω</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo>=</mo><mi>y</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>,</mo></mrow><annotation encoding="application/x-tex">
\mathbb{P}\left[Y^{\ast}=y\right] = \omega \mathcal{I}_{\{1\}}(y)+(1-\omega)\mathbb{P}[Y=y],
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><msup><mi>Y</mi><mo>*</mo></msup><mo>=</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><msup><mi>Y</mi><mo>*</mo></msup><mo>&gt;</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mi>ω</mi><mfrac><mrow><msub><mi>ℐ</mi><mrow><mo stretchy="false" form="prefix">{</mo><mn>1</mn><mo stretchy="false" form="postfix">}</mo></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><mrow><mn>1</mn><mo>−</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>ω</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo>=</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow></mfrac><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>ω</mi><mo stretchy="true" form="postfix">)</mo></mrow><mfrac><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo>=</mo><mi>y</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow><mrow><mn>1</mn><mo>−</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>ω</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo>=</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow></mfrac><mi>.</mi></mrow><annotation encoding="application/x-tex">
\mathbb{P}\left[Y^{\ast}=y|Y^{\ast}&gt;0\right] = 
\omega\frac{\mathcal{I}_{\{1\}}(y)}{1-(1-\omega)\mathbb{P}[Y=0]}+
(1-\omega)\frac{\mathbb{P}[Y=y]}{1-(1-\omega)\mathbb{P}[Y=0]}.
</annotation></semantics></math></p>
<p>Note that
<code>ztoi</code><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>*</mo></msup><annotation encoding="application/x-tex">^\ast</annotation></semantics></math>
and
<code>oizt</code><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>*</mo></msup><annotation encoding="application/x-tex">^\ast</annotation></semantics></math>
distributions are equivalent, in the sense that the maximum value of the
likelihood function is equal for both of those distributions given any
data, as shown by <span class="citation">(<a href="#ref-bohning2023equivalence">Böhning 2023</a>)</span> but
population size estimators are different.</p>
<p>In addition, we propose two new approaches to model singletons in a
similar way as in hurdle models. In particular, we have proposed the
following:</p>
<ul>
<li>The zero-truncated hurdle model (<code>ztHurdle</code>*) for
Poisson, geometric and NB2 is defined as:</li>
</ul>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><msup><mi>Y</mi><mo>*</mo></msup><mo>=</mo><mi>y</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mfrac><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo>=</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow><mrow><mn>1</mn><mo>−</mo><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo>=</mo><mn>1</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow></mfrac></mtd><mtd columnalign="left" style="text-align: left"><mi>y</mi><mo>=</mo><mn>0</mn><mo>,</mo></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mi>π</mi><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo>=</mo><mn>1</mn><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>π</mi><mo stretchy="true" form="postfix">)</mo></mrow><mfrac><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo>=</mo><mi>y</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow><mrow><mn>1</mn><mo>−</mo><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo>=</mo><mn>1</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow></mfrac></mtd><mtd columnalign="left" style="text-align: left"><mi>y</mi><mo>&gt;</mo><mn>1</mn><mo>,</mo></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">
\mathbb{P}[Y^{\ast}=y]=\begin{cases}
\frac{\mathbb{P}[Y=0]}{1-\mathbb{P}[Y=1]} &amp; y=0, \\
\pi(1-\mathbb{P}[Y=1]) &amp; y=1, \\
(1-\pi) \frac{\mathbb{P}[Y=y]}{1-\mathbb{P}[Y=1]} &amp; y&gt;1,
\end{cases}
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><msup><mi>Y</mi><mo>*</mo></msup><mo>=</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><msup><mi>Y</mi><mo>*</mo></msup><mo>&gt;</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mi>π</mi><msub><mn>𝟏</mn><mrow><mo stretchy="false" form="prefix">{</mo><mn>1</mn><mo stretchy="false" form="postfix">}</mo></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>+</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>π</mi><mo stretchy="true" form="postfix">)</mo></mrow><msub><mn>𝟏</mn><mrow><mi>ℕ</mi><mo>\</mo><mo stretchy="false" form="prefix">{</mo><mn>1</mn><mo stretchy="false" form="postfix">}</mo></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><mi>y</mi><mo stretchy="true" form="postfix">)</mo></mrow><mfrac><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo>=</mo><mi>y</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow><mrow><mn>1</mn><mo>−</mo><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo>=</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow><mo>−</mo><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo>=</mo><mn>1</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow></mfrac><mi>.</mi></mrow><annotation encoding="application/x-tex">
\mathbb{P}[Y^{\ast}=y|Y^{\ast}&gt;0]=\pi\mathbf{1}_{\{1\}}(y)+
(1-\pi)\mathbf{1}_{\mathbb{N}\setminus\{1\}}(y)\frac{\mathbb{P}[Y=y]}{1-\mathbb{P}[Y=0]-\mathbb{P}[Y=1]}.
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>π</mi><annotation encoding="application/x-tex">\pi</annotation></semantics></math>
denotes the conditional probability of observing singletons.</p>
<ul>
<li>The hurdle zero-truncated model (<code>Hurdlezt</code>*) for
Poisson, geometric and NB2 is defined as:</li>
</ul>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><msup><mi>Y</mi><mo>*</mo></msup><mo>=</mo><mi>y</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mi>π</mi></mtd><mtd columnalign="left" style="text-align: left"><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>π</mi><mo stretchy="true" form="postfix">)</mo></mrow><mfrac><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo>=</mo><mi>y</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow><mrow><mn>1</mn><mo>−</mo><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo>=</mo><mn>1</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow></mfrac></mtd><mtd columnalign="left" style="text-align: left"><mi>y</mi><mo>≠</mo><mn>1</mn><mo>,</mo></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">
\mathbb{P}[Y^{\ast}=y]=\begin{cases}
\pi &amp; y=1, \\
(1-\pi) \frac{\mathbb{P}[Y=y]}{1-\mathbb{P}[Y=1]} &amp; y\neq1,
\end{cases}
</annotation></semantics></math></p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><msup><mi>Y</mi><mo>*</mo></msup><mo>=</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><msup><mi>Y</mi><mo>*</mo></msup><mo>&gt;</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mi>π</mi><mfrac><mrow><mn>1</mn><mo>−</mo><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo>=</mo><mn>1</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow><mrow><mn>1</mn><mo>−</mo><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo>=</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow><mo>−</mo><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo>=</mo><mn>1</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow></mfrac></mtd><mtd columnalign="left" style="text-align: left"><mi>y</mi><mo>=</mo><mn>1</mn><mo>,</mo></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mrow><mo stretchy="true" form="prefix">(</mo><mn>1</mn><mo>−</mo><mi>π</mi><mo stretchy="true" form="postfix">)</mo></mrow><mfrac><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo>=</mo><mi>y</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow><mrow><mn>1</mn><mo>−</mo><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo>=</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow><mo>−</mo><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo>=</mo><mn>1</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow></mfrac></mtd><mtd columnalign="left" style="text-align: left"><mi>y</mi><mo>&gt;</mo><mn>1</mn><mo>,</mo></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">
\mathbb{P}[Y^{\ast}=y|Y^{\ast}&gt;0]=\begin{cases}
\pi\frac{1-\mathbb{P}[Y=1]}{1-\mathbb{P}[Y=0]-\mathbb{P}[Y=1]} &amp; y=1,\\
(1-\pi)\frac{\mathbb{P}[Y=y]}{1-\mathbb{P}[Y=0]-\mathbb{P}[Y=1]} &amp; y&gt;1,
\end{cases}
</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>π</mi><annotation encoding="application/x-tex">\pi</annotation></semantics></math>
denotes the unconditional probability of observing singletons.</p>
<p>The approaches presented above differ in their assumptions,
computational complexity, or in the way they treat heterogeneity of
captures and singletons. For instance, the dispersion parameter
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
in the NB2 type models is often interpreted as measuring the
<code>severity</code> of unobserved heterogeneity in the underlying
Poisson process <span class="citation">(<a href="#ref-ztnegbin">Cruyff
and Heijden 2008</a>)</span>. When using any truncated NB model, the
hope is that given the class of models considered, the consistency is
not lost despite the lack of information.</p>
<p>While not discussed in the literature, the interpretation of
heterogeneous
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>α</mi><annotation encoding="application/x-tex">\alpha</annotation></semantics></math>
across the population (specified in <code>controlModel</code>) would be
that the unobserved heterogeneity affects the accuracy of the prediction
for the dependent variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
more severely than others. The geometric model (NB with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>α</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">\alpha=1</annotation></semantics></math>)
is singled out in the package and often considered in the literature
because of inherent computational issues with NB models, which are
exacerbated by the fact that data used for SSCR are usually of rather
low quality. Data sparsity is a particularly common problem in SSCR and
a big challenge for all numerical methods for fitting the
(zero-truncated) NB model.</p>
<p>The extra mass
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ω</mi><annotation encoding="application/x-tex">\omega</annotation></semantics></math>
in one-inflated models is an important extension to the researcher’s
toolbox for SSCR models, since the inflation at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>y</mi><mo>=</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">y=1</annotation></semantics></math>
is likely to occur in many types of applications. For example, when
estimating the number of active people who committed criminal acts in a
given time period, the fact of being captured for the first time
following an arrest is associated with the risk of no longer being able
to be captured a second time. One constraint present in modelling via
inflated models is that attempts to include both the possibility of one
inflation and one deflation lead to both numerical and inferential
problems since the parameter space (of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>ω</mi><mo>,</mo><mi>λ</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\omega, \lambda)</annotation></semantics></math>
or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="true" form="prefix">(</mo><mi>ω</mi><mo>,</mo><mi>λ</mi><mo>,</mo><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow><annotation encoding="application/x-tex">(\omega, \lambda, \alpha)</annotation></semantics></math>)
is then given by
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">{</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>ω</mi><mo>,</mo><mi>λ</mi><mo>,</mo><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo stretchy="false" form="prefix">|</mo><mo>∀</mo><mi>x</mi><mo>∈</mo><mi>ℕ</mi><mo>:</mo><mi>p</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>x</mi><mo stretchy="false" form="prefix">|</mo><mi>ω</mi><mo>,</mo><mi>λ</mi><mo>,</mo><mi>α</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>≥</mo><mn>0</mn><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\{(\omega, \lambda, \alpha) | \forall x\in \mathbb{N}: p(x|\omega, \lambda, \alpha)\geq0\}</annotation></semantics></math>
for the probability mass function
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>p</mi><annotation encoding="application/x-tex">p</annotation></semantics></math>.
The boundary of this set is then a
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1</mn><annotation encoding="application/x-tex">1</annotation></semantics></math>
or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mn>2</mn><mo>−</mo></mrow><annotation encoding="application/x-tex">2-</annotation></semantics></math>dimentional
manifold, transforming this parameter space into
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>ℝ</mi><mn>3</mn></msup><annotation encoding="application/x-tex">\mathbb{R}^{3}</annotation></semantics></math>
would require using <code>link</code> functions that depend on more than
one parameter.</p>
<p>Hurdle models represent another approach to modelling one-inflation.
They can also model deflation as well as inflation and deflation
simultaneously, so they are more flexible and, in the case of hurdle
zero-truncated models, appear to be more numerically stable.</p>
<p>Although the question of how to interpret regression parameters tends
to be somewhat overlooked in SSCR studies, we should point out that the
interpretation of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ω</mi><annotation encoding="application/x-tex">\omega</annotation></semantics></math>
inflation parameter (in
<code>ztoi</code><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>*</mo></msup><annotation encoding="application/x-tex">^\ast</annotation></semantics></math>
or
<code>oizt</code><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>*</mo></msup><annotation encoding="application/x-tex">^\ast</annotation></semantics></math>)
is more convenient than the interpretation of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>π</mi><annotation encoding="application/x-tex">\pi</annotation></semantics></math>
probability parameter (in hurdle models). Additionally, the
interpretation of the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
parameter in (one) inflated models conforms to the following intuition:
given that unit
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>
comes from the non-inflated part of the population, it follows a Poisson
distribution (respectively geometric or negative binomial) with the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
parameter (or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mo>,</mo><mi>α</mi></mrow><annotation encoding="application/x-tex">\lambda,\alpha</annotation></semantics></math>);
no such interpretation exists for hurdle models. Interestingly,
estimates from hurdle zero-truncated and one-inflated zero-truncated
models tend to be quite close to one another, although more rigorous
studies are required to confirm this observation.</p>
</div>
<div class="section level3">
<h3 id="fitting-method">Fitting method<a class="anchor" aria-label="anchor" href="#fitting-method"></a>
</h3>
<p>As previously noted, the <strong>singleRcapture</strong> package can
be used to model the (linear) dependence of all parameters on
covariates. A modified IRLS algorithm is employed for this purpose as
presented in Algorithm 1; full details are available in <span class="citation">T. Yee (<a href="#ref-VGAM-main">2015</a>)</span>. In
order to apply the algorithm, a modified model matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐗</mi><mtext mathvariant="normal">vlm</mtext></msub><annotation encoding="application/x-tex">\boldsymbol{X}_{\text{vlm}}</annotation></semantics></math>
is created when the <code>estimatePopsize</code> function is called. In
the context of the models implemented in
<strong>singleRcapture</strong>, this matrix can be written as:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>𝐗</mi><mtext mathvariant="normal">vlm</mtext></msub><mo>=</mo><mrow><mo stretchy="true" form="prefix">(</mo><mtable><mtr><mtd columnalign="center" style="text-align: center"><msub><mi>𝐗</mi><mn>1</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><mn>𝟎</mn></mtd><mtd columnalign="center" style="text-align: center"><mi>…</mi></mtd><mtd columnalign="center" style="text-align: center"><mn>𝟎</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mn>𝟎</mn></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>𝐗</mi><mn>2</mn></msub></mtd><mtd columnalign="center" style="text-align: center"><mi>…</mi></mtd><mtd columnalign="center" style="text-align: center"><mn>𝟎</mn></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mi>⋮</mi></mtd><mtd columnalign="center" style="text-align: center"><mi>⋮</mi></mtd><mtd columnalign="center" style="text-align: center"><mo>⋱</mo></mtd><mtd columnalign="center" style="text-align: center"><mi>⋮</mi></mtd></mtr><mtr><mtd columnalign="center" style="text-align: center"><mn>𝟎</mn></mtd><mtd columnalign="center" style="text-align: center"><mn>𝟎</mn></mtd><mtd columnalign="center" style="text-align: center"><mi>…</mi></mtd><mtd columnalign="center" style="text-align: center"><msub><mi>𝐗</mi><mi>p</mi></msub></mtd></mtr></mtable><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">
\begin{equation}\label{X_vlm-definition}
  \boldsymbol{X}_{\text{vlm}}=
  \begin{pmatrix}
    \boldsymbol{X}_{1} &amp; \boldsymbol{0} &amp;\dotso &amp;\boldsymbol{0}\\
    \boldsymbol{0} &amp; \boldsymbol{X}_{2} &amp;\dotso &amp;\boldsymbol{0}\\
    \vdots &amp; \vdots &amp; \ddots &amp; \vdots\\
    \boldsymbol{0} &amp; \boldsymbol{0} &amp;\dotso &amp;\boldsymbol{X}_{p}
  \end{pmatrix}
\end{equation}
</annotation></semantics></math></p>
<p>where each
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐗</mi><mi>i</mi></msub><annotation encoding="application/x-tex">\boldsymbol{X}_{i}</annotation></semantics></math>
corresponds to a model matrix associated with a user specified
formula.</p>
<div class="section level4">
<h4 id="algorithm-1-the-modified-irls-algorithm-used-in-the-singlercapture-package">Algorithm 1: The modified IRLS algorithm used in the
<strong>singleRcapture</strong> package<a class="anchor" aria-label="anchor" href="#algorithm-1-the-modified-irls-algorithm-used-in-the-singlercapture-package"></a>
</h4>
<ol style="list-style-type: decimal">
<li><p>Initialize with <code>iter</code> ← 1,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛈</mi><annotation encoding="application/x-tex">\boldsymbol{\eta}</annotation></semantics></math>
← <code>start</code>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐖</mi><annotation encoding="application/x-tex">\boldsymbol{W}</annotation></semantics></math>
← I,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>ℓ</mo><annotation encoding="application/x-tex">\ell</annotation></semantics></math>
←
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>ℓ</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛃</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\ell(\boldsymbol{\beta})</annotation></semantics></math></p></li>
<li>
<p>Store values from the previous step:<br><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mo>ℓ</mo><mo>−</mo></msub><annotation encoding="application/x-tex">\ell_{-}</annotation></semantics></math>
←
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>ℓ</mo><annotation encoding="application/x-tex">\ell</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐖</mi><mo>−</mo></msub><annotation encoding="application/x-tex">\boldsymbol{W}_{-}</annotation></semantics></math>
←
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐖</mi><annotation encoding="application/x-tex">\boldsymbol{W}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝛃</mi><mo>−</mo></msub><annotation encoding="application/x-tex">\boldsymbol{\beta}_{-}</annotation></semantics></math>
←
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛃</mi><annotation encoding="application/x-tex">\boldsymbol{\beta}</annotation></semantics></math>
(the last assignment is omitted during the first iteration), and assign
values in the current iteration:</p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛈</mi><annotation encoding="application/x-tex">\displaystyle\boldsymbol{\eta}</annotation></semantics></math>
←
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>𝐗</mi><mtext mathvariant="normal">vlm</mtext></msub><mi>𝛃</mi><mo>+</mo><mi>𝐨</mi></mrow><annotation encoding="application/x-tex">\boldsymbol{X}_{\text{vlm}}\boldsymbol{\beta}+\boldsymbol{o}</annotation></semantics></math></p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐖</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mo stretchy="true" form="postfix">)</mo></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{W}_{(k)}</annotation></semantics></math>
←
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝔼</mi><mrow><mo stretchy="true" form="prefix">[</mo><mo>−</mo><mfrac><mrow><msup><mi>∂</mi><mn>2</mn></msup><mo>ℓ</mo></mrow><mrow><mi>∂</mi><msubsup><mi>𝛈</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>⊤</mi></msubsup><mi>∂</mi><msub><mi>𝛈</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mo stretchy="true" form="postfix">)</mo></mrow></msub></mrow></mfrac><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbb{E}\left[-\frac{\partial^{2}\ell}{\partial\boldsymbol{\eta}_{(k)}^\top\partial\boldsymbol{\eta}_{(k)}}\right]</annotation></semantics></math></p>
<p><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐙</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mo stretchy="true" form="postfix">)</mo></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{Z}_{(k)}</annotation></semantics></math>
←
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>𝛈</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mo stretchy="true" form="postfix">)</mo></mrow></msub><mo>+</mo><mfrac><mrow><mi>∂</mi><mo>ℓ</mo></mrow><mrow><mi>∂</mi><msub><mi>𝛈</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mo stretchy="true" form="postfix">)</mo></mrow></msub></mrow></mfrac><msubsup><mi>𝐖</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msubsup><mo>−</mo><msub><mi>𝐨</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mo stretchy="true" form="postfix">)</mo></mrow></msub></mrow><annotation encoding="application/x-tex">\boldsymbol{\eta}_{(k)}+\frac{\partial\ell}{\partial\boldsymbol{\eta}_{(k)}}\boldsymbol{W}_{(k)}^{-1}-\boldsymbol{o}_{(k)}</annotation></semantics></math></p>
<p>where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐨</mi><annotation encoding="application/x-tex">\boldsymbol{o}</annotation></semantics></math>
denotes offset.</p>
</li>
<li><p>Assign the current coefficient value:<br><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛃</mi><annotation encoding="application/x-tex">\boldsymbol{\beta}</annotation></semantics></math>
←
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>𝐗</mi><mtext mathvariant="normal">vlm</mtext></msub><mi>𝐖</mi><msub><mi>𝐗</mi><mtext mathvariant="normal">vlm</mtext></msub><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><msub><mi>𝐗</mi><mtext mathvariant="normal">vlm</mtext></msub><mi>𝐖</mi><mi>𝐙</mi></mrow><annotation encoding="application/x-tex">\left(\boldsymbol{X}_{\text{vlm}}\boldsymbol{W}\boldsymbol{X}_{\text{vlm}}\right)^{-1}\boldsymbol{X}_{\text{vlm}}\boldsymbol{W}\boldsymbol{Z}</annotation></semantics></math></p></li>
<li><p>If
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>ℓ</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛃</mi><mo stretchy="true" form="postfix">)</mo></mrow><mo>&lt;</mo><mo>ℓ</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>𝛃</mi><mo>−</mo></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\ell(\boldsymbol{\beta})&lt;\ell(\boldsymbol{\beta}_{-})</annotation></semantics></math>
try selecting the smallest value
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>h</mi><annotation encoding="application/x-tex">h</annotation></semantics></math>
such that for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝛃</mi><mi>h</mi></msub><annotation encoding="application/x-tex">\boldsymbol{\beta}_{h}</annotation></semantics></math>
←
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msup><mn>2</mn><mrow><mo>−</mo><mi>h</mi></mrow></msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛃</mi><mo>+</mo><msub><mi>𝛃</mi><mo>−</mo></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">2^{-h}\left(\boldsymbol{\beta}+\boldsymbol{\beta}_{-}\right)</annotation></semantics></math>
the inequality
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>ℓ</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>𝛃</mi><mi>h</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>&gt;</mo><mo>ℓ</mo><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>𝛃</mi><mo>−</mo></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\ell(\boldsymbol{\beta}_{h})&gt;\ell(\boldsymbol{\beta}_{-})</annotation></semantics></math>
holds if this is successful
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛃</mi><annotation encoding="application/x-tex">\boldsymbol{\beta}</annotation></semantics></math>
←
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝛃</mi><mi>h</mi></msub><annotation encoding="application/x-tex">\boldsymbol{\beta}_{h}</annotation></semantics></math>,
else stop the algorithm.</p></li>
<li><p>If convergence is achieved or <code>iter</code> is higher than
<code>maxiter</code>, stop the algorithm, else <code>iter</code> ← 1 +
<code>iter</code> and return to step 2.</p></li>
</ol>
<p>In the case of multi-parameter families, we get a matrix of linear
predictors
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛈</mi><annotation encoding="application/x-tex">\boldsymbol{\eta}</annotation></semantics></math>
instead of a vector, with the number of columns matching the number of
parameters in the distribution. “Weights” (matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐖</mi><annotation encoding="application/x-tex">\boldsymbol{W}</annotation></semantics></math>)
are then modified to be information matrices
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝔼</mi><mrow><mo stretchy="true" form="prefix">[</mo><mo>−</mo><mfrac><mrow><msup><mi>∂</mi><mn>2</mn></msup><mo>ℓ</mo></mrow><mrow><mi>∂</mi><msubsup><mi>𝛈</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mo stretchy="true" form="postfix">)</mo></mrow><mi>⊤</mi></msubsup><mi>∂</mi><msub><mi>𝛈</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mo stretchy="true" form="postfix">)</mo></mrow></msub></mrow></mfrac><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\displaystyle\mathbb{E}\left[-\frac{\partial^{2}\ell}{\partial\boldsymbol{\eta}_{(k)}^\top\partial\boldsymbol{\eta}_{(k)}}\right]</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mo>ℓ</mo><annotation encoding="application/x-tex">\ell</annotation></semantics></math>
is the log-likelihood function and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝛈</mi><mrow><mo stretchy="true" form="prefix">(</mo><mi>k</mi><mo stretchy="true" form="postfix">)</mo></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{\eta}_{(k)}</annotation></semantics></math>
is the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>k</mi><annotation encoding="application/x-tex">k</annotation></semantics></math>-th
row of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛈</mi><annotation encoding="application/x-tex">\boldsymbol{\eta}</annotation></semantics></math>,
while in the typical IRLS they are scalars
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝔼</mi><mrow><mo stretchy="true" form="prefix">[</mo><mo>−</mo><mfrac><mrow><msup><mi>∂</mi><mn>2</mn></msup><mo>ℓ</mo></mrow><mrow><mi>∂</mi><msubsup><mi>η</mi><mi>k</mi><mn>2</mn></msubsup></mrow></mfrac><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\displaystyle\mathbb{E}\left[-\frac{\partial^{2}\ell}{\partial\eta_{k}^{2}}\right]</annotation></semantics></math>,
which is often just
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>−</mo><mfrac><mrow><msup><mi>∂</mi><mn>2</mn></msup><mo>ℓ</mo></mrow><mrow><mi>∂</mi><msup><mi>η</mi><mn>2</mn></msup></mrow></mfrac></mrow><annotation encoding="application/x-tex">\displaystyle-\frac{\partial^{2}\ell}{\partial\eta^{2}}</annotation></semantics></math>.</p>
</div>
</div>
<div class="section level3">
<h3 id="sec-boostrap">Bootstrap variance estimators<a class="anchor" aria-label="anchor" href="#sec-boostrap"></a>
</h3>
<p>We have implemented three types of bootstrap algorithms: parametric
(adapted from theory in <span class="citation">Zwane and Van der Heijden
(<a href="#ref-zwane">2003</a>)</span>, <span class="citation">Norris
and Pollock (<a href="#ref-norrpoll">1996</a>)</span> for multiple
source setting with covariates), semi-parametric (see e.g. <span class="citation">Böhning and Friedl (<a href="#ref-BoehningFriedl2021">2021</a>)</span>) and nonparametric. The
nonparametric version is the usual bootstrap algorithm; which will
typically underestimate the variance of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>N</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{N}</annotation></semantics></math>.
In this section, the focus is on the first two approaches.</p>
<p>The idea of semi-parametric bootstrap is to modify the usual
bootstrap to include the additional uncertainty resulting from the fact
that the sample size is a random variable. This type of bootstrap is
performed in steps listed in Algorithm 2.</p>
<div class="section level4">
<h4 id="algorithm-2-semi-parametric-bootstrap">Algorithm 2: Semi-parametric bootstrap<a class="anchor" aria-label="anchor" href="#algorithm-2-semi-parametric-bootstrap"></a>
</h4>
<ol style="list-style-type: decimal">
<li>Draw a sample of size
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mrow><mi>o</mi><mi>b</mi><mi>s</mi></mrow></msub><mi>′</mi><mo>∼</mo><mtext mathvariant="normal">Binomial</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>N</mi><mi>′</mi><mo>,</mo><mfrac><msub><mi>N</mi><mrow><mi>o</mi><mi>b</mi><mi>s</mi></mrow></msub><mrow><mi>N</mi><mi>′</mi></mrow></mfrac><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">N_{obs}'\sim\text{Binomial}\left(N', \frac{N_{obs}}{N'}\right)</annotation></semantics></math>,
where
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>N</mi><mi>′</mi><mo>=</mo><mo stretchy="false" form="prefix">⌊</mo><mover><mi>N</mi><mo accent="true">̂</mo></mover><mo stretchy="false" form="postfix">⌋</mo><mo>+</mo><mtext mathvariant="normal">Bernoulli</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="false" form="prefix">⌊</mo><mover><mi>N</mi><mo accent="true">̂</mo></mover><mo stretchy="false" form="postfix">⌋</mo><mo>−</mo><mover><mi>N</mi><mo accent="true">̂</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">N'=\lfloor\hat{N}\rfloor+\text{Bernoulli}\left(\lfloor\hat{N}\rfloor-\hat{N}\right)</annotation></semantics></math>
</li>
<li>Draw
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msub><mi>N</mi><mrow><mi>o</mi><mi>b</mi><mi>s</mi></mrow></msub><mi>′</mi></mrow><annotation encoding="application/x-tex">N_{obs}'</annotation></semantics></math>
units from the data uniformly without replacement</li>
<li>Obtain a new population size estimate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mi>b</mi></msub><annotation encoding="application/x-tex">N_b</annotation></semantics></math>
using bootstrap data</li>
<li>Repeat 1-3 steps
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>B</mi><annotation encoding="application/x-tex">B</annotation></semantics></math>
times</li>
</ol>
<p>In other words, we first draw a sample size and then a sample
conditional on the sample size. Note that when using the semi-parametric
bootstrap one implicitly assumes that the population size estimate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>N</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{N}</annotation></semantics></math>
is accurate. The last implemented bootstrap type is the parametric
algorithm, which first draws a finite population of size
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>≈</mo><mover><mi>N</mi><mo accent="true">̂</mo></mover></mrow><annotation encoding="application/x-tex">\approx\hat{N}</annotation></semantics></math>
from the superpopulation model and then samples from this population
according to the selected model, as described in Algorithm 3.</p>
</div>
<div class="section level4">
<h4 id="algorithm-3-parametric-bootstrap">Algorithm 3: Parametric bootstrap<a class="anchor" aria-label="anchor" href="#algorithm-3-parametric-bootstrap"></a>
</h4>
<ol style="list-style-type: decimal">
<li>Draw the number of covariates equal to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo stretchy="false" form="prefix">⌊</mo><mover><mi>N</mi><mo accent="true">̂</mo></mover><mo stretchy="false" form="postfix">⌋</mo><mo>+</mo><mtext mathvariant="normal">Bernoulli</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mo stretchy="false" form="prefix">⌊</mo><mover><mi>N</mi><mo accent="true">̂</mo></mover><mo stretchy="false" form="postfix">⌋</mo><mo>−</mo><mover><mi>N</mi><mo accent="true">̂</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\lfloor\hat{N}\rfloor+\text{Bernoulli}\left(\lfloor\hat{N}\rfloor-\hat{N}\right)</annotation></semantics></math>
proportional to the estimated contribution
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mrow><mo stretchy="true" form="prefix">(</mo><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Y</mi><mi>k</mi></msub><mo>&gt;</mo><mn>0</mn><mo stretchy="false" form="prefix">|</mo><msub><mi>𝐱</mi><mi>k</mi></msub><mo stretchy="true" form="postfix">]</mo></mrow><mo stretchy="true" form="postfix">)</mo></mrow><mrow><mo>−</mo><mn>1</mn></mrow></msup><annotation encoding="application/x-tex">(\mathbb{P}\left[Y_{k}&gt;0|\boldsymbol{x}_{k}\right])^{-1}</annotation></semantics></math>
with replacement</li>
<li>Using the fitted model and regression coefficients
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>𝛃</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{\boldsymbol{\beta}}</annotation></semantics></math>
draw for each covariate the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
value from the corresponding probability measure on
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ℕ</mi><mo>∪</mo><mo stretchy="false" form="prefix">{</mo><mn>0</mn><mo stretchy="false" form="postfix">}</mo></mrow><annotation encoding="application/x-tex">\mathbb{N}\cup\{0\}</annotation></semantics></math>
</li>
<li>Truncate units with the drawn
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
value equal to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0</mn><annotation encoding="application/x-tex">0</annotation></semantics></math>
</li>
<li>Obtain a population size estimate
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>N</mi><mi>b</mi></msub><annotation encoding="application/x-tex">N_b</annotation></semantics></math>
based on the truncated data</li>
<li>Repeat 1-4 steps
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>B</mi><annotation encoding="application/x-tex">B</annotation></semantics></math>
times</li>
</ol>
<p>Note that in order for this type of algorithm to result in consistent
standard error estimates, it is imperative that the estimated model for
the entire superpopulation probability space is consistent, which may be
much less realistic than in the case of the semi-parametric bootstrap.
The parametric bootstrap algorithm is the default option in
<strong>singleRcapture</strong>.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="sec-main">The main function<a class="anchor" aria-label="anchor" href="#sec-main"></a>
</h2>
<div class="section level3">
<h3 id="the-estimatepopsize-function">The <code>estimatePopsize</code> function<a class="anchor" aria-label="anchor" href="#the-estimatepopsize-function"></a>
</h3>
<p>The <strong>singleRcapture</strong> package is built around the
<code>estimatePopsize</code> function. The main design objective was to
make using <code>estimatePopsize</code> as similar as possible to the
standard <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">stats::glm</a></code> function or packages for fitting
zero-truncated regression models, such as <strong>countreg</strong>
(e.g. <code>countreg::zerotrunc</code> function). The
<code>estimatePopsize</code> function is used to first fit an
appropriate (vector) generalized linear model and to estimate the
population size along with its variance. It is assumed that the response
vector (i.e. the dependent variable) corresponds to the number of times
a given unit was observed in the source. The most important arguments
are given in Table below; the obligatory ones are
<code>formula, data, model</code>.</p>
<table class="table">
<colgroup>
<col width="25%">
<col width="75%">
</colgroup>
<thead><tr class="header">
<th>Argument</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>formula</code></td>
<td>The main formula (i.e., for the Poisson
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>λ</mi><annotation encoding="application/x-tex">\lambda</annotation></semantics></math>
parameter);</td>
</tr>
<tr class="even">
<td><code>data</code></td>
<td>A <code>data.frame</code> (or <code>data.frame</code> coercible)
object;</td>
</tr>
<tr class="odd">
<td><code>model</code></td>
<td>Either a function, a string, or a family class object specifying
which model should be used; possible values are listed in the
documentation. The supplied argument should have the form
<code>model = "ztpoisson"</code>, <code>model = ztpoisson</code>, or if
a link function should be specified, then
<code>model = ztpoisson(lambdaLink = "log")</code> can be used;</td>
</tr>
<tr class="even">
<td><code>method</code></td>
<td>A numerical method used to fit regression <code>IRLS</code> or
<code>optim</code>;</td>
</tr>
<tr class="odd">
<td><code>popVar</code></td>
<td>A method for estimating variance of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>N</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{N}</annotation></semantics></math>
and creating confidence intervals (either bootstrap, analytic, or
skipping the estimation entirely);</td>
</tr>
<tr class="even">
<td>
<code>controlMethod</code>, <code>controlModel</code>, or
<code>controlPopVar</code>
</td>
<td>Control parameters for numerical fitting, specifying additional
formulas (inflation, dispersion) and population size estimation,
respectively;</td>
</tr>
<tr class="odd">
<td><code>offset</code></td>
<td>A matrix of offset values with the number of columns matching the
number of distribution parameters, providing offset values to each of
the linear predictors;</td>
</tr>
<tr class="even">
<td><code>...</code></td>
<td>Additional optional arguments passed to other methods, e.g.,
<code>estimatePopsizeFit</code>;</td>
</tr>
</tbody>
</table>
<p>An important step in using <code>estimatePopsize</code> is specifying
the <code>model</code> parameter, which indicates the type of model that
will be used for estimating the <em>unobserved</em> part of the
population. For instance, to fit Chao’s or Zelterman’s model one should
select <code>chao</code> or <code>zelterman</code> and, assuming that
one-inflation is present, one can select one of the zero-truncated
one-inflated
(<code>ztoi</code><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>*</mo></msup><annotation encoding="application/x-tex">^\ast</annotation></semantics></math>)
or one-inflated zero-truncated
(<code>oizt</code><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>*</mo></msup><annotation encoding="application/x-tex">^\ast</annotation></semantics></math>)
models, such as <code>oiztpoisson</code> for Poisson or
<code>ztoinegbin</code> for NB2.</p>
<p>If it is assumed that heterogeneity is observed for NB2 models, one
can specify the formula in the <code>controlModel</code> argument with
the <code>controlModel</code> function and the <code>alphaFormula</code>
argument. This enables the user to provide a formula for the dispersion
parameter in the NB2 models. If heterogeneity is assumed for
<code>ztoi</code><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>*</mo></msup><annotation encoding="application/x-tex">^\ast</annotation></semantics></math>
or
<code>oizt</code><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>*</mo></msup><annotation encoding="application/x-tex">^\ast</annotation></semantics></math>,
one can specify the <code>omegaFormula</code> argument, which
corresponds to the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>ω</mi><annotation encoding="application/x-tex">\omega</annotation></semantics></math>
parameter in these models. Finally, if covariates are assumed to be
available for the hurdle models
(<code>ztHurdle</code><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>*</mo></msup><annotation encoding="application/x-tex">^\ast</annotation></semantics></math>
or
<code>Hurdlezt</code><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi></mi><mo>*</mo></msup><annotation encoding="application/x-tex">^\ast</annotation></semantics></math>),
then <code>piFormula</code> can be specified, as it provides a formula
for the probability parameter in these models.</p>
</div>
<div class="section level3">
<h3 id="controlling-variance-estimation-with-controlpopvar">Controlling variance estimation with <code>controlPopVar</code><a class="anchor" aria-label="anchor" href="#controlling-variance-estimation-with-controlpopvar"></a>
</h3>
<p>The <code>estimatePopsize</code> function makes it possible to
specify the variance estimation method via <code>popVar</code>
(e.g. analytic or variance bootstrap) and control the estimation process
by specifying <code>controlPopVar</code>. In the control function
<code>controlPopVar</code> the user can specify the
<code>bootType</code> argument, which has three possible values:
<code>"parametric", "semiparametric"</code> and
<code>"nonparametric"</code>. Additional arguments accepted by the
<code>contorlPopVar</code> function, which are relevant to bootstrap,
include:</p>
<ul>
<li>
<code>alpha</code>, <code>B</code> – the significance level and the
number of bootstrap samples to be performed, respectively, with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.05</mn><annotation encoding="application/x-tex">0.05</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>500</mn><annotation encoding="application/x-tex">500</annotation></semantics></math>
being the default options.</li>
<li>
<code>cores</code> – the number of process cores to be used in
bootstrap (1 by default); parallel computing is enabled by
<strong>doParallel</strong> <span class="citation">(<a href="#ref-doParallel">Microsoft and Weston 2022a</a>)</span>,
<strong>foreach</strong> <span class="citation">(<a href="#ref-foreach">Microsoft and Weston 2022b</a>)</span> and
<strong>parallel</strong> packages <span class="citation">(<a href="#ref-parallel">R Core Team 2023</a>)</span>.</li>
<li>
<code>keepbootStat</code> – a logical value indicating whether to
keep a vector of statistics produced by the bootstrap.</li>
<li>
<code>traceBootstrapSize</code>, <code>bootstrapVisualTrace</code> –
logical values indicating whether sample and population size should be
tracked (<code>FALSE</code> by default); these work only when
<code>cores</code> = 1.</li>
<li>
<code>fittingMethod</code>, <code>bootstrapFitcontrol</code> – the
fitting method (by default the same as the one used in the original
call) and control parameters (<code>controlMethod</code>) for model
fitting in the bootstrap.</li>
</ul>
<p>In addition, the user can specify the type of confidence interval by
means of <code>confType</code> and the type of covariance matrix by
using <code>covType</code> for the analytical variance estimator
(observed or the Fisher information matrix).</p>
<p>In the next sections we present a case study involving the use of a
simple zero-truncated Poisson regression and a more advanced model:
one-inflated zero-truncated geometric regression with the
<code>cloglog</code> link function. First, we present the example
dataset, then we describe how to estimate the population size and assess
the quality and diagnostics measures. Finally, we show how to estimate
the population size in user-specified sub-populations.</p>
</div>
</div>
<div class="section level2">
<h2 id="sec-study">Data analysis example<a class="anchor" aria-label="anchor" href="#sec-study"></a>
</h2>
<p>The package can be installed in the standard manner using:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"singleRcapture"</span><span class="op">)</span></span></code></pre></div>
<p>Then, we need to load the package using the following code:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ncn-foreigners/singleRcapture" class="external-link">singleRcapture</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="dataset">Dataset<a class="anchor" aria-label="anchor" href="#dataset"></a>
</h3>
<p>We use a dataset from <span class="citation">Heijden et al. (<a href="#ref-ztpoisson">2003</a>)</span>, which contains information about
immigrants in four Dutch cities (Amsterdam, Rotterdam, The Hague and
Utrecht), who were staying in the country without a legal permit in 1995
and appeared in police records for that year. This dataset is included
in the package called <code>netherlandsimmigrant</code>:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">netherlandsimmigrant</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">netherlandsimmigrant</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   capture gender    age       reason       nation</span></span>
<span><span class="co">## 1       1   male &lt;40yrs Other reason North Africa</span></span>
<span><span class="co">## 2       1   male &lt;40yrs Other reason North Africa</span></span>
<span><span class="co">## 3       1   male &lt;40yrs Other reason North Africa</span></span>
<span><span class="co">## 4       1   male &lt;40yrs Other reason         Asia</span></span>
<span><span class="co">## 5       1   male &lt;40yrs Other reason         Asia</span></span>
<span><span class="co">## 6       2   male &lt;40yrs Other reason North Africa</span></span></code></pre>
<p>The number of times each individual appeared in the records is
included in the <code>capture</code> variable. The available covariates
include <code>gender, age, reason, nation</code>; the last two represent
the reason for being captured and the region of the world a given person
comes from:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">netherlandsimmigrant</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     capture         gender         age                reason    </span></span>
<span><span class="co">##  Min.   :1.000   female: 398   &lt;40yrs:1769   Illegal stay: 259  </span></span>
<span><span class="co">##  1st Qu.:1.000   male  :1482   &gt;40yrs: 111   Other reason:1621  </span></span>
<span><span class="co">##  Median :1.000                                                  </span></span>
<span><span class="co">##  Mean   :1.162                                                  </span></span>
<span><span class="co">##  3rd Qu.:1.000                                                  </span></span>
<span><span class="co">##  Max.   :6.000                                                  </span></span>
<span><span class="co">##                     nation    </span></span>
<span><span class="co">##  American and Australia: 173  </span></span>
<span><span class="co">##  Asia                  : 284  </span></span>
<span><span class="co">##  North Africa          :1023  </span></span>
<span><span class="co">##  Rest of Africa        : 243  </span></span>
<span><span class="co">##  Surinam               :  64  </span></span>
<span><span class="co">##  Turkey                :  93</span></span></code></pre>
<p>One notable characteristic of this dataset is that it contains a
disproportionately large number of individuals who were observed only
once (i.e. 1645).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">netherlandsimmigrant</span><span class="op">$</span><span class="va">capture</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##    1    2    3    4    5    6 </span></span>
<span><span class="co">## 1645  183   37   13    1    1</span></span></code></pre>
<p>The basic syntax of <code>estimatePopsize</code> is very similar to
that of <code>glm</code>, the same can be said about the output of the
summary method except for additional results of population size
estimates (denoted as
<code>Population size estimation results</code>).</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">basicModel</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimatePopsize.html">estimatePopsize</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">capture</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">nation</span>,</span>
<span>  model   <span class="op">=</span> <span class="fu"><a href="../reference/singleRmodels.html">ztpoisson</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  data    <span class="op">=</span> <span class="va">netherlandsimmigrant</span>,</span>
<span>  controlMethod <span class="op">=</span> <span class="fu"><a href="../reference/controlMethod.html">controlMethod</a></span><span class="op">(</span>silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">basicModel</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## estimatePopsize.default(formula = capture ~ gender + age + nation, </span></span>
<span><span class="co">##     data = netherlandsimmigrant, model = ztpoisson(), controlMethod = controlMethod(silent = TRUE))</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Pearson Residuals:</span></span>
<span><span class="co">##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. </span></span>
<span><span class="co">## -0.486442 -0.486442 -0.298080  0.002093 -0.209444 13.910844 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">## -----------------------</span></span>
<span><span class="co">## For linear predictors associated with: lambda </span></span>
<span><span class="co">##                      Estimate Std. Error z value  P(&gt;|z|)    </span></span>
<span><span class="co">## (Intercept)           -1.3411     0.2149  -6.241 4.35e-10 ***</span></span>
<span><span class="co">## gendermale             0.3972     0.1630   2.436 0.014832 *  </span></span>
<span><span class="co">## age&gt;40yrs             -0.9746     0.4082  -2.387 0.016972 *  </span></span>
<span><span class="co">## nationAsia            -1.0926     0.3016  -3.622 0.000292 ***</span></span>
<span><span class="co">## nationNorth Africa     0.1900     0.1940   0.979 0.327398    </span></span>
<span><span class="co">## nationRest of Africa  -0.9106     0.3008  -3.027 0.002468 ** </span></span>
<span><span class="co">## nationSurinam         -2.3364     1.0136  -2.305 0.021159 *  </span></span>
<span><span class="co">## nationTurkey          -1.6754     0.6028  -2.779 0.005445 ** </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## AIC: 1712.901</span></span>
<span><span class="co">## BIC: 1757.213</span></span>
<span><span class="co">## Residual deviance: 1128.553</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Log-likelihood: -848.4504 on 1872 Degrees of freedom </span></span>
<span><span class="co">## Number of iterations: 8</span></span>
<span><span class="co">## -----------------------</span></span>
<span><span class="co">## Population size estimation results: </span></span>
<span><span class="co">## Point estimate 12690.35</span></span>
<span><span class="co">## Observed proportion: 14.8% (N obs = 1880)</span></span>
<span><span class="co">## Std. Error 2808.169</span></span>
<span><span class="co">## 95% CI for the population size:</span></span>
<span><span class="co">##           lowerBound upperBound</span></span>
<span><span class="co">## normal      7186.444   18194.26</span></span>
<span><span class="co">## logNormal   8431.275   19718.32</span></span>
<span><span class="co">## 95% CI for the share of observed population:</span></span>
<span><span class="co">##           lowerBound upperBound</span></span>
<span><span class="co">## normal     10.332927   26.16037</span></span>
<span><span class="co">## logNormal   9.534281   22.29793</span></span></code></pre>
<p>The output regarding the population size contains the point estimate,
the observed proportion (based on the input dataset), the standard error
and two confidence intervals: one relating to the point estimate, the
second – to the observed proportion.</p>
<p>According to this simple model, the population size is about 12,500,
with about 15% of units observed in the register. The 95% CI under
normality indicates that the true population size is likely to be
between 7,000-18,000, with about 10-26% of the target population
observed in the register.</p>
<p>Since there is a reasonable suspicion that the act of observing a
unit in the dataset may lead to undesirable consequences for the person
concerned (in this case, a possible deportation, detention or something
similar). For these reasons, the user may consider one-inflated models,
such as one-inflated zero-truncated geometric model (specified by
<code>oiztgeom</code> family) and those presented below.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123456</span><span class="op">)</span></span>
<span><span class="va">modelInflated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimatePopsize.html">estimatePopsize</a></span><span class="op">(</span></span>
<span>    formula <span class="op">=</span> <span class="va">capture</span> <span class="op">~</span> <span class="va">nation</span>,</span>
<span>    model   <span class="op">=</span> <span class="fu"><a href="../reference/singleRmodels.html">oiztgeom</a></span><span class="op">(</span>omegaLink <span class="op">=</span> <span class="st">"cloglog"</span><span class="op">)</span>,</span>
<span>    data    <span class="op">=</span> <span class="va">netherlandsimmigrant</span>,</span>
<span>    controlModel <span class="op">=</span> <span class="fu"><a href="../reference/controlModel.html">controlModel</a></span><span class="op">(</span></span>
<span>        omegaFormula <span class="op">=</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">age</span></span>
<span>    <span class="op">)</span>,</span>
<span>    popVar <span class="op">=</span> <span class="st">"bootstrap"</span>,</span>
<span>    controlPopVar <span class="op">=</span> <span class="fu"><a href="../reference/controlPopVar.html">controlPopVar</a></span><span class="op">(</span>bootType <span class="op">=</span> <span class="st">"semiparametric"</span>,</span>
<span>                                  B <span class="op">=</span> <span class="fl">50</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">modelInflated</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## estimatePopsize.default(formula = capture ~ nation, data = netherlandsimmigrant, </span></span>
<span><span class="co">##     model = oiztgeom(omegaLink = "cloglog"), popVar = "bootstrap", </span></span>
<span><span class="co">##     controlModel = controlModel(omegaFormula = ~gender + age), </span></span>
<span><span class="co">##     controlPopVar = controlPopVar(bootType = "semiparametric", </span></span>
<span><span class="co">##         B = 50))</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Pearson Residuals:</span></span>
<span><span class="co">##     Min.  1st Qu.   Median     Mean  3rd Qu.     Max. </span></span>
<span><span class="co">## -0.41643 -0.41643 -0.30127  0.00314 -0.18323 13.88376 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">## -----------------------</span></span>
<span><span class="co">## For linear predictors associated with: lambda </span></span>
<span><span class="co">##                      Estimate Std. Error z value  P(&gt;|z|)    </span></span>
<span><span class="co">## (Intercept)           -1.2552     0.2149  -5.840 5.22e-09 ***</span></span>
<span><span class="co">## nationAsia            -0.8193     0.2544  -3.220  0.00128 ** </span></span>
<span><span class="co">## nationNorth Africa     0.2057     0.1838   1.119  0.26309    </span></span>
<span><span class="co">## nationRest of Africa  -0.6692     0.2548  -2.627  0.00862 ** </span></span>
<span><span class="co">## nationSurinam         -1.5205     0.6271  -2.425  0.01532 *  </span></span>
<span><span class="co">## nationTurkey          -1.1888     0.4343  -2.737  0.00619 ** </span></span>
<span><span class="co">## -----------------------</span></span>
<span><span class="co">## For linear predictors associated with: omega </span></span>
<span><span class="co">##             Estimate Std. Error z value  P(&gt;|z|)    </span></span>
<span><span class="co">## (Intercept)  -1.4577     0.3884  -3.753 0.000175 ***</span></span>
<span><span class="co">## gendermale   -0.8738     0.3602  -2.426 0.015267 *  </span></span>
<span><span class="co">## age&gt;40yrs     1.1745     0.5423   2.166 0.030326 *  </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## AIC: 1677.125</span></span>
<span><span class="co">## BIC: 1726.976</span></span>
<span><span class="co">## Residual deviance: 941.5416</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Log-likelihood: -829.5625 on 3751 Degrees of freedom </span></span>
<span><span class="co">## Number of iterations: 10</span></span>
<span><span class="co">## -----------------------</span></span>
<span><span class="co">## Population size estimation results: </span></span>
<span><span class="co">## Point estimate 6699.953</span></span>
<span><span class="co">## Observed proportion: 28.1% (N obs = 1880)</span></span>
<span><span class="co">## Boostrap sample skewness: 0.5209689</span></span>
<span><span class="co">## 0 skewness is expected for normally distributed variable</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Bootstrap Std. Error 1579.235</span></span>
<span><span class="co">## 95% CI for the population size:</span></span>
<span><span class="co">## lowerBound upperBound </span></span>
<span><span class="co">##   5107.533  10738.242 </span></span>
<span><span class="co">## 95% CI for the share of observed population:</span></span>
<span><span class="co">## lowerBound upperBound </span></span>
<span><span class="co">##   17.50752   36.80838</span></span></code></pre>
<p>According to this approach, the population size is about 7,000, which
is about 5,000 less than in the case of the naive Poisson approach. A
comparison of AIC and BIC suggests that the one-inflation model fits the
data better with BIC for <code>oiztgeom</code> 1727 and 1757 for
<code>ztpoisson</code>.</p>
<p>We can access population size estimates using the following code,
which returns a list with numerical results.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/popSizeEst.html">popSizeEst</a></span><span class="op">(</span><span class="va">basicModel</span><span class="op">)</span>    <span class="co"># alternative: basicModel$populationSize</span></span></code></pre></div>
<pre><code><span><span class="co">## Point estimate: 12690.35</span></span>
<span><span class="co">## Variance: 7885812</span></span>
<span><span class="co">## 95% confidence intervals:</span></span>
<span><span class="co">##           lowerBound upperBound</span></span>
<span><span class="co">## normal      7186.444   18194.26</span></span>
<span><span class="co">## logNormal   8431.275   19718.32</span></span></code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/popSizeEst.html">popSizeEst</a></span><span class="op">(</span><span class="va">modelInflated</span><span class="op">)</span> <span class="co"># alternative: modelInflated$populationSize</span></span></code></pre></div>
<pre><code><span><span class="co">## Point estimate: 6699.953</span></span>
<span><span class="co">## Variance: 2493985</span></span>
<span><span class="co">## 95% confidence intervals:</span></span>
<span><span class="co">## lowerBound upperBound </span></span>
<span><span class="co">##   5107.533  10738.242</span></span></code></pre>
<p>The decision whether to use a zero-truncated Poisson or one-inflated
zero-truncated geometric model should be based on the assessment of the
model and the assumptions regarding the data generation process. One
possible method of selection is based on the likelihood ratio test,
which can be computed quickly and conveniently with the
<strong>lmtest</strong> (<span class="citation">Zeileis and Hothorn (<a href="#ref-lmtest">2002</a>)</span>) interface:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">lmtest</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/lmtest/man/lrtest.html" class="external-link">lrtest</a></span><span class="op">(</span><span class="va">basicModel</span>, <span class="va">modelInflated</span>, </span>
<span>       name <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">family</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="op">$</span><span class="va">family</span> <span class="op">==</span> <span class="st">"ztpoisson"</span><span class="op">)</span></span>
<span>        <span class="st">"Basic model"</span></span>
<span>    <span class="kw">else</span> <span class="st">"Inflated model"</span></span>
<span><span class="op">}</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Likelihood ratio test</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Model 1: Basic model</span></span>
<span><span class="co">## Model 2: Inflated model</span></span>
<span><span class="co">##   #Df  LogLik Df  Chisq Pr(&gt;Chisq)    </span></span>
<span><span class="co">## 1   8 -848.45                         </span></span>
<span><span class="co">## 2   9 -829.56  1 37.776  7.936e-10 ***</span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre>
<p>However, the above is not a standard method of model selection in
SSCR. The next sections are dedicated to a detailed description of how
to assess the results using standard statistical tests and
diagnostics.</p>
</div>
<div class="section level3">
<h3 id="testing-marginal-frequencies">Testing marginal frequencies<a class="anchor" aria-label="anchor" href="#testing-marginal-frequencies"></a>
</h3>
<p>A popular method of testing the model fit in single source
capture-recapture studies consists in comparing the fitted marginal
frequencies
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>N</mi><mrow><mi>o</mi><mi>b</mi><mi>s</mi></mrow></msub></msubsup><mover><mi>ℙ</mi><mo accent="true">̂</mo></mover><mrow><mo stretchy="true" form="prefix">[</mo><msub><mi>Y</mi><mi>j</mi></msub><mo>=</mo><mi>k</mi><mo stretchy="false" form="prefix">|</mo><msub><mi>𝐱</mi><mi>j</mi></msub><mo>,</mo><msub><mi>Y</mi><mi>j</mi></msub><mo>&gt;</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\displaystyle\sum_{j=1}^{N_{obs}}\hat{\mathbb{P}}\left[Y_{j}=k|\boldsymbol{x}_{j}, Y_{j} &gt; 0\right]</annotation></semantics></math>
with the observed marginal frequencies
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><mi>N</mi></msubsup><msub><mi>ℐ</mi><mrow><mo stretchy="false" form="prefix">{</mo><mi>k</mi><mo stretchy="false" form="postfix">}</mo></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Y</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow><mo>=</mo><msubsup><mo>∑</mo><mrow><mi>j</mi><mo>=</mo><mn>1</mn></mrow><msub><mi>N</mi><mrow><mi>o</mi><mi>b</mi><mi>s</mi></mrow></msub></msubsup><msub><mi>ℐ</mi><mrow><mo stretchy="false" form="prefix">{</mo><mi>k</mi><mo stretchy="false" form="postfix">}</mo></mrow></msub><mrow><mo stretchy="true" form="prefix">(</mo><msub><mi>Y</mi><mi>j</mi></msub><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\displaystyle\sum_{j=1}^{N}\mathcal{I}_{\{k\}}(Y_{j})=\sum_{j=1}^{N_{obs}}\mathcal{I}_{\{k\}}(Y_{j})</annotation></semantics></math>
for
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>k</mi><mo>≥</mo><mn>1</mn></mrow><annotation encoding="application/x-tex">k\geq1</annotation></semantics></math>.
If the fitted model bears sufficient resemblance to the real data
collection process, these quantities should be quite close and both
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>G</mi><annotation encoding="application/x-tex">G</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msup><mi>χ</mi><mn>2</mn></msup><annotation encoding="application/x-tex">\chi^{2}</annotation></semantics></math>
tests can be used to test the statistical significance of the
discrepancy with the following <strong>singleRcapture</strong> syntax
for the Poisson model (rather poor fit):</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">margFreq</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/marginalFreq.html">marginalFreq</a></span><span class="op">(</span><span class="va">basicModel</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">margFreq</span>, df <span class="op">=</span> <span class="fl">1</span>, dropl5 <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Test for Goodness of fit of a regression model:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                  Test statistics df P(&gt;X^2)</span></span>
<span><span class="co">## Chi-squared test           50.06  1 1.5e-12</span></span>
<span><span class="co">## G-test                     34.31  1 4.7e-09</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## -------------------------------------------------------------- </span></span>
<span><span class="co">## Cells with fitted frequencies of &lt; 5 have been grouped </span></span>
<span><span class="co">## Names of cells used in calculating test(s) statistic: 1 2 3</span></span></code></pre>
<p>and for the one-inflated model (better fit):</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">margFreq_inf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/marginalFreq.html">marginalFreq</a></span><span class="op">(</span><span class="va">modelInflated</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">margFreq_inf</span>, df <span class="op">=</span> <span class="fl">1</span>, dropl5 <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Test for Goodness of fit of a regression model:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##                  Test statistics df P(&gt;X^2)</span></span>
<span><span class="co">## Chi-squared test            1.88  1    0.17</span></span>
<span><span class="co">## G-test                      2.32  1    0.13</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## -------------------------------------------------------------- </span></span>
<span><span class="co">## Cells with fitted frequencies of &lt; 5 have been grouped </span></span>
<span><span class="co">## Names of cells used in calculating test(s) statistic: 1 2 3 4</span></span></code></pre>
<p>where the <code>dropl5</code> argument is used to indicate how to
handle cells with less than
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>5</mn><annotation encoding="application/x-tex">5</annotation></semantics></math>
fitted observations. Note, however, that currently there is no
continuity correction.</p>
</div>
<div class="section level3">
<h3 id="diagnostics">Diagnostics<a class="anchor" aria-label="anchor" href="#diagnostics"></a>
</h3>
<p>The <code>singleRStaticCountData</code> class has a <code>plot</code>
method implementing several types of quick demonstrative plots, such as
the rootogram <span class="citation">(<a href="#ref-rootogram">Kleiber
and Zeileis 2016</a>)</span>, for comparing fitted and marginal
frequencies, which can be generated with the following syntax:</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span>   <span class="va">basicModel</span>, plotType <span class="op">=</span> <span class="st">"rootogram"</span>, main <span class="op">=</span> <span class="st">"ZT Poisson model"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">modelInflated</span>, plotType <span class="op">=</span> <span class="st">"rootogram"</span>, main <span class="op">=</span> <span class="st">"OI ZT Geometric model"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="singleRcapture_files/figure-html/rootogram-1.png" alt="Rootograms for ztpoisson (left) and oiztgeom (right) models" width="480"><img src="singleRcapture_files/figure-html/rootogram-2.png" alt="Rootograms for ztpoisson (left) and oiztgeom (right) models" width="480"><p class="caption">
Rootograms for ztpoisson (left) and oiztgeom (right) models
</p>
</div>
<p>The above plots suggest that the <code>oiztgeom</code> model fits the
data better. Another important issue in population size estimation is to
conduct model diagnostics in order to verify whether influential
observations are present in the data. For this purpose the leave-one-out
(LOO) diagnostic implemented in the <code>dfbeta</code> from the
<strong>stats</strong> package has been adapted as shown below
(multiplied by a factor of a hundred for better readability):</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfb</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">dfbeta</a></span><span class="op">(</span><span class="va">basicModel</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">dfb</span>, <span class="fl">2</span>, <span class="va">quantile</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                           0%     25%     50%    75%    100%</span></span>
<span><span class="co">## (Intercept)          -0.9909 -0.1533  0.0191 0.0521  8.6619</span></span>
<span><span class="co">## gendermale           -9.0535 -0.0777 -0.0283 0.1017  2.2135</span></span>
<span><span class="co">## age&gt;40yrs            -2.0010  0.0179  0.0379 0.0691 16.0061</span></span>
<span><span class="co">## nationAsia           -9.5559 -0.0529  0.0066 0.0120 17.9914</span></span>
<span><span class="co">## nationNorth Africa   -9.6605 -0.0842 -0.0177 0.0087  3.1260</span></span>
<span><span class="co">## nationRest of Africa -9.4497 -0.0244  0.0030 0.0083 10.9787</span></span>
<span><span class="co">## nationSurinam        -9.3140 -0.0066  0.0020 0.0035 99.3383</span></span>
<span><span class="co">## nationTurkey         -9.6198 -0.0220  0.0079 0.0143 32.0980</span></span></code></pre>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfi</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/influence.measures.html" class="external-link">dfbeta</a></span><span class="op">(</span><span class="va">modelInflated</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/apply.html" class="external-link">apply</a></span><span class="op">(</span><span class="va">dfi</span>, <span class="fl">2</span>, <span class="va">quantile</span><span class="op">)</span><span class="op">*</span><span class="fl">100</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                            0%     25%     50%     75%    100%</span></span>
<span><span class="co">## (Intercept)           -1.4640  0.0050  0.0184  0.0557  9.0600</span></span>
<span><span class="co">## nationAsia            -6.6331 -0.0346  0.0157  0.0347 12.2406</span></span>
<span><span class="co">## nationNorth Africa    -7.2770 -0.0768 -0.0170  0.0085  1.9415</span></span>
<span><span class="co">## nationRest of Africa  -6.6568 -0.0230  0.0081  0.0262  7.1710</span></span>
<span><span class="co">## nationSurinam         -6.2308 -0.0124  0.0162  0.0421 62.2045</span></span>
<span><span class="co">## nationTurkey          -6.4795 -0.0273  0.0204  0.0462 21.1338</span></span>
<span><span class="co">## (Intercept):omega     -6.8668 -0.0193  0.0476  0.0476  9.3389</span></span>
<span><span class="co">## gendermale:omega      -2.2733 -0.2227  0.1313  0.2482 11.1234</span></span>
<span><span class="co">## age&gt;40yrs:omega      -30.2130 -0.2247 -0.1312 -0.0663  2.0393</span></span></code></pre>
<p>The result of the <code>dfbeta</code> can be further used in the
<code>dfpopsize</code> function, which can be used to quantify LOO on
the population size. Note the warning when the bootstap variance
estimation is applied.</p>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfb_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regDiagSingleR.html">dfpopsize</a></span><span class="op">(</span><span class="va">basicModel</span>, dfbeta <span class="op">=</span> <span class="va">dfb</span><span class="op">)</span></span>
<span><span class="va">dfi_pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/regDiagSingleR.html">dfpopsize</a></span><span class="op">(</span><span class="va">modelInflated</span>, dfbeta <span class="op">=</span> <span class="va">dfi</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">dfb_pop</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. </span></span>
<span><span class="co">## -4236.412     2.664     2.664     5.448    17.284   117.448</span></span></code></pre>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">dfi_pop</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. </span></span>
<span><span class="co">## -456.6443   -3.1121   -0.7243    3.4333    5.1535  103.5949</span></span></code></pre>
<p>Figure 2 shows a comparison of the effect of deleting an observation
on the population size estimate and inverse probability weights, which
refer to the contribution of a given observation to the population size
estimate:</p>
<div class="sourceCode" id="cb34"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">basicModel</span>, plotType <span class="op">=</span> <span class="st">"dfpopContr"</span>, </span>
<span>     dfpop <span class="op">=</span> <span class="va">dfb_pop</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4500</span>, <span class="fl">150</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">modelInflated</span>, plotType <span class="op">=</span> <span class="st">"dfpopContr"</span>, </span>
<span>     dfpop <span class="op">=</span> <span class="va">dfi_pop</span>, xlim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="op">-</span><span class="fl">4500</span>, <span class="fl">150</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="singleRcapture_files/figure-html/dfpopsize_plot-1.png" alt="Results for ztpoisson (left) and oiztgeom (right) model" width="480"><img src="singleRcapture_files/figure-html/dfpopsize_plot-2.png" alt="Results for ztpoisson (left) and oiztgeom (right) model" width="480"><p class="caption">
Results for ztpoisson (left) and oiztgeom (right) model
</p>
</div>
<p>These plots show how the population size changes if a given
observation is removed. For instance, if we remove observation 542, then
the population size will increase by about 4236 for the
<code>ztpoisson</code> model. In the case of <code>oiztgeom</code>, the
largest change is equal to 457 for observation 900.</p>
<p>The full list of plot types along with the list of optional arguments
that can be passed from the call to the <code>plot</code> method down to
base <strong>R</strong> and <strong>graphics</strong> functions can be
found in the help file of the <code>plot</code> method.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">?</span><span class="va">plot.singleRStaticCountData</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="the-stratifypopsize-function">The <code>stratifyPopsize</code> function<a class="anchor" aria-label="anchor" href="#the-stratifypopsize-function"></a>
</h3>
<p>Researchers may be interested not only in the total population size
but also in the size of specific sub-populations (e.g. males, females,
particular age groups). For this reason we have created the
<code>stratifyPopsize</code> function, which estimates the size by
strata defined by the coefficients in the model (the default option).
The following output presents results based on the
<code>ztpoisson</code> and <code>oiztgeom</code> models.</p>
<div class="sourceCode" id="cb36"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">popSizestrata</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stratifyPopsize.html">stratifyPopsize</a></span><span class="op">(</span><span class="va">basicModel</span><span class="op">)</span></span>
<span><span class="va">cols</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"name"</span>, <span class="st">"Observed"</span>, <span class="st">"Estimated"</span>, <span class="st">"logNormalLowerBound"</span>, </span>
<span>          <span class="st">"logNormalUpperBound"</span><span class="op">)</span></span>
<span><span class="va">popSizestrata_report</span> <span class="op">&lt;-</span> <span class="va">popSizestrata</span><span class="op">[</span>, <span class="va">cols</span><span class="op">]</span></span>
<span><span class="va">cols_custom</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Name"</span>, <span class="st">"Obs"</span>, <span class="st">"Estimated"</span>, <span class="st">"LowerBound"</span>, <span class="st">"UpperBound"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">popSizestrata_report</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">cols_custom</span></span>
<span><span class="va">popSizestrata_report</span></span></code></pre></div>
<pre><code><span><span class="co">##                              Name  Obs  Estimated LowerBound UpperBound</span></span>
<span><span class="co">## 1                  gender==female  398  3811.0924  2189.0439   6902.140</span></span>
<span><span class="co">## 2                    gender==male 1482  8879.2613  6090.7752  13354.889</span></span>
<span><span class="co">## 3                     age==&lt;40yrs 1769 10506.8994  7359.4140  15426.465</span></span>
<span><span class="co">## 4                     age==&gt;40yrs  111  2183.4543   872.0130   5754.881</span></span>
<span><span class="co">## 5  nation==American and Australia  173   708.3688   504.6086   1037.331</span></span>
<span><span class="co">## 6                    nation==Asia  284  2742.3147  1755.2548   4391.590</span></span>
<span><span class="co">## 7            nation==North Africa 1023  3055.2033  2697.4900   3489.333</span></span>
<span><span class="co">## 8          nation==Rest of Africa  243  2058.1533  1318.7466   3305.786</span></span>
<span><span class="co">## 9                 nation==Surinam   64  2386.4544   505.2460  12288.008</span></span>
<span><span class="co">## 10                 nation==Turkey   93  1739.8592   638.0497   5068.959</span></span></code></pre>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">popSizestrata_inflated</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stratifyPopsize.html">stratifyPopsize</a></span><span class="op">(</span><span class="va">modelInflated</span><span class="op">)</span></span>
<span><span class="va">popSizestrata_inflated_report</span> <span class="op">&lt;-</span> <span class="va">popSizestrata_inflated</span><span class="op">[</span>, <span class="va">cols</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">popSizestrata_inflated_report</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="va">cols_custom</span></span>
<span><span class="va">popSizestrata_inflated_report</span></span></code></pre></div>
<pre><code><span><span class="co">##                              Name  Obs Estimated LowerBound UpperBound</span></span>
<span><span class="co">## 1  nation==American and Australia  173  516.2432   370.8463   768.4919</span></span>
<span><span class="co">## 2                    nation==Asia  284 1323.5377   831.1601  2258.9954</span></span>
<span><span class="co">## 3            nation==North Africa 1023 2975.8801  2254.7071  4119.3050</span></span>
<span><span class="co">## 4          nation==Rest of Africa  243 1033.9753   667.6106  1716.4484</span></span>
<span><span class="co">## 5                 nation==Surinam   64  354.2236   193.8891   712.4739</span></span>
<span><span class="co">## 6                  nation==Turkey   93  496.0934   283.1444   947.5309</span></span>
<span><span class="co">## 7                  gender==female  398 1109.7768   778.7197  1728.7066</span></span>
<span><span class="co">## 8                    gender==male 1482 5590.1764  3838.4550  8644.0776</span></span>
<span><span class="co">## 9                     age==&lt;40yrs 1769 6437.8154  4462.3472  9862.2147</span></span>
<span><span class="co">## 10                    age==&gt;40yrs  111  262.1379   170.9490   492.0347</span></span></code></pre>
<p>The <code>stratifyPopsize</code> function prepared to handle objects
of the <code>singleRStaticCountData</code> class, accepts three optional
parameters <code>strata, alpha, cov</code>, which are used for
specifying sub-populations, significance levels and the covariance
matrix to be used for computing standard errors. An example of the full
call is presented below.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sandwich.R-Forge.R-project.org/" class="external-link">sandwich</a></span><span class="op">)</span></span>
<span><span class="va">popSizestrataCustom</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/stratifyPopsize.html">stratifyPopsize</a></span><span class="op">(</span></span>
<span>  object  <span class="op">=</span> <span class="va">basicModel</span>,</span>
<span>  strata <span class="op">=</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">age</span>, </span>
<span>  alpha   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0.05</span><span class="op">)</span>, each<span class="op">=</span><span class="fl">2</span><span class="op">)</span>, </span>
<span>  cov     <span class="op">=</span> <span class="fu"><a href="https://sandwich.R-Forge.R-project.org/reference/vcovHC.html" class="external-link">vcovHC</a></span><span class="op">(</span><span class="va">basicModel</span>, type <span class="op">=</span> <span class="st">"HC4"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">popSizestrataCustom_report</span> <span class="op">&lt;-</span> <span class="va">popSizestrataCustom</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">cols</span>, <span class="st">"confLevel"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">popSizestrataCustom_report</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">cols_custom</span>, <span class="st">"alpha"</span><span class="op">)</span></span>
<span><span class="va">popSizestrataCustom_report</span></span></code></pre></div>
<pre><code><span><span class="co">##             Name  Obs Estimated LowerBound UpperBound alpha</span></span>
<span><span class="co">## 1 gender==female  398  3811.092  2275.6410   6602.168  0.10</span></span>
<span><span class="co">## 2   gender==male 1482  8879.261  6261.5109  12930.760  0.10</span></span>
<span><span class="co">## 3    age==&lt;40yrs 1769 10506.899  7297.2057  15580.151  0.05</span></span>
<span><span class="co">## 4    age==&gt;40yrs  111  2183.454   787.0673   6464.016  0.05</span></span></code></pre>
<p>We have provided integration with the <strong>sandwich</strong> <span class="citation">(<a href="#ref-sandwich">Zeileis, Köll, and Graham
2020</a>)</span> package to correct the variance-covariance matrix in
the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>δ</mi><annotation encoding="application/x-tex">\delta</annotation></semantics></math>
method. In the code we have used the <code>vcovHC</code> method for
<code>singleRStaticCountData</code> class from the
<strong>sandwich</strong> package, different significance levels for
confidence intervals in each stratum and a formula to specify that we
want estimates for both males and females to be grouped by
<code>nation</code> and <code>age</code>. The <code>strata</code>
parameter can be specified either as:</p>
<ul>
<li>a formula with the empty left hand side, as shown in the example
above (e.g. <code>~ gender * age</code>),</li>
<li>a logical vector with the number of entries equal to the number of
rows in the dataset, in which case only one stratum will be created
(e.g. <code>netherlandsimmigrant$gender == "male"</code>),</li>
<li>a vector of names of explanatory variables, which will result in
every level of the explanatory variable having its own sub-population
for each variable specified (e.g. <code>c("gender", "age")</code>),</li>
<li>not supplied at all, in which case strata will correspond to levels
of each factor in the data without any interactions (string vectors will
be converted to factors for the convenience of the user),</li>
<li>a (named) list where each element is a logical vector; names of the
list will be used to specify variable names in the returned object, for
example:</li>
</ul>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  <span class="st">"Stratum 1"</span> <span class="op">=</span> <span class="va">netherlandsimmigrant</span><span class="op">$</span><span class="va">gender</span> <span class="op">==</span> <span class="st">"male"</span>   <span class="op">&amp;</span> </span>
<span>    <span class="va">netherlandsimmigrant</span><span class="op">$</span><span class="va">nation</span> <span class="op">==</span> <span class="st">"Suriname"</span>, </span>
<span>  <span class="st">"Stratum 2"</span> <span class="op">=</span> <span class="va">netherlandsimmigrant</span><span class="op">$</span><span class="va">gender</span> <span class="op">==</span> <span class="st">"female"</span> <span class="op">&amp;</span> </span>
<span>    <span class="va">netherlandsimmigrant</span><span class="op">$</span><span class="va">nation</span> <span class="op">==</span> <span class="st">"North Africa"</span></span>
<span><span class="op">)</span></span></code></pre></div>
<p>One can also specify <code>plotType = "strata"</code> in the
<code>plot</code> function, which results in a plot with point and CI
estimates of the population size.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">basicModel</span>, plotType <span class="op">=</span> <span class="st">"strata"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">modelInflated</span>, plotType <span class="op">=</span> <span class="st">"strata"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="singleRcapture_files/figure-html/strata_plot-1.png" alt="Population size by covariates for ztpoisson (left) and oiztgeom (right) model" width="576"><img src="singleRcapture_files/figure-html/strata_plot-2.png" alt="Population size by covariates for ztpoisson (left) and oiztgeom (right) model" width="576"><p class="caption">
Population size by covariates for ztpoisson (left) and oiztgeom (right)
model
</p>
</div>
<p>Only the <code>logNormal</code> type of confidence interval is used
for plotting since the studentized confidence intervals often result in
negative lower bounds.</p>
</div>
</div>
<div class="section level2">
<h2 id="sec-methods">Classes and <code>S3Methods</code><a class="anchor" aria-label="anchor" href="#sec-methods"></a>
</h2>
<p>We have created a number of classes. The main ones are:
<code>singleRStaticCountData</code>, <code>singleRfamily</code>, and
supplementary are: <code>popSizeEstResults</code>,
<code>summarysingleRmargin</code> and
<code>summarysingleRStaticCountData</code>, which make it possible to
extract relevant information regarding the population size.</p>
<p>For instance, the <code>popSizeEst</code> function can be used to
extract information about the estimated size of the population as given
below:</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="op">(</span><span class="va">popEst</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/popSizeEst.html">popSizeEst</a></span><span class="op">(</span><span class="va">basicModel</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Point estimate: 12690.35</span></span>
<span><span class="co">## Variance: 7885812</span></span>
<span><span class="co">## 95% confidence intervals:</span></span>
<span><span class="co">##           lowerBound upperBound</span></span>
<span><span class="co">## normal      7186.444   18194.26</span></span>
<span><span class="co">## logNormal   8431.275   19718.32</span></span></code></pre>
<p>and the resulting object <code>popEst</code> of the
<code>popSizeEstResults</code> class contains the following fields:</p>
<ul>
<li>
<code>pointEstimate</code>, <code>variance</code> – numerics
containing the point estimate and variance of this estimate.</li>
<li>
<code>confidenceInterval</code> – a <code>data.frame</code> with
confidence intervals.</li>
<li>
<code>boot</code> – If the bootstrap was performed a numeric vector
containing the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>N</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{N}</annotation></semantics></math>
values from the bootstrap, a character vector with value
<code>"No bootstrap performed"</code> otherwise.</li>
<li>
<code>control</code> – a <code>controlPopVar</code> object with
controls used to obtain the object.</li>
</ul>
<p>The only explicitly defined method for
<code>popSizeEstResults</code>, <code>summarysingleRmargin</code> and
<code>summarysingleRStaticCountData</code> classes is the
<code>print</code> method, but the former one also accepts
<strong>R</strong> primitives like <code>coef</code>:</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">basicModel</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                        Estimate Std. Error    z value      P(&gt;|z|)</span></span>
<span><span class="co">## (Intercept)          -1.3410661  0.2148870 -6.2407965 4.353484e-10</span></span>
<span><span class="co">## gendermale            0.3971793  0.1630155  2.4364504 1.483220e-02</span></span>
<span><span class="co">## age&gt;40yrs            -0.9746058  0.4082420 -2.3873235 1.697155e-02</span></span>
<span><span class="co">## nationAsia           -1.0925990  0.3016259 -3.6223642 2.919228e-04</span></span>
<span><span class="co">## nationNorth Africa    0.1899980  0.1940007  0.9793677 3.273983e-01</span></span>
<span><span class="co">## nationRest of Africa -0.9106361  0.3008092 -3.0272880 2.467587e-03</span></span>
<span><span class="co">## nationSurinam        -2.3363962  1.0135645 -2.3051282 2.115939e-02</span></span>
<span><span class="co">## nationTurkey         -1.6753917  0.6027744 -2.7794674 5.444812e-03</span></span></code></pre>
<p>analogously to <code>glm</code> from <strong>stats</strong>. The
<code>singleRfamily</code> inherits the <code>family</code> class from
<strong>stats</strong> and has explicitly defined <code>print</code> and
<code>simulate</code> methods. Example usage is presented below</p>
<table class="table">
<colgroup>
<col width="23%">
<col width="76%">
</colgroup>
<thead><tr class="header">
<th>Function</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>fitted</code></td>
<td>It works almost exactly like <code>glm</code> counterparts but
returns more information, namely on fitted values for the truncated and
non-truncated probability distribution;</td>
</tr>
<tr class="even">
<td><code>logLik</code></td>
<td>Compared to <code>glm</code> method, it has the possibility of
returning not just the value of the fitted log-likelihood but also the
entire function (argument <code>type = "function"</code>) along with two
first derivatives (argument <code>deriv = 0:2</code>);</td>
</tr>
<tr class="odd">
<td><code>model.matrix</code></td>
<td>It has the possibility of returning the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>X</mi><mtext mathvariant="normal">vlm</mtext></msub><annotation encoding="application/x-tex">X_{\text{vlm}}</annotation></semantics></math>
matrix defined previously;</td>
</tr>
<tr class="even">
<td><code>simulate</code></td>
<td>It calls the <code>simulate</code> method for the chosen model and
fitted
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛈</mi><annotation encoding="application/x-tex">\boldsymbol{\eta}</annotation></semantics></math>;</td>
</tr>
<tr class="odd">
<td><code>predict</code></td>
<td>It has the possibility of returning either fitted distribution
parameters for each unit (<code>type = "response"</code>), or just
linear predictors (<code>type = "link"</code>), or means of the fitted
distributions of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>Y</mi><mo stretchy="false" form="prefix">|</mo><mi>Y</mi><mo>&gt;</mo><mn>0</mn></mrow><annotation encoding="application/x-tex">Y|Y&gt;0</annotation></semantics></math>
(<code>type = "mean"</code>) or the inverse probability weights
(<code>type = "contr"</code>). It is possible to set the
<code>se.fit</code> argument to <code>TRUE</code> in order to obtain
standard errors for each of those by using the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>δ</mi><annotation encoding="application/x-tex">\delta</annotation></semantics></math>
method. Also, it is possible to use a custom covariance matrix for
standard error computation (argument <code>cov</code>);</td>
</tr>
<tr class="even">
<td><code>redoPopEstimation</code></td>
<td>A function that applies all post-hoc procedures that were performed
(such as heteroscedastic consistent covariance matrix estimation via
<strong>countreg</strong>) to estimate the population size and standard
errors;</td>
</tr>
<tr class="odd">
<td><code>residuals</code></td>
<td>Used for obtaining residuals of several types, we refer interested
readers to the manual
<code>?singleRcapture:::residuals.singleRStaticCountData</code>;</td>
</tr>
<tr class="even">
<td><code>stratifyPopsize, summary</code></td>
<td>Compared to the <code>glm</code> class, summary has the possibility
of adding confidence intervals to the coefficient matrix (argument
<code>confint = TRUE</code>) and using a custom covariance matrix
(argument <code>cov = someMatrix</code>);</td>
</tr>
<tr class="odd">
<td><code>plot</code></td>
<td>It has been discussed above;</td>
</tr>
<tr class="even">
<td><code>popSizeEst</code></td>
<td>An extractor showcased above;</td>
</tr>
<tr class="odd">
<td><code>cooks.distance</code></td>
<td>It works only for single predictor models;</td>
</tr>
<tr class="even">
<td><code>dfbeta, dfpopsize</code></td>
<td>Multi-threading in <code>dfbeta</code> is available and
<code>dfpopsize</code> calls <code>dfbeta</code> if no
<code>dfbeta</code> object was provided in the call;</td>
</tr>
<tr class="odd">
<td><code>bread, estfun, vcovHC</code></td>
<td>For (almost) full <strong>sandwich</strong> compatibility;</td>
</tr>
<tr class="even">
<td><code>AIC, BIC, extractAIC, family, confint, df.residual, model.frame, hatvalues, nobs, print, sigma, influence, rstudent, rstandard</code></td>
<td>These work exactly like <code>glm</code> counterparts.</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1234567890</span><span class="op">)</span></span>
<span><span class="va">N</span> <span class="op">&lt;-</span> <span class="fl">10000</span></span>
<span><span class="va">gender</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">N</span>, <span class="fl">1</span>, <span class="fl">0.2</span><span class="op">)</span></span>
<span><span class="va">eta</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">0.5</span><span class="op">*</span><span class="va">gender</span></span>
<span><span class="va">counts</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate.html">simulate</a></span><span class="op">(</span><span class="fu"><a href="../reference/singleRmodels.html">ztpoisson</a></span><span class="op">(</span><span class="op">)</span>, eta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">eta</span><span class="op">)</span>, seed <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span><span class="va">gender</span>, <span class="va">eta</span>, <span class="va">counts</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##      gender            eta              counts      </span></span>
<span><span class="co">##  Min.   :0.0000   Min.   :-1.0000   Min.   :0.0000  </span></span>
<span><span class="co">##  1st Qu.:0.0000   1st Qu.:-1.0000   1st Qu.:0.0000  </span></span>
<span><span class="co">##  Median :0.0000   Median :-1.0000   Median :0.0000  </span></span>
<span><span class="co">##  Mean   :0.2036   Mean   :-0.8982   Mean   :0.4196  </span></span>
<span><span class="co">##  3rd Qu.:0.0000   3rd Qu.:-1.0000   3rd Qu.:1.0000  </span></span>
<span><span class="co">##  Max.   :1.0000   Max.   :-0.5000   Max.   :5.0000</span></span></code></pre>
<p>The full list of explicitly defined methods for
<code>singleRStaticCountData</code> methods is presented in Table
above.</p>
</div>
<div class="section level2">
<h2 id="concluding-remarks">Concluding remarks<a class="anchor" aria-label="anchor" href="#concluding-remarks"></a>
</h2>
<p>In this paper we have introduced the <strong>singleRcapture</strong>
package for single source capture-recapture models. The package
implement state-of-the-art methods for estimating population size based
on a single data set with multiple counts. The package implements
different methods to account for heterogeneity in capture probabilities,
modelled using covariates, as well as behavioural change, modelled using
one-inflation. We have built the package to facilitate the
implementation of new models using <code>family</code> objects; their
application is exemplified in the Section 7. An example of implementing
a custom family described in Section 8 is presented in replication
materials.</p>
<p>Furthermore, since many <strong>R</strong> users are familiar with
<strong>countreg</strong> or <strong>VGAM</strong> packages, we have
implemented a lightweight extension called
<strong>singleRcaptureExtra</strong>, available through Github (), which
can be used to integrate <strong>singleRcapture</strong> with these
packages.</p>
<p>In future work we plan to implement Bayesian estimation using
<strong>Stan</strong> (e.g. via the <strong>brms</strong> package; <span class="citation">Carpenter et al. (<a href="#ref-carpenter2017stan">2017</a>)</span>, <span class="citation">Bürkner (<a href="#ref-brms">2017</a>)</span>) and for
one-inflation models we can use the recent approach proposed by <span class="citation">Tuoto, Di Cecco, and Tancredi (<a href="#ref-tuoto2022bayesian">2022</a>)</span> and implement our own
families using the <strong>brms</strong> package.</p>
</div>
<div class="section level2">
<h2 id="Acknowledgements">Acknowledgements<a class="anchor" aria-label="anchor" href="#Acknowledgements"></a>
</h2>
<p>The authors’ work has been financed by the National Science Centre in
Poland, OPUS 20, grant no. 2020/39/B/HS4/00941.</p>
<p>The authors would like to thank Peter van der Heijden, Maarten
Cruyff, Dankmar Böhning, Łukasz Chrostowski and Layna Dennett for useful
comments that have helped to improve the functionality of the package.
In addition, we would like to thank Marcin Szymkowiak and Tymon
Świtalski for their valuable comments that have considerably improved
the paper.</p>
</div>
<div class="section level2">
<h2 id="sec-details">Detailed information<a class="anchor" aria-label="anchor" href="#sec-details"></a>
</h2>
<div class="section level3" short-title="The estimatePopsizeFit function">
<h3 id="sec-estimatePopsizeFit">The <code>estimatePopsizeFit</code> function<a class="anchor" aria-label="anchor" href="#sec-estimatePopsizeFit"></a>
</h3>
<p>In this section we provide a step-by-step description of how to
prepare data in order to use the <code>estimatePopsizeFit</code>
function, which may be useful to some users, e.g. those wishing to make
modifications to the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mover><mi>N</mi><mo accent="true">̂</mo></mover><annotation encoding="application/x-tex">\hat{N}</annotation></semantics></math>
estimate or to the bootstrap. In order to show how to apply the function
we will fit a zero truncated geometric model on the data from <span class="citation">Böhning et al. (<a href="#ref-chao-generalization">2013</a>)</span> with covariate
dependency:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mtable><mtr><mtd columnalign="right" style="text-align: right"><mo>log</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>λ</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msub><mi>β</mi><mrow><mn>1</mn><mo>,</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>β</mi><mrow><mn>1</mn><mo>,</mo><mn>2</mn></mrow></msub><mtext mathvariant="normal">log_distance</mtext><mo>+</mo><msub><mi>β</mi><mrow><mn>1</mn><mo>,</mo><mn>3</mn></mrow></msub><mtext mathvariant="normal">C_TYPE</mtext><mo>+</mo><msub><mi>β</mi><mrow><mn>1</mn><mo>,</mo><mn>4</mn></mrow></msub><mtext mathvariant="normal">log_size</mtext><mo>,</mo></mtd></mtr><mtr><mtd columnalign="right" style="text-align: right"><mtext mathvariant="normal">logit</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mi>ω</mi><mo stretchy="true" form="postfix">)</mo></mrow></mtd><mtd columnalign="left" style="text-align: left"><mo>=</mo><msub><mi>β</mi><mrow><mn>2</mn><mo>,</mo><mn>1</mn></mrow></msub><mo>+</mo><msub><mi>β</mi><mrow><mn>2</mn><mo>,</mo><mn>2</mn></mrow></msub><mtext mathvariant="normal">log_distance</mtext><mo>+</mo><msub><mi>β</mi><mrow><mn>2</mn><mo>,</mo><mn>3</mn></mrow></msub><mtext mathvariant="normal">C_TYPE</mtext><mi>.</mi></mtd></mtr></mtable><annotation encoding="application/x-tex">\begin{align*}
  \log(\lambda) &amp;=
  \beta_{1, 1} + \beta_{1, 2} \text{log\_distance} + \beta_{1, 3} \text{C\_TYPE} +
  \beta_{1, 4} \text{log\_size}, \\
  \text{logit}(\omega) &amp;=
  \beta_{2, 1} + \beta_{2, 2} \text{log\_distance} + \beta_{2, 3} \text{C\_TYPE}.
\end{align*}</annotation></semantics></math></p>
<p>This would be equivalent to the following <code>esimatePopsize</code>
call:</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/estimatePopsize.html">estimatePopsize</a></span><span class="op">(</span></span>
<span>  <span class="va">TOTAL_SUB</span> <span class="op">~</span> <span class="va">.</span>,</span>
<span>  data <span class="op">=</span> <span class="va">farmsubmission</span>,</span>
<span>  model <span class="op">=</span> <span class="fu"><a href="../reference/singleRmodels.html">ztoigeom</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="../reference/controlModel.html">controlModel</a></span><span class="op">(</span></span>
<span>    omegaFormula <span class="op">=</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">log_size</span> <span class="op">+</span> <span class="va">C_TYPE</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<ol style="list-style-type: decimal">
<li>Create a data matrix
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐗</mi><mtext mathvariant="normal">vlm</mtext></msub><annotation encoding="application/x-tex">\boldsymbol{X}_{\text{vlm}}</annotation></semantics></math>
</li>
</ol>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fl">0</span>, nrow <span class="op">=</span> <span class="fl">2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">farmsubmission</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">7</span><span class="op">)</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Fill the first
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
rows with <code>model.matrix</code> according to the specified formula
and specify the attribute <code>attr(X, "hwm")</code> that informs the
function which elements of the design matrix correspond to which linear
predictor (covariates for counts and covariates for one-inflation)</li>
</ol>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">X</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">farmsubmission</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">log_size</span> <span class="op">+</span> <span class="va">log_distance</span> <span class="op">+</span> <span class="va">C_TYPE</span>, </span>
<span>  <span class="va">farmsubmission</span></span>
<span><span class="op">)</span></span>
<span><span class="va">X</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">farmsubmission</span><span class="op">)</span><span class="op">)</span>, <span class="fl">5</span><span class="op">:</span><span class="fl">7</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/model.matrix.html" class="external-link">model.matrix</a></span><span class="op">(</span></span>
<span>  <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">log_distance</span> <span class="op">+</span> <span class="va">C_TYPE</span>, </span>
<span>  <span class="va">farmsubmission</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">X</span>, <span class="st">"hwm"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">4</span>, <span class="fl">3</span><span class="op">)</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Obtain starting
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝛃</mi><annotation encoding="application/x-tex">\boldsymbol{\beta}</annotation></semantics></math>
parameters using the <code>glm.fit</code> function.</li>
</ol>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">start</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm.fit</a></span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="va">farmsubmission</span><span class="op">$</span><span class="va">TOTAL_SUB</span>, </span>
<span>  x <span class="op">=</span> <span class="va">X</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">farmsubmission</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="fl">4</span><span class="op">]</span>, </span>
<span>  family <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/family.html" class="external-link">poisson</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span></span>
<span><span class="va">start</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] -0.82583943  0.33254499 -0.03277732  0.32746933</span></span></code></pre>
<ol start="4" style="list-style-type: decimal">
<li>Use the <code>estimatePopsizeFit</code> function to fit the model
assuming a zero-truncated one-inflated geometric distribution as
specified in the <code>family</code> argument.</li>
</ol>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimatePopsizeFit.html">estimatePopsizeFit</a></span><span class="op">(</span></span>
<span>  y            <span class="op">=</span> <span class="va">farmsubmission</span><span class="op">$</span><span class="va">TOTAL_SUB</span>, </span>
<span>  X            <span class="op">=</span> <span class="va">X</span>, </span>
<span>  method       <span class="op">=</span> <span class="st">"IRLS"</span>, </span>
<span>  priorWeights <span class="op">=</span> <span class="fl">1</span>, </span>
<span>  family       <span class="op">=</span> <span class="fu"><a href="../reference/singleRmodels.html">ztoigeom</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>  control      <span class="op">=</span> <span class="fu"><a href="../reference/controlMethod.html">controlMethod</a></span><span class="op">(</span>silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>, </span>
<span>  coefStart    <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">start</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  etaStart     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="va">X</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">start</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  offset       <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">farmsubmission</span><span class="op">)</span><span class="op">)</span>, </span>
<span>                       <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">farmsubmission</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>Compare our results with those obtained by applying the
<code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">stats::optim</a></code> function.</li>
</ol>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ll</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/singleRmodels.html">ztoigeom</a></span><span class="op">(</span><span class="op">)</span><span class="op">$</span><span class="fu">makeMinusLogLike</span><span class="op">(</span>y <span class="op">=</span> <span class="va">farmsubmission</span><span class="op">$</span><span class="va">TOTAL_SUB</span>, X <span class="op">=</span> <span class="va">X</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">res2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimatePopsizeFit.html">estimatePopsizeFit</a></span><span class="op">(</span></span>
<span>  y <span class="op">=</span> <span class="va">farmsubmission</span><span class="op">$</span><span class="va">TOTAL_SUB</span>, </span>
<span>  X <span class="op">=</span> <span class="va">X</span>, </span>
<span>  method <span class="op">=</span> <span class="st">"optim"</span>, </span>
<span>  priorWeights <span class="op">=</span> <span class="fl">1</span>, </span>
<span>  family <span class="op">=</span> <span class="fu"><a href="../reference/singleRmodels.html">ztoigeom</a></span><span class="op">(</span><span class="op">)</span>, </span>
<span>  coefStart <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">start</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span>,</span>
<span>  control <span class="op">=</span> <span class="fu"><a href="../reference/controlMethod.html">controlMethod</a></span><span class="op">(</span>silent <span class="op">=</span> <span class="cn">TRUE</span>, maxiter <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span>,</span>
<span>  offset <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">farmsubmission</span><span class="op">)</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">farmsubmission</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>IRLS  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">beta</span>, <span class="op">-</span><span class="fu">ll</span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">beta</span><span class="op">)</span>, <span class="va">res</span><span class="op">$</span><span class="va">iter</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>           optim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Round.html" class="external-link">round</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">res2</span><span class="op">$</span><span class="va">beta</span>, <span class="op">-</span><span class="fu">ll</span><span class="op">(</span><span class="va">res2</span><span class="op">$</span><span class="va">beta</span><span class="op">)</span>, <span class="va">res2</span><span class="op">$</span><span class="va">iter</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span>, <span class="fl">4</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##          IRLS       optim</span></span>
<span><span class="co">## 1     -2.7845     -2.5971</span></span>
<span><span class="co">## 2      0.6170      0.6163</span></span>
<span><span class="co">## 3     -0.0646     -0.0825</span></span>
<span><span class="co">## 4      0.5346      0.5431</span></span>
<span><span class="co">## 5     -3.1745     -0.1504</span></span>
<span><span class="co">## 6      0.1281     -0.1586</span></span>
<span><span class="co">## 7     -1.0865     -1.0372</span></span>
<span><span class="co">## 8 -17278.7613 -17280.1189</span></span>
<span><span class="co">## 9     15.0000   1696.0000</span></span></code></pre>
<p>The default <code>maxiter</code> parameter for <code>"optim"</code>
fitting is
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1000</mn><annotation encoding="application/x-tex">1000</annotation></semantics></math>,
but we needed to increase it since the <code>optim</code> does not
converge in
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1000</mn><annotation encoding="application/x-tex">1000</annotation></semantics></math>
steps and “gets stuck” at a plateau, which results in a lower
log-likelihood value compared to the standard <code>"IRLS"</code>.</p>
<p>The above situation is rather typical. While we did not conduct any
formal numerical analyses, it seems that when one attempts to model more
than one parameter of the distribution as covariate dependent
<code>optim</code> algorithms, both <code>"Nelder-Mead"</code> and
<code>"L-BFGS-B"</code> seem to be ill-suited for the task despite being
provided with the analytically computed gradient. This is one of the
reasons why <code>"IRLS"</code> is the default fitting method.</p>
</div>
<div class="section level3">
<h3 id="sec-family">Structure of a family function<a class="anchor" aria-label="anchor" href="#sec-family"></a>
</h3>
<p>In this section we provide details regarding the <code>family</code>
object for the <strong>singleRcapture</strong> package. This object
contains additional parameters in comparison to the standard
<code>family</code> object from the <code>stats</code> package.</p>
<table class="table">
<colgroup>
<col width="19%">
<col width="80%">
</colgroup>
<thead><tr class="header">
<th>Function</th>
<th>Description</th>
</tr></thead>
<tbody>
<tr class="odd">
<td><code>makeMinusLogLike</code></td>
<td>A factory function for creating the following functions: <br><math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mo>ℓ</mo><mrow><mo stretchy="true" form="prefix">(</mo><mi>𝛃</mi><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\ell(\boldsymbol{\beta})</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mrow><mi>∂</mi><mo>ℓ</mo></mrow><mrow><mi>∂</mi><mi>𝛃</mi></mrow></mfrac><annotation encoding="application/x-tex">\frac{\partial\ell}{\partial\boldsymbol{\beta}}</annotation></semantics></math>,
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mfrac><mrow><msup><mi>∂</mi><mn>2</mn></msup><mo>ℓ</mo></mrow><mrow><mi>∂</mi><msup><mi>𝛃</mi><mi>⊤</mi></msup><mi>∂</mi><mi>𝛃</mi></mrow></mfrac><annotation encoding="application/x-tex">\frac{\partial^{2}\ell}{\partial\boldsymbol{\beta}^\top\partial\boldsymbol{\beta}}</annotation></semantics></math><br> from the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>𝐲</mi><annotation encoding="application/x-tex">\boldsymbol{y}</annotation></semantics></math>
vector and the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐗</mi><mrow><mi>v</mi><mi>l</mi><mi>m</mi></mrow></msub><annotation encoding="application/x-tex">\boldsymbol{X}_{vlm}</annotation></semantics></math>
matrix. The <code>deriv</code> argument has possible values in
<code>c(0, 1, 2)</code> that determine which derivative to return; the
default value is <code>0</code>, which represents the minus
log-likelihood.</td>
</tr>
<tr class="even">
<td><code>links</code></td>
<td>A list with link functions;</td>
</tr>
<tr class="odd">
<td><code>mu.eta, variance</code></td>
<td>Functions of linear predictors that return the expected value and
variance. The <code>type</code> argument with 2 possible values
(<code>"trunc"</code> and <code>"nontrunc"</code>) specifies whether to
return
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝔼</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo stretchy="false" form="prefix">|</mo><mi>Y</mi><mo>&gt;</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow><mo>,</mo><mtext mathvariant="normal">var</mtext><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo stretchy="false" form="prefix">|</mo><mi>Y</mi><mo>&gt;</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbb{E}[Y|Y&gt;0], \text{var}[Y|Y&gt;0]</annotation></semantics></math>
or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>𝔼</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>,</mo><mtext mathvariant="normal">var</mtext><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbb{E}[Y], \text{var}[Y]</annotation></semantics></math>
respectively. The <code>deriv</code> argument with values in
<code>c(0, 1, 2)</code> is used for indicating the derivative with
respect to the linear predictors, which is used for providing standard
errors in the <code>predict</code> method.</td>
</tr>
<tr class="even">
<td><code>family</code></td>
<td>A string that specifies the model name;</td>
</tr>
<tr class="odd">
<td><code>valideta, validmu</code></td>
<td>For now, it only returns <code>TRUE</code>. In the near future, it
will be used to check whether applied linear predictors are valid (i.e.,
are transformed into some elements of the parameter space subjected to
the inverse link function).</td>
</tr>
<tr class="even">
<td><code>funcZ, Wfun</code></td>
<td>Functions that create pseudo residuals and working weights used in
the IRLS algorithm;</td>
</tr>
<tr class="odd">
<td><code>devResids</code></td>
<td>A function that returns deviance residuals given a vector of prior
weights of linear predictors and the response vector;</td>
</tr>
<tr class="even">
<td><code>pointEst, popVar</code></td>
<td>Functions that return the point estimate for the population size and
analytic estimation of its variance given prior weights of linear
predictors and, in the latter case, also estimates of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mtext mathvariant="normal">cov</mtext><mrow><mo stretchy="true" form="prefix">(</mo><mover><mi>𝛃</mi><mo accent="true">̂</mo></mover><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\text{cov}(\hat{\boldsymbol{\beta}})</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><msub><mi>𝐗</mi><mtext mathvariant="normal">vlm</mtext></msub><annotation encoding="application/x-tex">\boldsymbol{X}_{\text{vlm}}</annotation></semantics></math>
matrix. There is an additional boolean parameter <code>contr</code> in
the former function, which, if set to <code>TRUE</code>, returns the
contribution of each unit.</td>
</tr>
<tr class="odd">
<td><code>etaNames</code></td>
<td>Names of linear predictors;</td>
</tr>
<tr class="even">
<td><code>densityFunction</code></td>
<td>A function that returns the value of PMF at values of <code>x</code>
given linear predictors. The <code>type</code> argument specifies
whether to return
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo stretchy="false" form="prefix">|</mo><mi>Y</mi><mo>&gt;</mo><mn>0</mn><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbb{P}[Y|Y&gt;0]</annotation></semantics></math>
or
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo stretchy="true" form="postfix">]</mo></mrow></mrow><annotation encoding="application/x-tex">\mathbb{P}[Y]</annotation></semantics></math>;</td>
</tr>
<tr class="odd">
<td><code>simulate</code></td>
<td>A function that generates values of a dependent vector given linear
predictors;</td>
</tr>
<tr class="even">
<td><code>getStart</code></td>
<td>An expression for generating starting points;</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level2" short-title="Implementing custom singleRcapture family function">
<h2 id="sec-custom">Implementing a custom <strong>singleRcapture</strong> family
function<a class="anchor" aria-label="anchor" href="#sec-custom"></a>
</h2>
<p>Suppose we want to implement a very specific zero truncated family
function in the <strong>singleRcapture</strong>, which corresponds to
the following “untruncated” distribution:</p>
<p><math display="block" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>ℙ</mi><mrow><mo stretchy="true" form="prefix">[</mo><mi>Y</mi><mo>=</mo><mi>y</mi><mo stretchy="false" form="prefix">|</mo><mi>λ</mi><mo>,</mo><mi>π</mi><mo stretchy="true" form="postfix">]</mo></mrow><mo>=</mo><mrow><mo stretchy="true" form="prefix">{</mo><mtable><mtr><mtd columnalign="left" style="text-align: left"><mn>1</mn><mo>−</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mi>λ</mi><mo>−</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mi>π</mi></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">when: </mtext><mspace width="0.333em"></mspace></mrow><mi>y</mi><mo>=</mo><mn>0</mn></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mfrac><mn>1</mn><mn>2</mn></mfrac><mi>π</mi></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">when: </mtext><mspace width="0.333em"></mspace></mrow><mi>y</mi><mo>=</mo><mn>1</mn></mtd></mtr><mtr><mtd columnalign="left" style="text-align: left"><mfrac><mn>1</mn><mn>2</mn></mfrac><mi>λ</mi></mtd><mtd columnalign="left" style="text-align: left"><mrow><mtext mathvariant="normal">when: </mtext><mspace width="0.333em"></mspace></mrow><mi>y</mi><mo>=</mo><mn>2</mn><mo>,</mo></mtd></mtr></mtable></mrow></mrow><annotation encoding="application/x-tex">
  \mathbb{P}[Y=y|\lambda, \pi] = \begin{cases}
    1 - \frac{1}{2}\lambda - \frac{1}{2}\pi &amp; \text{when: } y=0\\
    \frac{1}{2}\pi &amp; \text{when: } y=1\\
    \frac{1}{2}\lambda &amp; \text{when: } y=2,
  \end{cases}
</annotation></semantics></math></p>
<p>with
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>λ</mi><mo>,</mo><mi>π</mi><mo>∈</mo><mrow><mo stretchy="true" form="prefix">(</mo><mn>0</mn><mo>,</mo><mn>1</mn><mo stretchy="true" form="postfix">)</mo></mrow></mrow><annotation encoding="application/x-tex">\lambda, \pi\in\left(0, 1\right)</annotation></semantics></math>
being dependent on covariates.</p>
<p>Below we provide a possible way of implementing the above model, with
<code>lambda, pi</code> meaning
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mfrac><mn>1</mn><mn>2</mn></mfrac><mi>λ</mi><mo>,</mo><mfrac><mn>1</mn><mn>2</mn></mfrac><mi>π</mi></mrow><annotation encoding="application/x-tex">\frac{1}{2}\lambda,\frac{1}{2}\pi</annotation></semantics></math>.
We provide a simple example that shows that the proposed approach works
as expected.</p>
<div class="sourceCode" id="cb60"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">myFamilyFunction</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">lambdaLink</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"logit"</span>, <span class="st">"cloglog"</span>, <span class="st">"probit"</span><span class="op">)</span>,</span>
<span>                             <span class="va">piLink</span>     <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"logit"</span>, <span class="st">"cloglog"</span>, <span class="st">"probit"</span><span class="op">)</span>,</span>
<span>                             <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html" class="external-link">missing</a></span><span class="op">(</span><span class="va">lambdaLink</span><span class="op">)</span><span class="op">)</span> <span class="va">lambdaLink</span> <span class="op">&lt;-</span> <span class="st">"logit"</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html" class="external-link">missing</a></span><span class="op">(</span><span class="va">piLink</span><span class="op">)</span><span class="op">)</span>         <span class="va">piLink</span> <span class="op">&lt;-</span> <span class="st">"logit"</span></span>
<span></span>
<span>  <span class="va">links</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="op">)</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">links</span>, <span class="st">"linkNames"</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lambdaLink</span>, <span class="va">piLink</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">lambdaLink</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">lambdaLink</span>,</span>
<span>                       <span class="st">"logit"</span>   <span class="op">=</span> <span class="fu">singleRcapture</span><span class="fu">:::</span><span class="va">singleRinternallogitLink</span>,</span>
<span>                       <span class="st">"cloglog"</span> <span class="op">=</span> <span class="fu">singleRcapture</span><span class="fu">:::</span><span class="va">singleRinternalcloglogLink</span>,</span>
<span>                       <span class="st">"probit"</span>  <span class="op">=</span> <span class="fu">singleRcapture</span><span class="fu">:::</span><span class="va">singleRinternalprobitLink</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">piLink</span> <span class="op">&lt;-</span> <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span><span class="op">(</span><span class="va">piLink</span>,</span>
<span>                   <span class="st">"logit"</span>   <span class="op">=</span> <span class="fu">singleRcapture</span><span class="fu">:::</span><span class="va">singleRinternallogitLink</span>,</span>
<span>                   <span class="st">"cloglog"</span> <span class="op">=</span> <span class="fu">singleRcapture</span><span class="fu">:::</span><span class="va">singleRinternalcloglogLink</span>,</span>
<span>                   <span class="st">"probit"</span>  <span class="op">=</span> <span class="fu">singleRcapture</span><span class="fu">:::</span><span class="va">singleRinternalprobitLink</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="va">links</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">2</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">lambdaLink</span>, <span class="va">piLink</span><span class="op">)</span></span>
<span></span>
<span>  <span class="va">mu.eta</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">eta</span>, <span class="va">type</span> <span class="op">=</span> <span class="st">"trunc"</span>, <span class="va">deriv</span> <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">pi</span>     <span class="op">&lt;-</span>     <span class="fu">piLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>    <span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu">lambdaLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="va">deriv</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span> <span class="op">(</span><span class="va">type</span>,</span>
<span>              <span class="st">"nontrunc"</span> <span class="op">=</span> <span class="va">pi</span> <span class="op">+</span> <span class="fl">2</span> <span class="op">*</span> <span class="va">lambda</span>,</span>
<span>              <span class="st">"trunc"</span> <span class="op">=</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">lambda</span> <span class="op">/</span> <span class="op">(</span><span class="va">pi</span> <span class="op">+</span> <span class="va">lambda</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>      <span class="co"># Only necessary if one wishes to use standard errors in predict method</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span> <span class="op">(</span><span class="va">type</span>,</span>
<span>              <span class="st">"nontrunc"</span> <span class="op">=</span> <span class="op">{</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>                  <span class="fu">lambdaLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span>, deriv <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>,</span>
<span>                  <span class="fu">piLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span>, deriv <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>                <span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>              <span class="op">}</span>,</span>
<span>              <span class="st">"trunc"</span> <span class="op">=</span> <span class="op">{</span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>                  <span class="va">pi</span> <span class="op">/</span> <span class="op">(</span><span class="va">pi</span> <span class="op">+</span> <span class="va">lambda</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span>,</span>
<span>                  <span class="op">-</span><span class="va">lambda</span> <span class="op">/</span> <span class="op">(</span><span class="va">pi</span> <span class="op">+</span> <span class="va">lambda</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span></span>
<span>                <span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>                  <span class="fu">lambdaLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span>, deriv <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span>,</span>
<span>                  <span class="fu">piLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span>, deriv <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>                <span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>              <span class="op">}</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">variance</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">eta</span>, <span class="va">type</span> <span class="op">=</span> <span class="st">"nontrunc"</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">pi</span>     <span class="op">&lt;-</span>     <span class="fu">piLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>    <span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu">lambdaLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span> <span class="op">(</span><span class="va">type</span>,</span>
<span>            <span class="st">"nontrunc"</span> <span class="op">=</span> <span class="va">pi</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">pi</span><span class="op">)</span> <span class="op">+</span> <span class="fl">4</span> <span class="op">*</span> <span class="va">lambda</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">lambda</span> <span class="op">-</span> <span class="va">pi</span><span class="op">)</span>,</span>
<span>            <span class="st">"trunc"</span> <span class="op">=</span> <span class="va">lambda</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">lambda</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">pi</span> <span class="op">+</span> <span class="va">lambda</span><span class="op">)</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">Wfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">prior</span>, <span class="va">y</span>, <span class="va">eta</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">pi</span>     <span class="op">&lt;-</span>     <span class="fu">piLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>    <span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu">lambdaLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span></span>
<span>    <span class="va">G01</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">lambda</span> <span class="op">+</span> <span class="va">pi</span><span class="op">)</span> <span class="op">^</span> <span class="op">(</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> <span class="fu">piLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span>, deriv <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span></span>
<span>      <span class="fu">lambdaLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span>, deriv <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="va">prior</span> <span class="op">/</span> <span class="fl">4</span></span>
<span></span>
<span>    <span class="va">G00</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">lambda</span> <span class="op">+</span> <span class="va">pi</span><span class="op">)</span> <span class="op">^</span> <span class="op">(</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">pi</span> <span class="op">^</span> <span class="op">(</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="va">lambda</span> <span class="op">/</span> <span class="op">(</span><span class="op">(</span><span class="va">lambda</span> <span class="op">+</span> <span class="va">pi</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="va">pi</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="va">G00</span> <span class="op">&lt;-</span> <span class="va">G00</span> <span class="op">*</span> <span class="va">prior</span> <span class="op">*</span> <span class="op">(</span><span class="fu">piLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span>, deriv <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fl">4</span></span>
<span></span>
<span>    <span class="va">G11</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">lambda</span> <span class="op">+</span> <span class="va">pi</span><span class="op">)</span> <span class="op">^</span> <span class="op">(</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="op">(</span><span class="op">(</span><span class="va">lambda</span> <span class="op">+</span> <span class="va">pi</span><span class="op">)</span> <span class="op">*</span> <span class="va">lambda</span><span class="op">)</span> <span class="op">^</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">G11</span> <span class="op">&lt;-</span> <span class="va">G11</span> <span class="op">*</span> <span class="va">prior</span> <span class="op">*</span> <span class="op">(</span><span class="fu">lambdaLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span>, deriv <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fl">4</span></span>
<span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span></span>
<span>      <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">G11</span>, <span class="co"># lambda</span></span>
<span>         <span class="va">G01</span>, <span class="co"># mixed</span></span>
<span>         <span class="va">G01</span>, <span class="co"># mixed</span></span>
<span>         <span class="va">G00</span>  <span class="co"># pi</span></span>
<span>      <span class="op">)</span>,</span>
<span>      dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">rownames</a></span><span class="op">(</span><span class="va">eta</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lambda"</span>, <span class="st">"mixed"</span>, <span class="st">"mixed"</span>, <span class="st">"pi"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>      ncol <span class="op">=</span> <span class="fl">4</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">funcZ</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">eta</span>, <span class="va">weight</span>, <span class="va">y</span>, <span class="va">prior</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">pi</span>     <span class="op">&lt;-</span>     <span class="fu">piLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>    <span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu">lambdaLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span></span>
<span>    <span class="va">weight</span> <span class="op">&lt;-</span> <span class="va">weight</span> <span class="op">/</span> <span class="va">prior</span></span>
<span></span>
<span>    <span class="va">G0</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span> <span class="op">-</span> <span class="va">y</span><span class="op">)</span> <span class="op">/</span> <span class="va">pi</span>     <span class="op">-</span> <span class="op">(</span><span class="op">(</span><span class="va">lambda</span> <span class="op">+</span> <span class="va">pi</span><span class="op">)</span> <span class="op">^</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>    <span class="va">G1</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="va">lambda</span> <span class="op">-</span> <span class="op">(</span><span class="op">(</span><span class="va">lambda</span> <span class="op">+</span> <span class="va">pi</span><span class="op">)</span> <span class="op">^</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">G1</span> <span class="op">&lt;-</span> <span class="va">G1</span> <span class="op">*</span> <span class="fu">lambdaLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span>, deriv <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>    <span class="va">G0</span> <span class="op">&lt;-</span> <span class="va">G0</span> <span class="op">*</span>     <span class="fu">piLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span>, deriv <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span></span>
<span>    <span class="va">uMatrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">G1</span>, <span class="va">G0</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">weight</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span>, FUN <span class="op">=</span> <span class="kw">function</span> <span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">weight</span><span class="op">[</span><span class="va">x</span>, <span class="op">]</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">pseudoResid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span>X <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span>, FUN <span class="op">=</span> <span class="kw">function</span> <span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="co">#xx &lt;- chol2inv(chol(weight[[x]])) # less computationally demanding</span></span>
<span>      <span class="va">xx</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">weight</span><span class="op">[[</span><span class="va">x</span><span class="op">]</span><span class="op">]</span><span class="op">)</span> <span class="co"># more stable</span></span>
<span>      <span class="va">xx</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">uMatrix</span><span class="op">[</span><span class="va">x</span>, <span class="op">]</span></span>
<span>    <span class="op">}</span><span class="op">)</span></span>
<span>    <span class="va">pseudoResid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">pseudoResid</span><span class="op">)</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">pseudoResid</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/dimnames.html" class="external-link">dimnames</a></span><span class="op">(</span><span class="va">eta</span><span class="op">)</span></span>
<span>    <span class="va">pseudoResid</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">minusLogLike</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">X</span>, <span class="va">offset</span>,</span>
<span>                           <span class="va">weight</span>    <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                           <span class="va">NbyK</span>      <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                           <span class="va">vectorDer</span> <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>                           <span class="va">deriv</span>     <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                           <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/NULL.html" class="external-link">is.null</a></span><span class="op">(</span><span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">weight</span> <span class="op">&lt;-</span> <span class="fl">1</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html" class="external-link">missing</a></span><span class="op">(</span><span class="va">offset</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">offset</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">NROW</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="op">(</span><span class="va">deriv</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="kw"><a href="https://rdrr.io/r/base/stop.html" class="external-link">stop</a></span><span class="op">(</span><span class="st">"Only score function and derivatives up to 2 are supported."</span><span class="op">)</span></span>
<span>    <span class="va">deriv</span> <span class="op">&lt;-</span> <span class="va">deriv</span> <span class="op">+</span> <span class="fl">1</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span> <span class="op">(</span><span class="va">deriv</span>,</span>
<span>            <span class="kw">function</span><span class="op">(</span><span class="va">beta</span><span class="op">)</span> <span class="op">{</span></span>
<span>              <span class="va">eta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">offset</span></span>
<span>              <span class="va">pi</span>     <span class="op">&lt;-</span>     <span class="fu">piLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>              <span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu">lambdaLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>              <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">weight</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="fl">2</span> <span class="op">-</span> <span class="va">y</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">pi</span><span class="op">)</span> <span class="op">+</span> <span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">lambda</span><span class="op">)</span> <span class="op">-</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">log</a></span><span class="op">(</span><span class="va">pi</span> <span class="op">+</span> <span class="va">lambda</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>            <span class="op">}</span>,</span>
<span>            <span class="kw">function</span><span class="op">(</span><span class="va">beta</span><span class="op">)</span> <span class="op">{</span></span>
<span>              <span class="va">eta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">offset</span></span>
<span>              <span class="va">pi</span>     <span class="op">&lt;-</span>     <span class="fu">piLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>              <span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu">lambdaLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span></span>
<span>              <span class="va">G0</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span> <span class="op">-</span> <span class="va">y</span><span class="op">)</span> <span class="op">/</span> <span class="va">pi</span>     <span class="op">-</span> <span class="op">(</span><span class="op">(</span><span class="va">lambda</span> <span class="op">+</span> <span class="va">pi</span><span class="op">)</span> <span class="op">^</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span>              <span class="va">G1</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="va">lambda</span> <span class="op">-</span> <span class="op">(</span><span class="op">(</span><span class="va">lambda</span> <span class="op">+</span> <span class="va">pi</span><span class="op">)</span> <span class="op">^</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span>              <span class="va">G1</span> <span class="op">&lt;-</span> <span class="va">G1</span> <span class="op">*</span> <span class="va">weight</span> <span class="op">*</span> <span class="fu">lambdaLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span>, deriv <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>              <span class="va">G0</span> <span class="op">&lt;-</span> <span class="va">G0</span> <span class="op">*</span> <span class="va">weight</span> <span class="op">*</span>     <span class="fu">piLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span>, deriv <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span></span>
<span>              <span class="kw">if</span> <span class="op">(</span><span class="va">NbyK</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="va">XX</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">X</span>, <span class="st">"hwm"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>                <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">eta</span><span class="op">)</span>, <span class="va">XX</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">G1</span>,</span>
<span>                             <span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">eta</span><span class="op">)</span><span class="op">)</span>, <span class="op">-</span><span class="va">XX</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span> <span class="va">G0</span><span class="op">)</span><span class="op">)</span></span>
<span>              <span class="op">}</span></span>
<span>              <span class="kw">if</span> <span class="op">(</span><span class="va">vectorDer</span><span class="op">)</span> <span class="op">{</span></span>
<span>                <span class="kw"><a href="https://rdrr.io/r/base/function.html" class="external-link">return</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span><span class="va">G1</span>, <span class="va">G0</span><span class="op">)</span><span class="op">)</span></span>
<span>              <span class="op">}</span></span>
<span></span>
<span>              <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">G1</span>, <span class="va">G0</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">X</span><span class="op">)</span></span>
<span>            <span class="op">}</span>,</span>
<span>            <span class="kw">function</span> <span class="op">(</span><span class="va">beta</span><span class="op">)</span> <span class="op">{</span></span>
<span>              <span class="va">lambdaPredNumber</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">X</span>, <span class="st">"hwm"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span>              <span class="va">eta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">beta</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span> <span class="va">offset</span></span>
<span>              <span class="va">pi</span>     <span class="op">&lt;-</span>     <span class="fu">piLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>              <span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu">lambdaLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span></span>
<span>              <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>nrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span>, ncol <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span>,</span>
<span>                            dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">beta</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>              <span class="co"># pi^2 derivative</span></span>
<span>              <span class="va">dpi</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="fl">2</span> <span class="op">-</span> <span class="va">y</span><span class="op">)</span> <span class="op">/</span> <span class="va">pi</span> <span class="op">-</span> <span class="op">(</span><span class="va">lambda</span> <span class="op">+</span> <span class="va">pi</span><span class="op">)</span> <span class="op">^</span> <span class="op">-</span><span class="fl">1</span></span>
<span>              <span class="va">G00</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">lambda</span> <span class="op">+</span> <span class="va">pi</span><span class="op">)</span> <span class="op">^</span> <span class="op">(</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="fl">2</span> <span class="op">-</span> <span class="va">y</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">pi</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span>              <span class="va">G00</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>, <span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">lambdaPredNumber</span><span class="op">)</span><span class="op">]</span> <span class="op">*</span></span>
<span>                                       <span class="op">(</span><span class="va">G00</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="fu">piLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span>, deriv <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>                                          <span class="va">dpi</span> <span class="op">*</span> <span class="fu">piLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span>, deriv <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>, <span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">lambdaPredNumber</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>              <span class="co"># mixed derivative</span></span>
<span>              <span class="va">G01</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">lambda</span> <span class="op">+</span> <span class="va">pi</span><span class="op">)</span> <span class="op">^</span> <span class="op">(</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span>              <span class="va">G01</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="va">lambdaPredNumber</span><span class="op">]</span><span class="op">)</span> <span class="op">*</span></span>
<span>                         <span class="va">G01</span> <span class="op">*</span> <span class="op">(</span><span class="fu">lambdaLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span>, deriv <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span></span>
<span>                         <span class="op">(</span><span class="fu">piLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span>, deriv <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="va">weight</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span></span>
<span>                <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span>, <span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">lambdaPredNumber</span><span class="op">)</span><span class="op">]</span><span class="op">)</span></span>
<span>              <span class="co"># lambda^2 derivative</span></span>
<span>              <span class="va">G11</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="op">(</span><span class="va">lambda</span> <span class="op">+</span> <span class="va">pi</span><span class="op">)</span> <span class="op">^</span> <span class="op">(</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">-</span> <span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">lambda</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span></span>
<span>              <span class="va">dlambda</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">y</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="va">lambda</span> <span class="op">-</span> <span class="op">(</span><span class="op">(</span><span class="va">lambda</span> <span class="op">+</span> <span class="va">pi</span><span class="op">)</span> <span class="op">^</span> <span class="op">-</span><span class="fl">1</span><span class="op">)</span></span>
<span></span>
<span>              <span class="va">G11</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/as.data.frame.html" class="external-link">as.data.frame</a></span><span class="op">(</span><span class="va">X</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="va">lambdaPredNumber</span><span class="op">]</span> <span class="op">*</span></span>
<span>                                       <span class="op">(</span><span class="va">G11</span> <span class="op">*</span> <span class="op">(</span><span class="op">(</span><span class="fu">lambdaLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span>, deriv <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span> <span class="op">+</span></span>
<span>                                          <span class="va">dlambda</span> <span class="op">*</span> <span class="fu">lambdaLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span>, deriv <span class="op">=</span> <span class="fl">2</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="va">weight</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span></span>
<span>                <span class="va">X</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html" class="external-link">nrow</a></span><span class="op">(</span><span class="va">X</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="va">lambdaPredNumber</span><span class="op">]</span></span>
<span></span>
<span>              <span class="va">res</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">lambdaPredNumber</span><span class="op">)</span>, <span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">lambdaPredNumber</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">G00</span></span>
<span>              <span class="va">res</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">lambdaPredNumber</span>, <span class="fl">1</span><span class="op">:</span><span class="va">lambdaPredNumber</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">G11</span></span>
<span>              <span class="va">res</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="va">lambdaPredNumber</span>, <span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">lambdaPredNumber</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">G01</span><span class="op">)</span></span>
<span>              <span class="va">res</span><span class="op">[</span><span class="op">-</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">lambdaPredNumber</span><span class="op">)</span>, <span class="fl">1</span><span class="op">:</span><span class="va">lambdaPredNumber</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">G01</span></span>
<span></span>
<span>              <span class="va">res</span></span>
<span>            <span class="op">}</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">validmu</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">mu</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/is.finite.html" class="external-link">is.finite</a></span><span class="op">(</span><span class="va">mu</span><span class="op">)</span><span class="op">)</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fl">0</span> <span class="op">&lt;</span> <span class="va">mu</span><span class="op">)</span> <span class="op">&amp;&amp;</span> <span class="fu"><a href="https://rdrr.io/r/base/all.html" class="external-link">all</a></span><span class="op">(</span><span class="fl">2</span> <span class="op">&gt;</span> <span class="va">mu</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="co"># this is optional</span></span>
<span>  <span class="va">devResids</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">y</span>, <span class="va">eta</span>, <span class="va">wt</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="fl">0</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">pointEst</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">pw</span>, <span class="va">eta</span>, <span class="va">contr</span> <span class="op">=</span> <span class="cn">FALSE</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">pi</span>     <span class="op">&lt;-</span>     <span class="fu">piLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>    <span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu">lambdaLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>    <span class="va">N</span> <span class="op">&lt;-</span> <span class="va">pw</span> <span class="op">/</span> <span class="op">(</span><span class="va">lambda</span> <span class="op">+</span> <span class="va">pi</span><span class="op">)</span></span>
<span>    <span class="kw">if</span><span class="op">(</span><span class="op">!</span><span class="va">contr</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">N</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">N</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">N</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">popVar</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">pw</span>, <span class="va">eta</span>, <span class="va">cov</span>, <span class="va">Xvlm</span>, <span class="va">...</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">pi</span>     <span class="op">&lt;-</span>     <span class="fu">piLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>    <span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu">lambdaLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span></span>
<span>    <span class="va">bigTheta1</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">pw</span> <span class="op">/</span> <span class="op">(</span><span class="va">pi</span> <span class="op">+</span> <span class="va">lambda</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span> <span class="co"># w.r to pi</span></span>
<span>    <span class="va">bigTheta1</span> <span class="op">&lt;-</span> <span class="va">bigTheta1</span> <span class="op">*</span> <span class="fu">piLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span>, deriv <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>    <span class="va">bigTheta2</span> <span class="op">&lt;-</span> <span class="op">-</span><span class="va">pw</span> <span class="op">/</span> <span class="op">(</span><span class="va">pi</span> <span class="op">+</span> <span class="va">lambda</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span> <span class="co"># w.r to lambda</span></span>
<span>    <span class="va">bigTheta2</span> <span class="op">&lt;-</span> <span class="va">bigTheta2</span> <span class="op">*</span> <span class="fu">lambdaLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span>, deriv <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span> <span class="co"># w.r to lambda</span></span>
<span></span>
<span>    <span class="va">bigTheta</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">bigTheta2</span>, <span class="va">bigTheta1</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">Xvlm</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">f1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/t.html" class="external-link">t</a></span><span class="op">(</span><span class="va">bigTheta</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">as.matrix</a></span><span class="op">(</span><span class="va">cov</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">bigTheta</span></span>
<span></span>
<span>    <span class="va">f2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">pw</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">pi</span> <span class="op">-</span> <span class="va">lambda</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="op">(</span><span class="va">pi</span> <span class="op">+</span> <span class="va">lambda</span><span class="op">)</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span>    <span class="va">f1</span> <span class="op">+</span> <span class="va">f2</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">dFun</span> <span class="op">&lt;-</span> <span class="kw">function</span> <span class="op">(</span><span class="va">x</span>, <span class="va">eta</span>, <span class="va">type</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"trunc"</span>, <span class="st">"nontrunc"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/missing.html" class="external-link">missing</a></span><span class="op">(</span><span class="va">type</span><span class="op">)</span><span class="op">)</span> <span class="va">type</span> <span class="op">&lt;-</span> <span class="st">"trunc"</span></span>
<span>    <span class="va">pi</span>     <span class="op">&lt;-</span>     <span class="fu">piLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>    <span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu">lambdaLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span></span>
<span>    <span class="kw"><a href="https://rdrr.io/r/base/switch.html" class="external-link">switch</a></span> <span class="op">(</span><span class="va">type</span>,</span>
<span>            <span class="st">"trunc"</span> <span class="op">=</span> <span class="op">{</span></span>
<span>              <span class="op">(</span><span class="va">pi</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="va">lambda</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">pi</span> <span class="op">+</span> <span class="va">lambda</span><span class="op">)</span></span>
<span>            <span class="op">}</span>,</span>
<span>            <span class="st">"nontrunc"</span> <span class="op">=</span> <span class="op">{</span></span>
<span>              <span class="op">(</span><span class="fl">1</span> <span class="op">-</span> <span class="va">pi</span> <span class="op">-</span> <span class="va">lambda</span><span class="op">)</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="fl">0</span><span class="op">)</span> <span class="op">+</span></span>
<span>                <span class="va">pi</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span> <span class="va">lambda</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span></span>
<span>            <span class="op">}</span></span>
<span>    <span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">simulate</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">n</span>, <span class="va">eta</span>, <span class="va">lower</span> <span class="op">=</span> <span class="fl">0</span>, <span class="va">upper</span> <span class="op">=</span> <span class="cn">Inf</span><span class="op">)</span> <span class="op">{</span></span>
<span>    <span class="va">pi</span>     <span class="op">&lt;-</span>     <span class="fu">piLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">2</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>    <span class="va">lambda</span> <span class="op">&lt;-</span> <span class="fu">lambdaLink</span><span class="op">(</span><span class="va">eta</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, inverse <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">/</span> <span class="fl">2</span></span>
<span>    <span class="va">CDF</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">==</span> <span class="cn">Inf</span>, <span class="fl">1</span>,</span>
<span>             <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">0</span>, <span class="fl">0</span>,</span>
<span>                    <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">1</span>, <span class="fl">1</span> <span class="op">-</span> <span class="va">pi</span> <span class="op">-</span> <span class="va">lambda</span>,</span>
<span>                           <span class="fu"><a href="https://rdrr.io/r/base/ifelse.html" class="external-link">ifelse</a></span><span class="op">(</span><span class="va">x</span> <span class="op">&lt;</span> <span class="fl">2</span>, <span class="fl">1</span> <span class="op">-</span> <span class="va">lambda</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">lb</span> <span class="op">&lt;-</span> <span class="fu">CDF</span><span class="op">(</span><span class="va">lower</span><span class="op">)</span></span>
<span>    <span class="va">ub</span> <span class="op">&lt;-</span> <span class="fu">CDF</span><span class="op">(</span><span class="va">upper</span><span class="op">)</span></span>
<span>    <span class="va">p_u</span> <span class="op">&lt;-</span> <span class="fu">stats</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">n</span>, <span class="va">lb</span>, <span class="va">ub</span><span class="op">)</span></span>
<span>    <span class="va">sims</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">n</span><span class="op">)</span></span>
<span>    <span class="va">cond</span> <span class="op">&lt;-</span> <span class="fu">CDF</span><span class="op">(</span><span class="va">sims</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">p_u</span></span>
<span>    <span class="kw">while</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/any.html" class="external-link">any</a></span><span class="op">(</span><span class="va">cond</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">sims</span><span class="op">[</span><span class="va">cond</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">sims</span><span class="op">[</span><span class="va">cond</span><span class="op">]</span> <span class="op">+</span> <span class="fl">1</span></span>
<span>      <span class="va">cond</span> <span class="op">&lt;-</span> <span class="fu">CDF</span><span class="op">(</span><span class="va">sims</span><span class="op">)</span> <span class="op">&lt;=</span> <span class="va">p_u</span></span>
<span>    <span class="op">}</span></span>
<span>    <span class="va">sims</span></span>
<span>  <span class="op">}</span></span>
<span></span>
<span>  <span class="va">getStart</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/expression.html" class="external-link">expression</a></span><span class="op">(</span></span>
<span>    <span class="kw">if</span> <span class="op">(</span><span class="va">method</span> <span class="op">==</span> <span class="st">"IRLS"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">etaStart</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">cbind</a></span><span class="op">(</span></span>
<span>        <span class="va">family</span><span class="op">$</span><span class="va">links</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">observed</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">0</span> <span class="op">*</span> <span class="op">(</span><span class="va">observed</span> <span class="op">==</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>, <span class="co"># lambda</span></span>
<span>        <span class="va">family</span><span class="op">$</span><span class="va">links</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">observed</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span> <span class="op">*</span> <span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="fl">0</span> <span class="op">*</span> <span class="op">(</span><span class="va">observed</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>  <span class="co"># pi</span></span>
<span>      <span class="op">)</span> <span class="op">+</span> <span class="va">offset</span></span>
<span>    <span class="op">}</span> <span class="kw">else</span> <span class="kw">if</span> <span class="op">(</span><span class="va">method</span> <span class="op">==</span> <span class="st">"optim"</span><span class="op">)</span> <span class="op">{</span></span>
<span>      <span class="va">init</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        <span class="va">family</span><span class="op">$</span><span class="va">links</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="va">observed</span> <span class="op">==</span> <span class="fl">2</span>, <span class="va">priorWeights</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1</span> <span class="op">+</span> <span class="fl">.0001</span><span class="op">)</span>,</span>
<span>        <span class="va">family</span><span class="op">$</span><span class="va">links</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span><span class="va">observed</span> <span class="op">==</span> <span class="fl">1</span>, <span class="va">priorWeights</span><span class="op">)</span> <span class="op">*</span> <span class="fl">1</span> <span class="op">+</span> <span class="fl">.0001</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">terms</span>, <span class="st">"intercept"</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">coefStart</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">init</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">Xvlm</span>, <span class="st">"hwm"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">coefStart</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">init</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">Xvlm</span>, <span class="st">"hwm"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">Xvlm</span>, <span class="st">"hwm"</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>      <span class="kw">if</span> <span class="op">(</span><span class="st">"(Intercept):pi"</span> <span class="op"><a href="https://rdrr.io/r/base/match.html" class="external-link">%in%</a></span> <span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="va">Xvlm</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>        <span class="va">coefStart</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">coefStart</span>, <span class="va">init</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">Xvlm</span>, <span class="st">"hwm"</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">-</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">}</span> <span class="kw">else</span> <span class="op">{</span></span>
<span>        <span class="va">coefStart</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">coefStart</span>, <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="va">init</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">Xvlm</span>, <span class="st">"hwm"</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span>, <span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">Xvlm</span>, <span class="st">"hwm"</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span>      <span class="op">}</span></span>
<span>    <span class="op">}</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/structure.html" class="external-link">structure</a></span><span class="op">(</span></span>
<span>    <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>      makeMinusLogLike <span class="op">=</span> <span class="va">minusLogLike</span>,</span>
<span>      densityFunction  <span class="op">=</span> <span class="va">dFun</span>,</span>
<span>      links     <span class="op">=</span> <span class="va">links</span>,</span>
<span>      mu.eta    <span class="op">=</span> <span class="va">mu.eta</span>,</span>
<span>      valideta  <span class="op">=</span> <span class="kw">function</span> <span class="op">(</span><span class="va">eta</span><span class="op">)</span> <span class="op">{</span><span class="cn">TRUE</span><span class="op">}</span>,</span>
<span>      variance  <span class="op">=</span> <span class="va">variance</span>,</span>
<span>      Wfun      <span class="op">=</span> <span class="va">Wfun</span>,</span>
<span>      funcZ     <span class="op">=</span> <span class="va">funcZ</span>,</span>
<span>      devResids <span class="op">=</span> <span class="va">devResids</span>,</span>
<span>      validmu   <span class="op">=</span> <span class="va">validmu</span>,</span>
<span>      pointEst  <span class="op">=</span> <span class="va">pointEst</span>,</span>
<span>      popVar    <span class="op">=</span> <span class="va">popVar</span>,</span>
<span>      family    <span class="op">=</span> <span class="st">"myFamilyFunction"</span>,</span>
<span>      etaNames  <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"lambda"</span>, <span class="st">"pi"</span><span class="op">)</span>,</span>
<span>      simulate  <span class="op">=</span> <span class="va">simulate</span>,</span>
<span>      getStart  <span class="op">=</span> <span class="va">getStart</span>,</span>
<span>      extraInfo <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>        mean       <span class="op">=</span> <span class="st">"pi / 2 + lambda"</span>,</span>
<span>        variance   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"(pi / 2) * (1 - pi / 2) + 2 * lambda * (1 - lambda / 2 - pi / 2)"</span><span class="op">)</span>,</span>
<span>        popSizeEst <span class="op">=</span> <span class="st">"(1 - (pi + lambda) / 2) ^ -1"</span>,</span>
<span>        meanTr     <span class="op">=</span> <span class="st">"1 + lambda / (pi + lambda)"</span>,</span>
<span>        varianceTr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste0</a></span><span class="op">(</span><span class="st">"lambda * (1 - lambda / 2) / (pi + lambda)"</span><span class="op">)</span></span>
<span>      <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    class <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"singleRfamily"</span>, <span class="st">"family"</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>A quick tests shows us that this implementation in fact works:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/simulate.html">simulate</a></span><span class="op">(</span></span>
<span>  <span class="fu">myFamilyFunction</span><span class="op">(</span>lambdaLink <span class="op">=</span> <span class="st">"logit"</span>, piLink <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>,</span>
<span>  nsim <span class="op">=</span> <span class="fl">1000</span>, eta <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fl">0</span>, nrow <span class="op">=</span> <span class="fl">1000</span>, ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span>,</span>
<span>  truncated <span class="op">=</span> <span class="cn">FALSE</span></span>
<span><span class="op">)</span></span>
<span><span class="va">mm</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/estimatePopsize.html">estimatePopsize</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">Y</span> <span class="op">~</span> <span class="fl">1</span>,</span>
<span>  data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Y <span class="op">=</span> <span class="va">Y</span><span class="op">[</span><span class="va">Y</span> <span class="op">&gt;</span> <span class="fl">0</span><span class="op">]</span><span class="op">)</span>,</span>
<span>  model <span class="op">=</span> <span class="fu">myFamilyFunction</span><span class="op">(</span>lambdaLink <span class="op">=</span> <span class="st">"logit"</span>,</span>
<span>                           piLink <span class="op">=</span> <span class="st">"logit"</span><span class="op">)</span>,</span>
<span>  <span class="co"># the usual observed information matrix</span></span>
<span>  <span class="co"># is ill-suited for this distribution</span></span>
<span>  controlPopVar <span class="op">=</span> <span class="fu"><a href="../reference/controlPopVar.html">controlPopVar</a></span><span class="op">(</span>covType <span class="op">=</span> <span class="st">"Fisher"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">mm</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">## Call:</span></span>
<span><span class="co">## estimatePopsize.default(formula = Y ~ 1, data = data.frame(Y = Y[Y &gt; </span></span>
<span><span class="co">##     0]), model = myFamilyFunction(lambdaLink = "logit", piLink = "logit"), </span></span>
<span><span class="co">##     controlPopVar = controlPopVar(covType = "Fisher"))</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Pearson Residuals:</span></span>
<span><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">## -0.8198 -0.8198  0.8099  0.0000  0.8099  0.8099 </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Coefficients:</span></span>
<span><span class="co">## -----------------------</span></span>
<span><span class="co">## For linear predictors associated with: lambda </span></span>
<span><span class="co">##             Estimate Std. Error z value P(&gt;|z|)</span></span>
<span><span class="co">## (Intercept)  0.01217    0.20253    0.06   0.952</span></span>
<span><span class="co">## -----------------------</span></span>
<span><span class="co">## For linear predictors associated with: pi </span></span>
<span><span class="co">##             Estimate Std. Error z value P(&gt;|z|)</span></span>
<span><span class="co">## (Intercept) -0.01217    0.08926  -0.136   0.892</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## AIC: 687.4249</span></span>
<span><span class="co">## BIC: 695.8259</span></span>
<span><span class="co">## Residual deviance: 0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Log-likelihood: -341.7124 on 984 Degrees of freedom </span></span>
<span><span class="co">## Number of iterations: 2</span></span>
<span><span class="co">## -----------------------</span></span>
<span><span class="co">## Population size estimation results: </span></span>
<span><span class="co">## Point estimate 986</span></span>
<span><span class="co">## Observed proportion: 50% (N obs = 493)</span></span>
<span><span class="co">## Std. Error 70.30092</span></span>
<span><span class="co">## 95% CI for the population size:</span></span>
<span><span class="co">##           lowerBound upperBound</span></span>
<span><span class="co">## normal      848.2127   1123.787</span></span>
<span><span class="co">## logNormal   866.3167   1144.053</span></span>
<span><span class="co">## 95% CI for the share of observed population:</span></span>
<span><span class="co">##           lowerBound upperBound</span></span>
<span><span class="co">## normal      43.86951   58.12221</span></span>
<span><span class="co">## logNormal   43.09241   56.90759</span></span></code></pre>
<p>where the link functions, such as
<code>singleRcapture:::singleRinternalcloglogLink</code>, are just
internal functions in <code>singleRcapture</code> that compute link
functions, their inverses and derivatives of both links and inverse
links up to the third order:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">singleRcapture</span><span class="fu">:::</span><span class="va">singleRinternalcloglogLink</span></span></code></pre></div>
<pre><code><span><span class="co">## function (x, inverse = FALSE, deriv = 0) </span></span>
<span><span class="co">## {</span></span>
<span><span class="co">##     deriv &lt;- deriv + 1</span></span>
<span><span class="co">##     if (isFALSE(inverse)) {</span></span>
<span><span class="co">##         res &lt;- switch(deriv, log(-log(1 - x)), -1/((1 - x) * </span></span>
<span><span class="co">##             log(1 - x)), -(1 + log(1 - x))/((x - 1)^2 * log(1 - </span></span>
<span><span class="co">##             x)^2), (2 * log(1 - x)^2 + 3 * log(1 - x) + 2)/(log(1 - </span></span>
<span><span class="co">##             x)^3 * (x - 1)^3))</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##     else {</span></span>
<span><span class="co">##         res &lt;- switch(deriv, 1 - exp(-exp(x)), exp(x - exp(x)), </span></span>
<span><span class="co">##             (1 - exp(x)) * exp(x - exp(x)), (exp(2 * x) - 3 * </span></span>
<span><span class="co">##                 exp(x) + 1) * exp(x - exp(x)))</span></span>
<span><span class="co">##     }</span></span>
<span><span class="co">##     res</span></span>
<span><span class="co">## }</span></span>
<span><span class="co">## &lt;bytecode: 0x55f812f82f50&gt;</span></span>
<span><span class="co">## &lt;environment: namespace:singleRcapture&gt;</span></span></code></pre>
<p>One could, of course, include the code for computing them
manually.</p>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-baffour2013modern" class="csl-entry">
Baffour, Bernard, Thomas King, and Paolo Valente. 2013. <span>“The
Modern Census: Evolution, Examples and Evaluation.”</span>
<em>International Statistical Review</em> 81 (3): 407–25. <a href="https://doi.org/10.1111/insr.12036" class="external-link">https://doi.org/10.1111/insr.12036</a>.
</div>
<div id="ref-baillargeon2007rcapture" class="csl-entry">
Baillargeon, Sophie, and Louis-Paul Rivest. 2007. <span>“Rcapture:
Loglinear Models for Capture-Recapture in r.”</span> <em>Journal of
Statistical Software</em> 19 (5): 1–31. <a href="https://doi.org/10.18637/jss.v019.i05" class="external-link">https://doi.org/10.18637/jss.v019.i05</a>.
</div>
<div id="ref-Distributionsjl" class="csl-entry">
Besançon, Mathieu, Theodore Papamarkou, David Anthoff, Alex Arslan,
Simon Byrne, Dahua Lin, and John Pearson. 2021. <span>“Distributions.jl:
Definition and Modeling of Probability Distributions in the JuliaStats
Ecosystem.”</span> <em>Journal of Statistical Software</em> 98 (16):
1–30. <a href="https://doi.org/10.18637/jss.v098.i16" class="external-link">https://doi.org/10.18637/jss.v098.i16</a>.
</div>
<div id="ref-bohning2023equivalence" class="csl-entry">
Böhning, Dankmar. 2023. <span>“On the Equivalence of One-Inflated
Zero-Truncated and Zero-Truncated One-Inflated Count Data
Likelihoods.”</span> <em>Biometrical Journal</em> 65 (2): 2100343. <a href="https://doi.org/10.1002/bimj.202100343" class="external-link">https://doi.org/10.1002/bimj.202100343</a>.
</div>
<div id="ref-bohning2018capture" class="csl-entry">
Böhning, Dankmar, John Bunge, and Peter GM Heijden. 2018.
<em>Capture-Recapture Methods for the Social and Medical Sciences</em>.
CRC Press Boca Raton.
</div>
<div id="ref-BoehningFriedl2021" class="csl-entry">
Böhning, Dankmar, and Herwig Friedl. 2021. <span>“Population Size
Estimation Based Upon Zero-Truncated, One-Inflated and Sparse Count
Data: Estimating the Number of Dice Snakes in Graz and Flare Stars in
the Pleiades.”</span> <em>Statistical Methods &amp; Applications</em>,
January. <a href="https://doi.org/10.1007/s10260-021-00556-8" class="external-link">https://doi.org/10.1007/s10260-021-00556-8</a>.
</div>
<div id="ref-bohning2024one" class="csl-entry">
———. 2024. <span>“One-Inflation and Zero-Truncation Count Data Modelling
Revisited with a View on Horvitz–Thompson Estimation of Population
Size.”</span> <em>International Statistical Review</em> 92 (1): 148–65.
<a href="https://doi.org/10.1111/insr.12557" class="external-link">https://doi.org/10.1111/insr.12557</a>.
</div>
<div id="ref-zelterman" class="csl-entry">
Böhning, Dankmar, and Peter G. M. van der Heijden. 2009. <span>“A
Covariate Adjustment for Zero-Truncated Approaches to Estimating the
Size of Hidden and Elusive Populations.”</span> <em>The Annals of
Applied Statistics</em> 3 (2): 595–610. <a href="https://doi.org/10.1214/08-AOAS214" class="external-link">https://doi.org/10.1214/08-AOAS214</a>.
</div>
<div id="ref-zotmodels" class="csl-entry">
———. 2019. <span>“The Identity of the Zero-Truncated, One-Inflated
Likelihood and the Zero-One-Truncated Likelihood for General Count
Densities with an Application to Drink-Driving in Britain.”</span>
<em>The Annals of Applied Statistics</em> 13 (2): 1198–1211. <a href="https://doi.org/10.1214/18-AOAS1232" class="external-link">https://doi.org/10.1214/18-AOAS1232</a>.
</div>
<div id="ref-chao-generalization" class="csl-entry">
Böhning, Dankmar, Alberto Vidal-Diez, Rattana Lerdsuwansri, Chukiat
Viwatwongkasem, and Mark Arnold. 2013. <span>“A Generalization of Chao’s
Estimator for Covariate Information.”</span> <em>Biometrics</em> 69 (4):
1033–42. <a href="https://doi.org/10.1111/biom.12062" class="external-link">https://doi.org/10.1111/biom.12062</a>.
</div>
<div id="ref-brms" class="csl-entry">
Bürkner, Paul-Christian. 2017. <span>“<span class="nocase">brms</span>:
An <span>R</span> Package for <span>Bayesian</span> Multilevel Models
Using <span>Stan</span>.”</span> <em>Journal of Statistical
Software</em> 80 (1): 1–28. <a href="https://doi.org/10.18637/jss.v080.i01" class="external-link">https://doi.org/10.18637/jss.v080.i01</a>.
</div>
<div id="ref-carpenter2017stan" class="csl-entry">
Carpenter, Bob, Andrew Gelman, Matthew D Hoffman, Daniel Lee, Ben
Goodrich, Michael Betancourt, Marcus Brubaker, Jiqiang Guo, Peter Li,
and Allen Riddell. 2017. <span>“Stan: A Probabilistic Programming
Language.”</span> <em>Journal of Statistical Software</em> 76 (1): 1–32.
<a href="https://doi.org/10.18637/jss.v076.i01" class="external-link">https://doi.org/10.18637/jss.v076.i01</a>.
</div>
<div id="ref-chao1987estimating" class="csl-entry">
Chao, Anne. 1987. <span>“Estimating the Population Size for
Capture-Recapture Data with Unequal Catchability.”</span>
<em>Biometrics</em> 43 (4): 783–91. <a href="https://doi.org/10.2307/2531532" class="external-link">https://doi.org/10.2307/2531532</a>.
</div>
<div id="ref-ztnegbin" class="csl-entry">
Cruyff, Maarten J. L. F., and Peter G. M. van der Heijden. 2008.
<span>“Point and Interval Estimation of the Population Size Using a
Zero-Truncated Negative Binomial Regression Model.”</span>
<em>Biometrical Journal</em> 50 (6): 1035–50. <a href="https://doi.org/10.1002/bimj.200810455" class="external-link">https://doi.org/10.1002/bimj.200810455</a>.
</div>
<div id="ref-dunne2024system" class="csl-entry">
Dunne, John, and Li-Chun Zhang. 2024. <span>“A System of Population
Estimates Compiled from Administrative Data Only.”</span> <em>Journal of
the Royal Statistical Society Series A: Statistics in Society</em> 187
(1): 3–21. <a href="https://doi.org/10.1093/jrsssa/qnad067" class="external-link">https://doi.org/10.1093/jrsssa/qnad067</a>.
</div>
<div id="ref-ztoi-oizt-poisson" class="csl-entry">
Godwin, Ryan T., and Dankmar Böhning. 2017a. <span>“Estimation of the
Population Size by Using the One-Inflated Positive Poisson
Model.”</span> <em>Journal of the Royal Statistical Society Series C:
Applied Statistics</em> 66 (2): 425–48. <a href="https://doi.org/10.1111/rssc.12192" class="external-link">https://doi.org/10.1111/rssc.12192</a>.
</div>
<div id="ref-godwin2017estimation" class="csl-entry">
Godwin, Ryan T, and Dankmar Böhning. 2017b. <span>“Estimation of the
Population Size by Using the One-Inflated Positive Poisson
Model.”</span> <em>Journal of the Royal Statistical Society Series C:
Applied Statistics</em> 66 (2): 425–48. <a href="https://doi.org/10.1111/rssc.12192" class="external-link">https://doi.org/10.1111/rssc.12192</a>.
</div>
<div id="ref-distributions3" class="csl-entry">
Hayes, Alex, Ralph Moller-Trane, Daniel Jordan, Paul Northrop, Moritz N.
Lang, and Achim Zeileis. 2024. <em>Distributions3: Probability
Distributions as S3 Objects</em>. <a href="https://CRAN.R-project.org/package=distributions3" class="external-link">https://CRAN.R-project.org/package=distributions3</a>.
</div>
<div id="ref-ztpoisson" class="csl-entry">
Heijden, Peter GM van der, Rami Bustami, Maarten JLF Cruyff, Godfried
Engbersen, and Hans C van Houwelingen. 2003. <span>“Point and Interval
Estimation of the Population Size Using the Truncated Poisson Regression
Model.”</span> <em>Statistical Modelling</em> 3 (4): 305–22. <a href="https://doi.org/10.1191/1471082X03st057oa" class="external-link">https://doi.org/10.1191/1471082X03st057oa</a>.
</div>
<div id="ref-rootogram" class="csl-entry">
Kleiber, Christian, and Achim Zeileis. 2016. <span>“Visualizing Count
Data Regressions Using Rootograms.”</span> <em>The American
Statistician</em> 70 (3): 296–303. <a href="https://doi.org/10.1080/00031305.2016.1173590" class="external-link">https://doi.org/10.1080/00031305.2016.1173590</a>.
</div>
<div id="ref-laake2013marked" class="csl-entry">
Laake, Jeff L, Devin S Johnson, Paul B Conn, and Nick Isaac. 2013.
<span>“Marked: An r Package for Maximum Likelihood and Markov Chain
Monte Carlo Analysis of Capture-Recapture Data.”</span> <em>Methods in
Ecology &amp; Evolution</em> 4 (9): 885–90. <a href="https://doi.org/10.1111/2041-210X.12065" class="external-link">https://doi.org/10.1111/2041-210X.12065</a>.
</div>
<div id="ref-doParallel" class="csl-entry">
Microsoft, and Steve Weston. 2022a. <em>doParallel: Foreach Parallel
Adaptor for the ’Parallel’ Package</em>. <a href="https://CRAN.R-project.org/package=doParallel" class="external-link">https://CRAN.R-project.org/package=doParallel</a>.
</div>
<div id="ref-foreach" class="csl-entry">
———. 2022b. <em>Foreach: Provides Foreach Looping Construct</em>. <a href="https://CRAN.R-project.org/package=foreach" class="external-link">https://CRAN.R-project.org/package=foreach</a>.
</div>
<div id="ref-norrpoll" class="csl-entry">
Norris, James L, and Kenneth H Pollock. 1996. <span>“Including Model
Uncertainty in Estimating Variances in Multiple Capture Studies.”</span>
<em>Environmental and Ecological Statistics</em> 3 (3): 235–44. <a href="https://doi.org/10.1007/BF00569242" class="external-link">https://doi.org/10.1007/BF00569242</a>.
</div>
<div id="ref-parallel" class="csl-entry">
R Core Team. 2023. <em>R: A Language and Environment for Statistical
Computing</em>. Vienna, Austria: R Foundation for Statistical Computing.
<a href="https://www.R-project.org/" class="external-link">https://www.R-project.org/</a>.
</div>
<div id="ref-seabold2010statsmodels" class="csl-entry">
Seabold, Skipper, and Josef Perktold. 2010. <span>“Statsmodels:
Econometric and Statistical Modeling with Python.”</span> In <em>9th
Python in Science Conference</em>.
</div>
<div id="ref-tuoto2022bayesian" class="csl-entry">
Tuoto, Tiziana, Davide Di Cecco, and Andrea Tancredi. 2022.
<span>“Bayesian Analysis of One-Inflated Models for Elusive Population
Size Estimation.”</span> <em>Biometrical Journal</em> 64 (5): 912–33. <a href="https://doi.org/10.1002/bimj.202100048" class="external-link">https://doi.org/10.1002/bimj.202100048</a>.
</div>
<div id="ref-vincent2022estimating" class="csl-entry">
Vincent, Kyle, and Steve Thompson. 2022. <span>“Estimating the Size and
Distribution of Networked Populations with Snowball Sampling.”</span>
<em>Journal of Survey Statistics and Methodology</em> 10 (2): 397–418.
<a href="https://doi.org/10.1093/jssam/smaa037" class="external-link">https://doi.org/10.1093/jssam/smaa037</a>.
</div>
<div id="ref-wolter1986some" class="csl-entry">
Wolter, Kirk M. 1986. <span>“Some Coverage Error Models for Census
Data.”</span> <em>Journal of the American Statistical Association</em>
81 (394): 337–46. <a href="https://doi.org/10.1080/01621459.1986.10478277" class="external-link">https://doi.org/10.1080/01621459.1986.10478277</a>.
</div>
<div id="ref-yang2006care4" class="csl-entry">
Yang, Hsing-Chen, and Anne Chao. 2006. <span>“Program
<span>CARE</span>-4 (for <span>Capture-Recapture</span> Part.
4).”</span> <a href="http://chao.stat.nthu.edu.tw" class="external-link">http://chao.stat.nthu.edu.tw</a>.
</div>
<div id="ref-VGAM-main" class="csl-entry">
Yee, Thomas. 2015. <em>Vector Generalized Linear and Additive Models:
With an Implementation in r</em>. 1st ed. Springer Publishing Company,
Incorporated.
</div>
<div id="ref-gaitdcount" class="csl-entry">
Yee, Thomas W., and Chenchen Ma. 2024. <span>“Generally Altered,
Inflated, Truncated and Deflated Regression.”</span> <em>Statistical
Science</em> 39 (4): 568–88. <a href="https://doi.org/10.1214/24-STS925" class="external-link">https://doi.org/10.1214/24-STS925</a>.
</div>
<div id="ref-yee2015vgam" class="csl-entry">
Yee, Thomas W, Jakub Stoklosa, and Richard M Huggins. 2015. <span>“The
VGAM Package for Capture-Recapture Data Using the Conditional
Likelihood.”</span> <em>Journal of Statistical Software</em> 65 (1):
1–33. <a href="https://doi.org/10.18637/jss.v065.i05" class="external-link">https://doi.org/10.18637/jss.v065.i05</a>.
</div>
<div id="ref-lmtest" class="csl-entry">
Zeileis, Achim, and Torsten Hothorn. 2002. <span>“Diagnostic Checking in
Regression Relationships.”</span> <em>R News</em> 2 (3): 7–10. <a href="https://CRAN.R-project.org/doc/Rnews/" class="external-link">https://CRAN.R-project.org/doc/Rnews/</a>.
</div>
<div id="ref-countreg" class="csl-entry">
Zeileis, Achim, Christian Kleiber, and Simon Jackman. 2008.
<span>“Regression Models for Count Data in <span>R</span>.”</span>
<em>Journal of Statistical Software</em> 27 (8): 1–25. <a href="https://doi.org/10.18637/jss.v027.i08" class="external-link">https://doi.org/10.18637/jss.v027.i08</a>.
</div>
<div id="ref-sandwich" class="csl-entry">
Zeileis, Achim, Susanne Köll, and Nathaniel Graham. 2020. <span>“Various
Versatile Variances: An Object-Oriented Implementation of Clustered
Covariances in <span>R</span>.”</span> <em>Journal of Statistical
Software</em> 95 (1): 1–36. <a href="https://doi.org/10.18637/jss.v095.i01" class="external-link">https://doi.org/10.18637/jss.v095.i01</a>.
</div>
<div id="ref-zelterman1988robust" class="csl-entry">
Zelterman, Daniel. 1988. <span>“Robust Estimation in Truncated Discrete
Distributions with Application to Capture-Recapture Experiments.”</span>
<em>Journal of Statistical Planning and Inference</em> 18 (2): 225–37.
<a href="https://doi.org/10.1016/0378-3758(88)90007-9" class="external-link">https://doi.org/10.1016/0378-3758(88)90007-9</a>.
</div>
<div id="ref-zhang2019note" class="csl-entry">
Zhang, Li-Chun. 2019. <span>“A Note on Dual System Population Size
Estimator.”</span> <em>Journal of Official Statistics</em> 35 (1):
279–83. <a href="https://doi.org/10.2478/jos-2019-0013" class="external-link">https://doi.org/10.2478/jos-2019-0013</a>.
</div>
<div id="ref-zwane" class="csl-entry">
Zwane, EN, and PGM Van der Heijden. 2003. <span>“Implementing the
Parametric Bootstrap in Capture–Recapture Models with Continuous
Covariates.”</span> <em>Statistics &amp; Probability Letters</em> 65
(2): 121–25. <a href="https://doi.org/10.1016/j.spl.2003.07.003" class="external-link">https://doi.org/10.1016/j.spl.2003.07.003</a>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Piotr Chlebicki, Maciej Beręsewicz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
