<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Single-Source Capture-Recapture Models • singleRcapture</title>
<script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><script src="deps/MathJax-3.2.2/tex-chtml.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><meta property="og:title" content="Single-Source Capture-Recapture Models">
<meta name="description" content="Implementation of single-source capture-recapture methods for population size estimation using zero-truncated, zero-one truncated and zero-truncated one-inflated Poisson, Geometric and Negative Binomial regression as well as Zeltermans and Chaos regression. Package includes point and interval estimators for the population size with variances estimated using analytical or bootstrap method. Details can be found in: van der Heijden et all. (2003) &lt;doi:10.1191/1471082X03st057oa&gt;, Böhning and van der Heijden (2019) &lt;doi:10.1214/18-AOAS1232&gt;, Böhning et al. (2020) Capture-Recapture Methods for the Social and Medical Sciences or Böhning and Friedl (2021) &lt;doi:10.1007/s10260-021-00556-8&gt;.">
<meta property="og:description" content="Implementation of single-source capture-recapture methods for population size estimation using zero-truncated, zero-one truncated and zero-truncated one-inflated Poisson, Geometric and Negative Binomial regression as well as Zeltermans and Chaos regression. Package includes point and interval estimators for the population size with variances estimated using analytical or bootstrap method. Details can be found in: van der Heijden et all. (2003) &lt;doi:10.1191/1471082X03st057oa&gt;, Böhning and van der Heijden (2019) &lt;doi:10.1214/18-AOAS1232&gt;, Böhning et al. (2020) Capture-Recapture Methods for the Social and Medical Sciences or Böhning and Friedl (2021) &lt;doi:10.1007/s10260-021-00556-8&gt;.">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">singleRcapture</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.1.2</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ncn-foreigners/singleRcapture/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-home">
<div class="row">
  <main id="main" class="col-md-9"><div class="section level1">
<div class="page-header"><h1 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h1></div>
<!-- badges: start -->

<p>Capture-recapture type experiments are used to estimate the total population size in situations when observing only a part of such population is feasible. In recent years these types of experiments have seen more interest.</p>
<p>Single source models are distinct from other capture-recapture models because we cannot estimate the population size based on how many units were observed in two or three sources which is the standard approach.</p>
<p>Instead in single source models we utilize count data regression models on positive distributions (i.e. on counts greater than 0) where the dependent variable is the number of times a particular unit was observed in source data.</p>
<p>This package aims to implement already existing and introduce new methods of estimating population size from single source to simplify the research process.</p>
<p>Currently we’ve implemented most of the frequentist approaches used in literature such as:</p>
<ul>
<li>Zero truncated Poisson, geometric and negative binomial regression.</li>
<li>Zero truncated one inflated and one inflated zero truncated Poisson and geometric models. (Negative binomial is currently in development.)</li>
<li>Zero one truncated Poisson geometric and negative binomial models.</li>
<li>Generalized Chao and Zelterman’s models based on logistic regression.</li>
<li>Three types of bootstrap parametric, semi-parametric and non parametric.</li>
<li>And a wide range of additional functionalities associated with (vector) generalized linear models relevant to the topic.</li>
</ul>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>You can install the current version of singleRcapture from main branch <a href="https://github.com/ncn-foreigners/singleRcapture" class="external-link">GitHub</a> with:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"ncn-foreigners/singleRcapture"</span><span class="op">)</span></span></code></pre></div>
<p>or install the stable version from <a href="https://cran.r-project.org/package=singleRcapture" class="external-link">CRAN</a> with:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="va">singleRcapture</span><span class="op">)</span></span></code></pre></div>
<p>or development version from <a href="https://github.com/ncn-foreigners/singleRcapture/tree/development" class="external-link">development branch on GitHub</a> with:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># install.packages("devtools")</span></span>
<span><span class="fu">remotes</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"github.com/ncn-foreigners/singleRcapture/tree/development"</span><span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h3>
<p>The main function of this package is <code>estimatePopsize</code> which fitts regression on specified distribution and then uses fitted regression to estimate the population size.</p>
<p>Lets look at a model from 2003 publication : Point and interval estimation of the population size using the truncated Poisson regression model Heijden, Peter GM van der et al. The call to <code>estimatePopsize</code> will look very similar to anyone who used the <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">stats::glm</a></code> function:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ncn-foreigners/singleRcapture" class="external-link">singleRcapture</a></span><span class="op">)</span></span>
<span><span class="va">model</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/estimatePopsize.html">estimatePopsize</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">capture</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">nation</span>, <span class="co"># specify formula</span></span>
<span>  data <span class="op">=</span> <span class="va">netherlandsimmigrant</span>,</span>
<span>  popVar <span class="op">=</span> <span class="st">"analytic"</span>, <span class="co"># specify </span></span>
<span>  model <span class="op">=</span> <span class="st">"ztpoisson"</span>, <span class="co"># distribution used</span></span>
<span>  method <span class="op">=</span> <span class="st">"IRLS"</span>, <span class="co"># fitting method one of three currently supported</span></span>
<span>  controlMethod <span class="op">=</span> <span class="fu"><a href="reference/controlMethod.html">controlMethod</a></span><span class="op">(</span>silent <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="co"># ignore convergence at half step warning</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span> <span class="co"># a summary method for singleR class with standard glm-like output and population size estimation resutls</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; estimatePopsize.default(formula = capture ~ gender + age + nation, </span></span>
<span><span class="co">#&gt;     data = netherlandsimmigrant, model = "ztpoisson", method = "IRLS", </span></span>
<span><span class="co">#&gt;     popVar = "analytic", controlMethod = controlMethod(silent = TRUE))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Pearson Residuals:</span></span>
<span><span class="co">#&gt;      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. </span></span>
<span><span class="co">#&gt; -0.486442 -0.486442 -0.298080  0.002093 -0.209444 13.910844 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt; -----------------------</span></span>
<span><span class="co">#&gt; For linear predictors associated with: lambda </span></span>
<span><span class="co">#&gt;                      Estimate Std. Error z value  P(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)           -1.3411     0.2149  -6.241 4.35e-10 ***</span></span>
<span><span class="co">#&gt; gendermale             0.3972     0.1630   2.436 0.014832 *  </span></span>
<span><span class="co">#&gt; age&gt;40yrs             -0.9746     0.4082  -2.387 0.016972 *  </span></span>
<span><span class="co">#&gt; nationAsia            -1.0926     0.3016  -3.622 0.000292 ***</span></span>
<span><span class="co">#&gt; nationNorth Africa     0.1900     0.1940   0.979 0.327398    </span></span>
<span><span class="co">#&gt; nationRest of Africa  -0.9106     0.3008  -3.027 0.002468 ** </span></span>
<span><span class="co">#&gt; nationSurinam         -2.3364     1.0136  -2.305 0.021159 *  </span></span>
<span><span class="co">#&gt; nationTurkey          -1.6754     0.6028  -2.779 0.005445 ** </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; AIC: 1712.901</span></span>
<span><span class="co">#&gt; BIC: 1757.213</span></span>
<span><span class="co">#&gt; Residual deviance: 1128.553</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Log-likelihood: -848.4504 on 1872 Degrees of freedom </span></span>
<span><span class="co">#&gt; Number of iterations: 8</span></span>
<span><span class="co">#&gt; -----------------------</span></span>
<span><span class="co">#&gt; Population size estimation results: </span></span>
<span><span class="co">#&gt; Point estimate 12690.35</span></span>
<span><span class="co">#&gt; Observed proportion: 14.8% (N obs = 1880)</span></span>
<span><span class="co">#&gt; Std. Error 2808.169</span></span>
<span><span class="co">#&gt; 95% CI for the population size:</span></span>
<span><span class="co">#&gt;           lowerBound upperBound</span></span>
<span><span class="co">#&gt; normal      7186.444   18194.26</span></span>
<span><span class="co">#&gt; logNormal   8431.275   19718.32</span></span>
<span><span class="co">#&gt; 95% CI for the share of observed population:</span></span>
<span><span class="co">#&gt;           lowerBound upperBound</span></span>
<span><span class="co">#&gt; normal     10.332927   26.16037</span></span>
<span><span class="co">#&gt; logNormal   9.534281   22.29793</span></span></code></pre></div>
<p>We implemented a method for <code>plot</code> function to visualise the model fit and other useful diagnostic information. One of which is <code>rootogram</code>, a type of plot that compares fitted and observed marginal frequencies:</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model</span>, plotType <span class="op">=</span> <span class="st">"rootogram"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-plot-1.png" width="75%"></p>
<p>The possible values for <code>plotType</code> argument are:</p>
<ul>
<li>
<code>qq</code> - the normal quantile-quantile plot for pearson residuals.</li>
<li>
<code>marginal</code> - a <code>matplot</code> comparing fitted and observed marginal frequencies.</li>
<li>
<code>fitresid</code> - plot of linear predictor values contrasted with pearson residuals.</li>
<li>
<code>bootHist</code> - histogram of bootstrap sample.</li>
<li>
<code>rootogram</code> - rootogram, example presented above.</li>
<li>
<code>dfpopContr</code> - contrasting two deletion effects to identify presence of influential observations.</li>
<li>
<code>dfpopBox</code> - boxplot of results from dfpopsize function see its documentation.</li>
<li>
<code>scaleLoc</code> - scale-location plot.</li>
<li>
<code>cooks</code> - plot of <code>cooks.values</code> for distributions for which it is defined.</li>
<li>
<code>hatplot</code> - plot of <code>hatvalues</code>.</li>
<li>
<code>strata</code> - plot of confidence intervals for selected such populations.</li>
</ul>
<p>a user can also pass arguments to specify additional information such as plot title, subtitle etc. similar to calling <code>plot</code> on some data. For more info check <code>plot.singleR</code> method documentation.</p>
<p>As we have seen there are some significant differences between fitted and observed marginal frequencies. To check our intuition let’s perform goodness of fit test between fitted and observed marginal frequencies.</p>
<p>To do it we call a <code>summary</code> function of <code>marginalFreq</code> function which computes marginal frequencies for the fitted <code>singleR</code> class object:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="reference/marginalFreq.html">marginalFreq</a></span><span class="op">(</span><span class="va">model</span><span class="op">)</span>, df <span class="op">=</span> <span class="fl">2</span>, dropl5 <span class="op">=</span> <span class="st">"group"</span><span class="op">)</span></span>
<span><span class="co">#&gt; Test for Goodness of fit of a regression model:</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;                  Test statistics df P(&gt;X^2)</span></span>
<span><span class="co">#&gt; Chi-squared test           50.06  2 1.3e-11</span></span>
<span><span class="co">#&gt; G-test                     34.31  2 3.6e-08</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; -------------------------------------------------------------- </span></span>
<span><span class="co">#&gt; Cells with fitted frequencies of &lt; 5 have been grouped </span></span>
<span><span class="co">#&gt; Names of cells used in calculating test(s) statistic: 1 2 3</span></span></code></pre></div>
<p>Finally let us check if we have any influential observations. We will do this by comparing the deletion effect of every observation on population size estimate by removing it entirely from the model (from population size estimate and regression) and by only omitting it in pop size estimation (this is what is called the contribution of an observation). If observation is not influential these two actions should have the approximately the same effect:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">model</span>, plotType <span class="op">=</span> <span class="st">"dfpopContr"</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-6-1.png" width="75%"></p>
<p>it is easy to deduce from the plot above that we have influential observations in our dataset (one in particular).</p>
<p>Lastly <code>singleRcapture</code> offers some posthoc procedures for example a function <code>stratifyPopsize</code> that estimates sizes of user specified sub populations and returns them in a <code>data.frame</code>:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/stratifyPopsize.html">stratifyPopsize</a></span><span class="op">(</span><span class="va">model</span>, alpha <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.01</span>, <span class="fl">.02</span>, <span class="fl">.03</span>, <span class="fl">.05</span><span class="op">)</span>, <span class="co"># different significance level for each sub population</span></span>
<span>    stratas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>    <span class="st">"Females from Surinam"</span> <span class="op">=</span> <span class="va">netherlandsimmigrant</span><span class="op">$</span><span class="va">gender</span> <span class="op">==</span> <span class="st">"female"</span> <span class="op">&amp;</span> <span class="va">netherlandsimmigrant</span><span class="op">$</span><span class="va">nation</span> <span class="op">==</span> <span class="st">"Surinam"</span>,</span>
<span>    <span class="st">"Males from Turkey"</span> <span class="op">=</span> <span class="va">netherlandsimmigrant</span><span class="op">$</span><span class="va">gender</span> <span class="op">==</span> <span class="st">"male"</span> <span class="op">&amp;</span> <span class="va">netherlandsimmigrant</span><span class="op">$</span><span class="va">nation</span> <span class="op">==</span> <span class="st">"Turkey"</span>,</span>
<span>    <span class="st">"Younger males"</span> <span class="op">=</span> <span class="va">netherlandsimmigrant</span><span class="op">$</span><span class="va">gender</span> <span class="op">==</span> <span class="st">"male"</span> <span class="op">&amp;</span> <span class="va">netherlandsimmigrant</span><span class="op">$</span><span class="va">age</span> <span class="op">==</span> <span class="st">"&lt;40yrs"</span>,</span>
<span>    <span class="st">"Older males"</span> <span class="op">=</span> <span class="va">netherlandsimmigrant</span><span class="op">$</span><span class="va">gender</span> <span class="op">==</span> <span class="st">"male"</span> <span class="op">&amp;</span> <span class="va">netherlandsimmigrant</span><span class="op">$</span><span class="va">age</span> <span class="op">==</span> <span class="st">"&gt;40yrs"</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Observed Estimated ObservedPercentage  StdError normalLowerBound</span></span>
<span><span class="co">#&gt; 1       20   931.469           2.147146  955.0676      -1528.62209</span></span>
<span><span class="co">#&gt; 2       78  1291.251           6.040652  741.0066       -432.58790</span></span>
<span><span class="co">#&gt; 3     1391  7337.072          18.958516 1282.1419       4554.70841</span></span>
<span><span class="co">#&gt; 4       91  1542.189           5.900703  781.4754         10.52561</span></span>
<span><span class="co">#&gt;   normalUpperBound logNormalLowerBound logNormalUpperBound                 name</span></span>
<span><span class="co">#&gt; 1         3391.560            119.2661            8389.178 Females from Surinam</span></span>
<span><span class="co">#&gt; 2         3015.090            405.4127            4573.791    Males from Turkey</span></span>
<span><span class="co">#&gt; 3        10119.436           5134.8113           10834.792        Younger males</span></span>
<span><span class="co">#&gt; 4         3073.853            630.7551            3992.677          Older males</span></span>
<span><span class="co">#&gt;   confLevel</span></span>
<span><span class="co">#&gt; 1      0.01</span></span>
<span><span class="co">#&gt; 2      0.02</span></span>
<span><span class="co">#&gt; 3      0.03</span></span>
<span><span class="co">#&gt; 4      0.05</span></span></code></pre></div>
<p><code>stratas</code> argument may be specified in various ways for example:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/stratifyPopsize.html">stratifyPopsize</a></span><span class="op">(</span><span class="va">model</span>, stratas <span class="op">=</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">/</span> <span class="va">age</span><span class="op">)</span></span>
<span><span class="co">#&gt;   Observed Estimated ObservedPercentage  StdError normalLowerBound</span></span>
<span><span class="co">#&gt; 1      398 3811.0924          10.443200 1153.9749       1549.34322</span></span>
<span><span class="co">#&gt; 2     1482 8879.2613          16.690578 1812.0813       5327.64720</span></span>
<span><span class="co">#&gt; 3      378 3169.8272          11.924940  880.9491       1443.19883</span></span>
<span><span class="co">#&gt; 4     1391 7337.0721          18.958516 1282.1419       4824.12025</span></span>
<span><span class="co">#&gt; 5       20  641.2651           3.118835  407.5268       -157.47265</span></span>
<span><span class="co">#&gt; 6       91 1542.1892           5.900703  781.4754         10.52561</span></span>
<span><span class="co">#&gt;   normalUpperBound logNormalLowerBound logNormalUpperBound</span></span>
<span><span class="co">#&gt; 1         6072.842           2189.0439            6902.140</span></span>
<span><span class="co">#&gt; 2        12430.875           6090.7752           13354.889</span></span>
<span><span class="co">#&gt; 3         4896.456           1904.3121            5484.622</span></span>
<span><span class="co">#&gt; 4         9850.024           5306.3298           10421.088</span></span>
<span><span class="co">#&gt; 5         1440.003            212.3382            2026.728</span></span>
<span><span class="co">#&gt; 6         3073.853            630.7551            3992.677</span></span>
<span><span class="co">#&gt;                     name confLevel</span></span>
<span><span class="co">#&gt; 1         gender==female      0.05</span></span>
<span><span class="co">#&gt; 2           gender==male      0.05</span></span>
<span><span class="co">#&gt; 3 genderfemale:age&lt;40yrs      0.05</span></span>
<span><span class="co">#&gt; 4   gendermale:age&lt;40yrs      0.05</span></span>
<span><span class="co">#&gt; 5 genderfemale:age&gt;40yrs      0.05</span></span>
<span><span class="co">#&gt; 6   gendermale:age&gt;40yrs      0.05</span></span></code></pre></div>
<p>The package was designed with convenience in mind, for example it is possible to specify that weights provided on call are to be interpreted as number of occurrences of units in each row:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">netherlandsimmigrant</span><span class="op">[</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="fl">5</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">df</span><span class="op">$</span><span class="va">ww</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span><span class="co">### this is dplyr::count without dependencies</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/aggregate.html" class="external-link">aggregate</a></span><span class="op">(</span><span class="va">ww</span> <span class="op">~</span> <span class="va">.</span>, <span class="va">df</span>, FUN <span class="op">=</span> <span class="va">length</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="fu"><a href="reference/estimatePopsize.html">estimatePopsize</a></span><span class="op">(</span></span>
<span>  formula <span class="op">=</span> <span class="va">capture</span> <span class="op">~</span> <span class="va">nation</span> <span class="op">+</span> <span class="va">age</span> <span class="op">+</span> <span class="va">gender</span>, </span>
<span>  data <span class="op">=</span> <span class="va">df</span>, </span>
<span>  model <span class="op">=</span> <span class="va">ztpoisson</span>, </span>
<span>  weights <span class="op">=</span> <span class="va">df</span><span class="op">$</span><span class="va">ww</span>,</span>
<span>  controlModel <span class="op">=</span> <span class="fu"><a href="reference/controlModel.html">controlModel</a></span><span class="op">(</span>weightsAsCounts <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; estimatePopsize.default(formula = capture ~ nation + age + gender, </span></span>
<span><span class="co">#&gt;     data = df, model = ztpoisson, weights = df$ww, controlModel = controlModel(weightsAsCounts = TRUE))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Pearson Residuals:</span></span>
<span><span class="co">#&gt;      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. </span></span>
<span><span class="co">#&gt; -317.6467   -2.4060    3.7702    0.0803   13.4920  183.2108 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt; -----------------------</span></span>
<span><span class="co">#&gt; For linear predictors associated with: lambda </span></span>
<span><span class="co">#&gt;                      Estimate Std. Error z value  P(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)           -1.3411     0.2149  -6.241 4.35e-10 ***</span></span>
<span><span class="co">#&gt; nationAsia            -1.0926     0.3016  -3.622 0.000292 ***</span></span>
<span><span class="co">#&gt; nationNorth Africa     0.1900     0.1940   0.979 0.327398    </span></span>
<span><span class="co">#&gt; nationRest of Africa  -0.9106     0.3008  -3.027 0.002468 ** </span></span>
<span><span class="co">#&gt; nationSurinam         -2.3364     1.0136  -2.305 0.021159 *  </span></span>
<span><span class="co">#&gt; nationTurkey          -1.6754     0.6028  -2.779 0.005445 ** </span></span>
<span><span class="co">#&gt; age&gt;40yrs             -0.9746     0.4082  -2.387 0.016972 *  </span></span>
<span><span class="co">#&gt; gendermale             0.3972     0.1630   2.436 0.014832 *  </span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; AIC: 1712.901</span></span>
<span><span class="co">#&gt; BIC: 1757.213</span></span>
<span><span class="co">#&gt; Residual deviance: 1128.553</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Log-likelihood: -848.4504 on 1872 Degrees of freedom </span></span>
<span><span class="co">#&gt; Number of iterations: 8</span></span>
<span><span class="co">#&gt; -----------------------</span></span>
<span><span class="co">#&gt; Population size estimation results: </span></span>
<span><span class="co">#&gt; Point estimate 12690.35</span></span>
<span><span class="co">#&gt; Observed proportion: 14.8% (N obs = 1880)</span></span>
<span><span class="co">#&gt; Std. Error 2808.169</span></span>
<span><span class="co">#&gt; 95% CI for the population size:</span></span>
<span><span class="co">#&gt;           lowerBound upperBound</span></span>
<span><span class="co">#&gt; normal      7186.444   18194.26</span></span>
<span><span class="co">#&gt; logNormal   8431.275   19718.32</span></span>
<span><span class="co">#&gt; 95% CI for the share of observed population:</span></span>
<span><span class="co">#&gt;           lowerBound upperBound</span></span>
<span><span class="co">#&gt; normal     10.332927   26.16037</span></span>
<span><span class="co">#&gt; logNormal   9.534281   22.29793</span></span></code></pre></div>
<p>Methods such as regression diagnostics will be adjusted (values of weights will be reduced instead of rows being removed etc.)</p>
<p>We also included option to use common non standardargument such as significance levels different from usual 5%:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span><span class="va">modelInflated</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/estimatePopsize.html">estimatePopsize</a></span><span class="op">(</span></span>
<span>    formula <span class="op">=</span> <span class="va">capture</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">+</span> <span class="va">age</span>,</span>
<span>    data <span class="op">=</span> <span class="va">netherlandsimmigrant</span>,</span>
<span>    model <span class="op">=</span> <span class="st">"oiztgeom"</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"IRLS"</span>,</span>
<span>    <span class="co"># control parameters for population size estimation check documentation of controlPopVar</span></span>
<span>    controlPopVar <span class="op">=</span> <span class="fu"><a href="reference/controlPopVar.html">controlPopVar</a></span><span class="op">(</span></span>
<span>        alpha <span class="op">=</span> <span class="fl">.01</span>, <span class="co"># significance level </span></span>
<span>    <span class="op">)</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">modelInflated</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; estimatePopsize.default(formula = capture ~ gender + age, data = netherlandsimmigrant, </span></span>
<span><span class="co">#&gt;     model = "oiztgeom", method = "IRLS", controlPopVar = controlPopVar(alpha = 0.01, </span></span>
<span><span class="co">#&gt;         ))</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Pearson Residuals:</span></span>
<span><span class="co">#&gt;      Min.   1st Qu.    Median      Mean   3rd Qu.      Max. </span></span>
<span><span class="co">#&gt; -0.357193 -0.357193 -0.357193  0.000343 -0.287637 10.233608 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Coefficients:</span></span>
<span><span class="co">#&gt; -----------------------</span></span>
<span><span class="co">#&gt; For linear predictors associated with: lambda </span></span>
<span><span class="co">#&gt;             Estimate Std. Error z value P(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)  -1.5346     0.1846  -8.312 &lt; 2e-16 ***</span></span>
<span><span class="co">#&gt; gendermale    0.3863     0.1380   2.800 0.00512 ** </span></span>
<span><span class="co">#&gt; age&gt;40yrs    -0.7788     0.2942  -2.648 0.00810 ** </span></span>
<span><span class="co">#&gt; -----------------------</span></span>
<span><span class="co">#&gt; For linear predictors associated with: omega </span></span>
<span><span class="co">#&gt;             Estimate Std. Error z value  P(&gt;|z|)    </span></span>
<span><span class="co">#&gt; (Intercept)  -1.7591     0.3765  -4.673 2.97e-06 ***</span></span>
<span><span class="co">#&gt; ---</span></span>
<span><span class="co">#&gt; Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; AIC: 1736.854</span></span>
<span><span class="co">#&gt; BIC: 1759.01</span></span>
<span><span class="co">#&gt; Residual deviance: 1011.271</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Log-likelihood: -864.4272 on 3756 Degrees of freedom </span></span>
<span><span class="co">#&gt; Number of iterations: 6</span></span>
<span><span class="co">#&gt; -----------------------</span></span>
<span><span class="co">#&gt; Population size estimation results: </span></span>
<span><span class="co">#&gt; Point estimate 5661.522</span></span>
<span><span class="co">#&gt; Observed proportion: 33.2% (N obs = 1880)</span></span>
<span><span class="co">#&gt; Std. Error 963.9024</span></span>
<span><span class="co">#&gt; 99% CI for the population size:</span></span>
<span><span class="co">#&gt;           lowerBound upperBound</span></span>
<span><span class="co">#&gt; normal      3178.674   8144.370</span></span>
<span><span class="co">#&gt; logNormal   3861.508   9096.681</span></span>
<span><span class="co">#&gt; 99% CI for the share of observed population:</span></span>
<span><span class="co">#&gt;           lowerBound upperBound</span></span>
<span><span class="co">#&gt; normal      23.08343   59.14416</span></span>
<span><span class="co">#&gt; logNormal   20.66688   48.68564</span></span></code></pre></div>
<p>and the option to estimate standard error of population size estimate by bootstrap, models with more than one distribution parameter being dependent on covariates and some non standard link functions for example:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">modelInflated2</span> <span class="op">&lt;-</span> <span class="fu"><a href="reference/estimatePopsize.html">estimatePopsize</a></span><span class="op">(</span></span>
<span>    formula <span class="op">=</span> <span class="va">capture</span> <span class="op">~</span> <span class="va">age</span>,</span>
<span>    data <span class="op">=</span> <span class="va">netherlandsimmigrant</span>,</span>
<span>    popVar <span class="op">=</span> <span class="st">"bootstrap"</span>,</span>
<span>    model <span class="op">=</span> <span class="fu"><a href="reference/singleRmodels.html">oiztgeom</a></span><span class="op">(</span>omegaLink <span class="op">=</span> <span class="st">"cloglog"</span><span class="op">)</span>,</span>
<span>    method <span class="op">=</span> <span class="st">"IRLS"</span>,</span>
<span>    controlPopVar <span class="op">=</span> <span class="fu"><a href="reference/controlPopVar.html">controlPopVar</a></span><span class="op">(</span></span>
<span>        B <span class="op">=</span> <span class="fl">500</span>,<span class="co"># number of boostrap samples</span></span>
<span>        alpha <span class="op">=</span> <span class="fl">.01</span>, <span class="co"># significance level </span></span>
<span>        <span class="co"># type of bootstrap see documentation for estimatePopsize</span></span>
<span>        bootType <span class="op">=</span> <span class="st">"semiparametric"</span>,</span>
<span>        <span class="co"># control regression fitting on bootstrap samples</span></span>
<span>        bootstrapFitcontrol <span class="op">=</span> <span class="fu"><a href="reference/controlMethod.html">controlMethod</a></span><span class="op">(</span></span>
<span>          epsilon <span class="op">=</span> <span class="va">.Machine</span><span class="op">$</span><span class="va">double.eps</span>, </span>
<span>          silent <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>          stepsize <span class="op">=</span> <span class="fl">2</span></span>
<span>        <span class="op">)</span></span>
<span>    <span class="op">)</span>,</span>
<span>    controlModel <span class="op">=</span> <span class="fu"><a href="reference/controlModel.html">controlModel</a></span><span class="op">(</span>omegaFormula <span class="op">=</span> <span class="op">~</span> <span class="va">gender</span><span class="op">)</span> <span class="co"># put covariates on omega i.e. the inflation parameter</span></span>
<span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning in singleRcaptureinternalIRLSmultipar(dependent = y, covariates = X, :</span></span>
<span><span class="co">#&gt; Convergence at halfstepsize</span></span>
<span><span class="co">#&gt; Warning in estimatePopsize.default(formula = capture ~ age, data = netherlandsimmigrant, : The (analytically computed) hessian of the score function is not negative define.</span></span>
<span><span class="co">#&gt; NOTE: Second derivative test failing does not </span></span>
<span><span class="co">#&gt;         necessarily mean that the maximum of score function that was found </span></span>
<span><span class="co">#&gt;         numericaly is invalid since R^k is not a bounded space.</span></span>
<span><span class="co">#&gt; Additionally in one inflated and hurdle models second derivative test often fails even on valid arguments.</span></span>
<span><span class="co">#&gt; Warning in estimatePopsize.default(formula = capture ~ age, data =</span></span>
<span><span class="co">#&gt; netherlandsimmigrant, : Switching from observed information matrix to Fisher</span></span>
<span><span class="co">#&gt; information matrix because hessian of log-likelihood is not negative define.</span></span>
<span><span class="fu"><a href="reference/popSizeEst.html">popSizeEst</a></span><span class="op">(</span><span class="va">modelInflated2</span><span class="op">)</span></span>
<span><span class="co">#&gt; Point estimate: 5496.374</span></span>
<span><span class="co">#&gt; Variance: 1217985</span></span>
<span><span class="co">#&gt; 99% confidence intervals:</span></span>
<span><span class="co">#&gt; lowerBound upperBound </span></span>
<span><span class="co">#&gt;   4002.763  10231.717</span></span></code></pre></div>
<p>the results are significantly different (the warning issued concerns the second derivative test for existence of local minimum, here it was inconclusive but we manually checked that fitting process found the optimal regression coefficients it’s here to provide more information to the user):</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">modelInflated2</span>, </span>
<span>     plotType <span class="op">=</span> <span class="st">"bootHist"</span>, </span>
<span>     labels <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>     ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">175</span><span class="op">)</span>,</span>
<span>     breaks <span class="op">=</span> <span class="fl">15</span><span class="op">)</span></span></code></pre></div>
<p><img src="reference/figures/README-unnamed-chunk-11-1.png" width="75%"></p>
<p>and information criteria support the second model:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co">#&gt;  First model: AIC = 1736.854 BIC = 1759.01</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a><span class="co">#&gt; Second model: AIC = 1734.803 BIC = 1756.959</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="funding">Funding<a class="anchor" aria-label="anchor" href="#funding"></a>
</h2>
<p>Work on this package is supported by the the National Science Center, OPUS 20 grant no. 2020/39/B/HS4/00941.</p>
</div>
</div>
  </main><aside class="col-md-3"><div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=singleRcapture" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/ncn-foreigners/singleRcapture/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/ncn-foreigners/singleRcapture/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://opensource.org/licenses/mit-license.php" class="external-link">MIT</a> + file <a href="LICENSE-text.html">LICENSE</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing singleRcapture</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Piotr Chlebicki <br><small class="roles"> Author, maintainer </small>  </li>
<li>Maciej Beręsewicz <br><small class="roles"> Author, contributor </small> <a href="https://orcid.org/0000-0002-8281-4301" target="orcid.widget" aria-label="ORCID" class="external-link"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://github.com/ncn-foreigners/singleRcapture/actions" class="external-link"><img src="https://github.com/ncn-foreigners/singleRcapture/workflows/R-CMD-check/badge.svg" alt="R-CMD-check"></a></li>
<li><a href="https://app.codecov.io/gh/ncn-foreigners/singleRcapture?branch=main" class="external-link"><img src="https://codecov.io/gh/ncn-foreigners/singleRcapture/branch/main/graph/badge.svg" alt="Codecov test coverage"></a></li>
<li><a href="https://CRAN.R-project.org/package=singleRcapture" class="external-link"><img src="https://www.r-pkg.org/badges/version/singleRcapture" alt="CRAN status"></a></li>
<li><a href="https://cran.r-project.org/package=singleRcapture" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/grand-total/singleRcapture" alt="CRAN total downloads"></a></li>
<li><a href="https://cran.r-project.org/package=singleRcapture" class="external-link"><img src="https://cranlogs.r-pkg.org/badges/singleRcapture" alt="CRAN downloads"></a></li>
<li><a href="https://doi.org/10.5281/zenodo.8436043" class="external-link"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.8436043.svg" alt="DOI"></a></li>
</ul>
</div>

  </aside>
</div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Piotr Chlebicki, Maciej Beręsewicz.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
